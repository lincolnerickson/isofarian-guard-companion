<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'unsafe-inline'; style-src 'unsafe-inline'; img-src 'self' data: blob:;">
<title>The Isofarian Guard 2E - Companion</title>
<style>
:root {
  --bg: #1a1a2e;
  --bg2: #16213e;
  --bg3: #0f3460;
  --accent: #e94560;
  --gold: #f0c040;
  --silver: #c0c0c0;
  --text: #e0e0e0;
  --text2: #a0a0b0;
  --link: #64b5f6;
  --green: #66bb6a;
  --red: #ef5350;
  --orange: #ffa726;
  --purple: #ab47bc;
  --star: #f0c040;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
a { color: var(--link); cursor: pointer; text-decoration: none; }
a:hover { text-decoration: underline; color: #90caf9; }

.header { background: linear-gradient(135deg, var(--bg2), var(--bg3)); padding: 16px 24px; border-bottom: 2px solid var(--accent); display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
.header h1 { font-size: 1.4rem; color: var(--gold); white-space: nowrap; }
.search-box { flex: 1; min-width: 200px; max-width: 400px; }
.search-box input { width: 100%; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--bg3); background: var(--bg); color: var(--text); font-size: 0.95rem; }
.search-box input:focus { outline: none; border-color: var(--accent); }

.tabs { display: flex; background: var(--bg2); border-bottom: 1px solid #333; overflow-x: auto; }
.tab { padding: 10px 20px; cursor: pointer; color: var(--text2); border-bottom: 3px solid transparent; white-space: nowrap; font-size: 0.9rem; transition: all 0.2s; }
.tab:hover { color: var(--text); background: rgba(255,255,255,0.05); }
.tab.active { color: var(--gold); border-bottom-color: var(--accent); }

.content { padding: 16px; max-width: 1400px; margin: 0 auto; }
.panel { display: none; }
.panel.active { display: block; }

/* Cards */
.card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 12px; }
.card { background: var(--bg2); border: 1px solid #333; border-radius: 8px; padding: 14px; transition: border-color 0.2s; }
.card:hover { border-color: var(--accent); }
.card-title { font-size: 1.1rem; font-weight: 700; color: var(--gold); margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }
.card-subtitle { font-size: 0.85rem; color: var(--text2); margin-bottom: 8px; }
.stat-row { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 6px; }
.stat { background: var(--bg); padding: 3px 8px; border-radius: 4px; font-size: 0.82rem; display: inline-flex; align-items: center; gap: 4px; }
.stat-label { color: var(--text2); }
.stat-value { color: var(--text); font-weight: 600; }
.stat.attack .stat-value { color: var(--red); }
.stat.defense .stat-value { color: #42a5f5; }
.stat.hp .stat-value { color: var(--green); }
.stat.ap .stat-value { color: var(--orange); }
.stat.lux .stat-value { color: var(--gold); }
.stat.silver .stat-value { color: var(--silver); }

.rating { color: var(--star); letter-spacing: -2px; font-size: 1rem; }

.section-label { font-size: 0.78rem; color: var(--accent); text-transform: uppercase; font-weight: 600; margin-top: 8px; margin-bottom: 4px; letter-spacing: 0.5px; }
.tag-list { display: flex; flex-wrap: wrap; gap: 4px; }
.tag { background: rgba(100,181,246,0.15); color: var(--link); padding: 2px 8px; border-radius: 3px; font-size: 0.8rem; cursor: pointer; border: 1px solid transparent; }
.tag:hover { border-color: var(--link); background: rgba(100,181,246,0.25); }
.tag.location { background: rgba(102,187,106,0.15); color: var(--green); }
.tag.location:hover { border-color: var(--green); background: rgba(102,187,106,0.25); }
.tag.enemy { background: rgba(239,83,80,0.15); color: var(--red); }
.tag.enemy:hover { border-color: var(--red); background: rgba(239,83,80,0.25); }
.tag.item { background: rgba(171,71,188,0.15); color: var(--purple); }
.tag.item:hover { border-color: var(--purple); background: rgba(171,71,188,0.25); }
.tag.craft { background: rgba(240,192,64,0.15); color: var(--gold); }
.tag.craft:hover { border-color: var(--gold); background: rgba(240,192,64,0.25); }

.locations-list { font-size: 0.82rem; color: var(--text2); margin-top: 4px; }
.locations-list span { color: var(--green); }

/* Detail overlay */
.overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 100; overflow-y: auto; padding: 40px 16px; }
.overlay.active { display: flex; justify-content: center; align-items: flex-start; }
.detail-panel { background: var(--bg2); border: 2px solid var(--accent); border-radius: 12px; padding: 24px; max-width: 700px; width: 100%; position: relative; }
.detail-panel .close-btn { position: absolute; top: 12px; right: 16px; cursor: pointer; font-size: 1.5rem; color: var(--text2); background: none; border: none; }
.detail-panel .close-btn:hover { color: var(--accent); }
.detail-panel h2 { color: var(--gold); margin-bottom: 4px; }
.detail-panel h3 { color: var(--accent); font-size: 0.9rem; margin-top: 14px; margin-bottom: 6px; text-transform: uppercase; }
.detail-section { margin-bottom: 10px; }

.recipe-table { width: 100%; border-collapse: collapse; margin-top: 6px; }
.recipe-table th, .recipe-table td { padding: 6px 10px; text-align: left; border-bottom: 1px solid #333; font-size: 0.85rem; }
.recipe-table th { color: var(--text2); font-weight: 600; }

.prereq-chain { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; margin: 6px 0; }
.prereq-chain .chain-item { background: var(--bg); padding: 4px 10px; border-radius: 4px; font-size: 0.85rem; cursor: pointer; color: var(--link); }
.prereq-chain .chain-item:hover { background: rgba(100,181,246,0.15); }
.prereq-chain .chain-arrow { color: var(--text2); }

/* Filter controls */
.filters { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 14px; align-items: center; }
.filter-btn { padding: 5px 14px; border-radius: 20px; border: 1px solid #444; background: var(--bg); color: var(--text2); cursor: pointer; font-size: 0.82rem; transition: all 0.2s; }
.filter-btn:hover, .filter-btn.active { border-color: var(--accent); color: var(--text); background: rgba(233,69,96,0.15); }

/* Table view */
.data-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
.data-table th { background: var(--bg3); padding: 8px 10px; text-align: left; font-size: 0.82rem; color: var(--text2); position: sticky; top: 0; }
.data-table td { padding: 6px 10px; border-bottom: 1px solid #2a2a3e; font-size: 0.85rem; }
.data-table tr:hover td { background: rgba(255,255,255,0.03); }

.empty-msg { text-align: center; color: var(--text2); padding: 40px; font-size: 1rem; }

/* Market table */
.market-table { width: 100%; border-collapse: collapse; font-size: 0.82rem; overflow-x: auto; display: block; }
.market-table th, .market-table td { padding: 6px 8px; border: 1px solid #333; white-space: nowrap; }
.market-table th { background: var(--bg3); color: var(--text2); }
.market-table .town-header { background: var(--bg3); color: var(--gold); text-align: center; }
.market-table .buy { color: var(--red); }
.market-table .sell { color: var(--green); }

/* Route Planner */
.rp-container { display: flex; gap: 0; height: calc(100vh - 120px); margin: -16px; }
.rp-sidebar { width: 320px; min-width: 280px; background: var(--bg2); border-right: 1px solid #333; padding: 16px; overflow-y: auto; flex-shrink: 0; }
.rp-map-area { flex: 1; position: relative; overflow: hidden; background: #111; }
.rp-map-area canvas { display: block; cursor: grab; }
.rp-map-area canvas:active { cursor: grabbing; }
.rp-map-area canvas.editor-mode { cursor: crosshair; }

.rp-sidebar h3 { color: var(--gold); font-size: 0.95rem; margin-bottom: 10px; }
.rp-sidebar label { display: block; font-size: 0.82rem; color: var(--text2); margin: 10px 0 4px; }
.rp-sidebar select, .rp-sidebar input[type="text"] {
  width: 100%; padding: 7px 10px; border-radius: 5px; border: 1px solid #444;
  background: var(--bg); color: var(--text); font-size: 0.88rem;
}
.rp-sidebar select:focus, .rp-sidebar input[type="text"]:focus { border-color: var(--accent); outline: none; }
.rp-btn { display: inline-block; padding: 8px 18px; border-radius: 6px; border: none; cursor: pointer;
  font-size: 0.88rem; font-weight: 600; transition: all 0.2s; margin-top: 10px; }
.rp-btn-primary { background: var(--accent); color: #fff; }
.rp-btn-primary:hover { background: #d63050; }
.rp-btn-secondary { background: var(--bg3); color: var(--text); border: 1px solid #444; }
.rp-btn-secondary:hover { background: #1a3a6e; }
.rp-btn-sm { padding: 4px 10px; font-size: 0.78rem; margin-top: 0; }

.rp-route-results { margin-top: 14px; }
.rp-step { display: flex; gap: 10px; padding: 8px; background: var(--bg); border-radius: 6px;
  margin-bottom: 6px; font-size: 0.85rem; align-items: flex-start; cursor: pointer; border: 1px solid transparent; }
.rp-step:hover { border-color: var(--accent); }
.rp-step-num { background: var(--accent); color: #fff; width: 22px; height: 22px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; flex-shrink: 0; }
.rp-step-info { flex: 1; }
.rp-step-node { font-weight: 600; color: var(--gold); }
.rp-step-mats { color: var(--text2); font-size: 0.8rem; margin-top: 2px; }
.rp-mat-link { color: var(--link); cursor: pointer; text-decoration: underline; text-decoration-style: dotted; }
.rp-mat-link:hover { color: #90caf9; }
.rp-mat-detail { margin-top: 4px; padding: 6px 8px; background: var(--bg2); border-left: 2px solid var(--accent); border-radius: 0 4px 4px 0; font-size: 0.78rem; }
.rp-mat-detail .rp-md-enemy { color: var(--red); font-weight: 600; }
.rp-mat-detail .rp-md-source { color: var(--green); }
.rp-mat-detail .rp-md-market { color: var(--gold); }
.rp-step-dist { color: var(--text2); font-size: 0.75rem; }

.rp-tooltip { position: absolute; background: var(--bg2); border: 1px solid var(--accent); border-radius: 6px;
  padding: 8px 12px; font-size: 0.82rem; pointer-events: none; z-index: 50; max-width: 250px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5); display: none; }
.rp-tooltip .tt-name { font-weight: 700; color: var(--gold); }
.rp-tooltip .tt-info { color: var(--text2); margin-top: 4px; }

.rp-editor-bar { display: flex; gap: 6px; align-items: center; margin-top: 12px; padding-top: 10px; border-top: 1px solid #333; flex-wrap: wrap; }
.rp-search-filter { margin-top: 6px; }

.rp-summary { background: var(--bg); border-radius: 6px; padding: 10px; margin-top: 10px; font-size: 0.85rem; }
.rp-summary .label { color: var(--text2); }
.rp-summary .value { color: var(--gold); font-weight: 600; }

.rp-legend { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 8px; font-size: 0.78rem; color: var(--text2); }
.rp-legend-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 4px; vertical-align: middle; }

/* Resource Tracker */
.res-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 16px; }
.res-card { background: var(--bg2); border: 1px solid #333; border-radius: 8px; padding: 12px; }
.res-name { font-weight: 600; color: var(--text); font-size: 0.9rem; margin-bottom: 8px; }
.res-controls { display: flex; align-items: center; gap: 6px; }
.res-qty-btn { width: 30px; height: 30px; border-radius: 4px; border: 1px solid #444; background: var(--bg); color: var(--text); font-size: 1.1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.res-qty-btn:hover { border-color: var(--accent); background: rgba(233,69,96,0.15); }
.res-qty-input { width: 60px; text-align: center; padding: 4px; border-radius: 4px; border: 1px solid #444; background: var(--bg); color: var(--text); font-size: 0.95rem; }
.res-qty-input:focus { outline: none; border-color: var(--accent); }
.res-section-title { color: var(--gold); font-size: 1rem; font-weight: 700; margin: 16px 0 10px; padding-bottom: 6px; border-bottom: 1px solid #333; }
.res-section-title:first-child { margin-top: 0; }
.craft-badge { background: rgba(102,187,106,0.2); color: var(--green); font-size: 0.72rem; padding: 2px 8px; border-radius: 10px; font-weight: 600; border: 1px solid rgba(102,187,106,0.4); }
.tag.mat-have { background: rgba(102,187,106,0.18); color: var(--green); border: 1px solid rgba(102,187,106,0.3); }
.tag.mat-have:hover { background: rgba(102,187,106,0.28); border-color: var(--green); }
.tag.mat-need { background: rgba(239,83,80,0.18); color: var(--red); border: 1px solid rgba(239,83,80,0.3); }
.tag.mat-need:hover { background: rgba(239,83,80,0.28); border-color: var(--red); }
.res-clear-btn { padding: 8px 20px; border-radius: 6px; border: 1px solid #444; background: var(--bg); color: var(--text2); cursor: pointer; font-size: 0.85rem; margin-bottom: 16px; }
.res-clear-btn:hover { border-color: var(--red); color: var(--red); background: rgba(239,83,80,0.1); }
.bldg-done-btn { padding: 3px 10px; border-radius: 4px; border: 1px solid #444; background: var(--bg); color: var(--text2); cursor: pointer; font-size: 0.78rem; margin-left: auto; }
.bldg-done-btn:hover { border-color: var(--green); color: var(--green); }
.bldg-done-btn.completed { border-color: var(--green); color: var(--green); background: rgba(102,187,106,0.15); }
.card.bldg-completed { opacity: 0.5; }
.bldg-toggle { margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.hero-picker { margin-bottom: 20px; }
.hero-picker-label { color: var(--gold); font-size: 1rem; font-weight: 700; margin-bottom: 10px; }
.hero-grid { display: flex; flex-wrap: wrap; gap: 8px; }
.hero-btn { padding: 8px 16px; border-radius: 6px; border: 1px solid #444; background: var(--bg); color: var(--text2); cursor: pointer; font-size: 0.9rem; transition: all 0.2s; }
.hero-btn:hover { border-color: var(--accent); color: var(--text); }
.hero-btn.selected { border-color: var(--accent); color: var(--text); background: rgba(233,69,96,0.2); font-weight: 600; }
.card-actions { display: flex; gap: 6px; margin-top: 8px; }
.card-route-btn { padding: 3px 10px; border-radius: 4px; border: 1px solid #444; background: var(--bg); color: var(--text2); cursor: pointer; font-size: 0.78rem; }
.card-route-btn:hover { border-color: var(--accent); color: var(--accent); }
.rp-item-list { margin-top: 8px; }
.rp-item-chip { display: inline-flex; align-items: center; gap: 4px; background: var(--bg); border: 1px solid #444; border-radius: 4px; padding: 4px 8px; margin: 3px 4px 3px 0; font-size: 0.82rem; color: var(--text); }
.rp-item-chip .rp-chip-x { cursor: pointer; color: var(--text2); font-weight: 700; font-size: 0.9rem; line-height: 1; }
.rp-item-chip .rp-chip-x:hover { color: var(--red); }
.rp-item-list-empty { color: var(--text2); font-size: 0.82rem; font-style: italic; margin-top: 6px; }

/* Responsive */
@media (max-width: 600px) {
  .card-grid { grid-template-columns: 1fr; }
  .header { padding: 12px; }
  .header h1 { font-size: 1.1rem; }
  .content { padding: 10px; }
  .tabs { font-size: 0.85rem; }
  .tab { padding: 8px 14px; }
  .rp-container { flex-direction: column; height: auto; }
  .rp-sidebar { width: 100%; border-right: none; border-bottom: 1px solid #333; }
  .rp-map-area { height: 60vh; }
}
</style>
</head>
<body>

<div class="header">
  <h1>The Isofarian Guard 2E Companion</h1>
  <div class="search-box">
    <input type="text" id="globalSearch" placeholder="Search enemies, items, materials, locations..." />
  </div>
</div>

<div class="tabs" id="tabs">
  <div class="tab active" data-tab="enemies">Enemies</div>
  <div class="tab" data-tab="armor-weapons">Armor & Weapons</div>
  <div class="tab" data-tab="accessories">Accessories & Items</div>
  <div class="tab" data-tab="market">Market</div>
  <div class="tab" data-tab="buildings">Ft. Istra Buildings</div>
  <div class="tab" data-tab="stones">Speaking Stones</div>
  <div class="tab" data-tab="materials">Material Finder</div>
  <div class="tab" data-tab="resources">My Resources</div>
  <div class="tab" data-tab="route-planner">Route Planner</div>
</div>

<div class="content" id="content">
  <!-- Enemies -->
  <div class="panel active" id="panel-enemies">
    <div class="filters" id="enemy-filters">
      <span style="color:var(--text2);font-size:0.85rem;">Rating:</span>
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="★">★</button>
      <button class="filter-btn" data-filter="★★">★★</button>
      <button class="filter-btn" data-filter="★★★">★★★</button>
      <button class="filter-btn" data-filter="★★★★">★★★★</button>
    </div>
    <div class="card-grid" id="enemy-grid"></div>
  </div>

  <!-- Armor & Weapons -->
  <div class="panel" id="panel-armor-weapons">
    <div class="filters" id="aw-filters">
      <span style="color:var(--text2);font-size:0.85rem;">Type:</span>
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="Armor">Armor</button>
      <button class="filter-btn" data-filter="Weapon">Weapon</button>
      <span style="color:var(--text2);font-size:0.85rem;margin-left:10px;">Rating:</span>
      <button class="filter-btn active" data-rating="all">All</button>
      <button class="filter-btn" data-rating="★">★</button>
      <button class="filter-btn" data-rating="★★">★★</button>
      <button class="filter-btn" data-rating="★★★">★★★</button>
      <button class="filter-btn" data-rating="★★★★">★★★★</button>
    </div>
    <div class="card-grid" id="aw-grid"></div>
  </div>

  <!-- Accessories -->
  <div class="panel" id="panel-accessories">
    <div class="filters" id="acc-filters">
      <span style="color:var(--text2);font-size:0.85rem;">Type:</span>
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="Accessory">Accessory</button>
      <button class="filter-btn" data-filter="Item">Item</button>
    </div>
    <div class="card-grid" id="acc-grid"></div>
  </div>

  <!-- Market -->
  <div class="panel" id="panel-market">
    <div id="market-content"></div>
  </div>

  <!-- Buildings -->
  <div class="panel" id="panel-buildings">
    <div id="buildings-content"></div>
  </div>

  <!-- Speaking Stones -->
  <div class="panel" id="panel-stones">
    <div class="card-grid" id="stones-grid"></div>
  </div>

  <!-- Material Finder -->
  <div class="panel" id="panel-materials">
    <p style="color:var(--text2);margin-bottom:12px;">Click any material to see which enemies drop it, where to buy it, and what it's used to craft.</p>
    <div class="tag-list" id="material-index" style="gap:6px;"></div>
    <div id="material-detail" style="margin-top:16px;"></div>
  </div>

  <!-- My Resources -->
  <div class="panel" id="panel-resources">
    <div id="resources-content"></div>
  </div>

  <!-- Route Planner -->
  <div class="panel" id="panel-route-planner">
    <div class="rp-container">
      <div class="rp-sidebar">
        <h3>Route Planner</h3>
        <label>Items to Craft</label>
        <div style="display:flex;gap:6px;align-items:center;">
          <input type="text" id="rp-item-search" placeholder="Search items..." style="flex:1;" />
        </div>
        <div style="display:flex;gap:6px;margin-top:6px;">
          <select id="rp-item-select" style="flex:1;"><option value="">-- Select an item --</option></select>
          <button class="rp-btn rp-btn-secondary rp-btn-sm" onclick="rpAddSelectedItem()" style="margin-top:0;white-space:nowrap;">+ Add</button>
        </div>
        <div class="rp-item-list" id="rp-item-list"><div class="rp-item-list-empty">No items added. Select items above or use "Add to Route" on craft cards.</div></div>
        <button class="rp-btn rp-btn-secondary rp-btn-sm" id="rp-clear-items" onclick="rpClearItems()" style="margin-top:6px;">Clear All Items</button>
        <label for="rp-start-select">Starting Location</label>
        <select id="rp-start-select"></select>
        <label for="rp-chapter-select">Current Chapter</label>
        <select id="rp-chapter-select">
          <option value="1">Chapter 1</option>
          <option value="2">Chapter 2</option>
          <option value="3">Chapter 3</option>
          <option value="4">Chapter 4</option>
        </select>
        <button class="rp-btn rp-btn-primary" id="rp-calculate" style="width:100%;">Calculate Route</button>
        <div id="rp-route-summary" class="rp-summary" style="display:none;"></div>
        <div id="rp-route-results" class="rp-route-results"></div>
        <div class="rp-editor-bar">
          <button class="rp-btn rp-btn-secondary rp-btn-sm" id="rp-edit-toggle">Edit Map</button>
          <button class="rp-btn rp-btn-secondary rp-btn-sm" id="rp-edit-connect" style="display:none;">Connect Nodes</button>
          <button class="rp-btn rp-btn-secondary rp-btn-sm" id="rp-edit-water" style="display:none;">Water Route</button>
          <button class="rp-btn rp-btn-secondary rp-btn-sm" id="rp-edit-save" style="display:none;">Save</button>
          <button class="rp-btn rp-btn-secondary rp-btn-sm" id="rp-edit-reset" style="display:none;">Reset</button>
          <button class="rp-btn rp-btn-secondary rp-btn-sm" id="rp-edit-export" style="display:none;">Export JSON</button>
        </div>
        <div id="rp-editor-help" style="display:none;font-size:0.78rem;color:var(--text2);margin-top:8px;padding:8px;background:var(--bg);border-radius:4px;">
          <b style="color:var(--gold);">Editor Controls:</b><br>
          <b>Click</b> empty space &rarr; add node<br>
          <b>Drag</b> a node &rarr; move it<br>
          <b>Connect Nodes</b> &rarr; click nodes to draw edges between them (click same node or empty space to stop)<br>
          <b>Water Route</b> &rarr; toggle on before connecting to create water edges (require Boat Dock)<br>
          <b>Right-click</b> node &rarr; delete it<br>
          <b>Save</b> stores to browser. <b>Export</b> copies JSON.
        </div>
        <div class="rp-legend">
          <span><span class="rp-legend-dot" style="background:#f0c040;"></span>Town</span>
          <span><span class="rp-legend-dot" style="background:#66bb6a;"></span>Node</span>
          <span><span class="rp-legend-dot" style="background:#42a5f5;"></span>Water Node</span>
          <span><span class="rp-legend-dot" style="background:#ab47bc;"></span>Special</span>
          <span><span class="rp-legend-dot" style="background:#ef5350;"></span>Route Stop</span>
        </div>
      </div>
      <div class="rp-map-area" id="rp-map-area">
        <canvas id="rp-canvas"></canvas>
        <div class="rp-tooltip" id="rp-tooltip"></div>
      </div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="detail-panel" id="detail-panel">
    <button class="close-btn" id="close-detail">&times;</button>
    <div id="detail-content"></div>
  </div>
</div>

<script>
const DATA = {"enemies": [{"name": "Armored Zhuk", "rating": "★", "attack": "3", "defense": "2", "ap": "2", "hp": "15", "locations": {"Chapter 1": "8, 23"}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Horn"]}, {"name": "Armored Zhuk", "rating": "★★", "attack": "3", "defense": "3", "ap": "3", "hp": "18", "locations": {"Chapter 2": "8, 23"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Scales"]}, {"name": "Armored Zhuk", "rating": "★★★", "attack": "4", "defense": "4", "ap": "4", "hp": "21", "locations": {"Chapter 3": "8, 23"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Scales"]}, {"name": "Brigand Archer", "rating": "★", "attack": "1", "defense": "1", "ap": "1", "hp": "7", "locations": {"Chapter 1": "31, 35, 40, 46, 52, 58, 63, 67, 68, 73, 85, 91, 99, 103, IC - Old Armory"}, "lux": "2", "silver": "3", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Brigand Archer", "rating": "★★", "attack": "2", "defense": "2", "ap": "1", "hp": "10", "locations": {"Chapter 1": "57", "Chapter 2": "31, 40, 58, 63, 73, 84, 99, IC - Old Armory"}, "lux": "4", "silver": "5", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Brigand Archer", "rating": "★★★", "attack": "3", "defense": "2", "ap": "2", "hp": "13", "locations": {"Chapter 3": "31, 63, 73, 99, IC - Old Armory"}, "lux": "6", "silver": "10", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Brigand Chief", "rating": "★★", "attack": "2", "defense": "2", "ap": "2", "hp": "12", "locations": {"Chapter 1": "IC - Abandoned Quarters, IC - Old Armory", "Chapter 2": "40, 58, 63, 67, 68, 73, 84, 90, 97, 103, IC - Old Armory"}, "lux": "8", "silver": "10", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Brigand Chief", "rating": "★★★", "attack": "3", "defense": "3", "ap": "2", "hp": "15", "locations": {"Chapter 2": "85, IC - Abandoned Quarters", "Chapter 3": "58, 63, 67, 68, 73, 85, 97, 103, IC - Abandoned Quartes, IC - Old Armory"}, "lux": "12", "silver": "15", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Brigand Marauder", "rating": "★", "attack": "1", "defense": "1", "ap": "2", "hp": "7", "locations": {"Chapter 1": "30, 35, 40, 46, 52, 58, 62, 63, 67, 68, 73, 85, 91, 97, 99, 103, IC - Abandoned Quarters, IC - Old Armory"}, "lux": "2", "silver": "3", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Brigand Marauder", "rating": "★★", "attack": "2", "defense": "2", "ap": "2", "hp": "10", "locations": {"Chapter 1": "57, 84, IC - Ossuary", "Chapter 2": "30, 40, 46, 58, 62, 63, 67, 68, 73, 84, 85, 91, 97, 103, IC - Abandoned Quarters, IC - Old Armory, IC - Ossuary"}, "lux": "4", "silver": "5", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Brigand Marauder", "rating": "★★★", "attack": "4", "defense": "3", "ap": "2", "hp": "13", "locations": {"Chapter 2": "52, 84", "Chapter 3": "30, 35, 40, 46, 52, 58, 62, 63, 67, 68, 84, 91, 97, 103, IC - Abandoned Quarters, IC - Old Armory"}, "lux": "6", "silver": "10", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Broken Plough Soldier", "rating": "★★", "attack": "3", "defense": "2", "ap": "3", "hp": "12", "locations": {}, "lux": "6", "silver": "5", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Broken Plough Soldier", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "15", "locations": {}, "lux": "10", "silver": "", "itemDrop": "Mir Bread", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Cave Stalker", "rating": "★★", "attack": "3", "defense": "2", "ap": "3", "hp": "12", "locations": {"Chapter 1": "8, 23, IC - Frozen Lake, IC - Glacial Worm Bones, IC - Hall of Ice, IC - Ossuary", "Chapter 2": "23. IC - Frozen Lake, IC - Glacial Worm Bones, IC - Hall of Ice, IC - Ossuary"}, "lux": "8", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Horn"]}, {"name": "Cave Stalker", "rating": "★★★", "attack": "4", "defense": "2", "ap": "3", "hp": "15", "locations": {"Chapter 1": "IC - Frozen Lake", "Chapter 2": "8, IC - Frozen Lake", "Chapter 3": "8, 23, IC - Frozen Lake, IC - Glacial Worm Bones, IC - Hall of Ice, IC - Ossuary"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Horn"]}, {"name": "Cave Stalker", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "4", "hp": "18", "locations": {"Chapter 4": "8, 10, 23, IC - Abandoned Quarters, IC - Frozen Lake, IC - Glacial Worm Bones, IC - Hall of Ice, IC - Old Armory, IC - Ossuary"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Shards"]}, {"name": "Clayhorn", "rating": "★", "attack": "2", "defense": "2", "ap": "2", "hp": "12", "locations": {"Chapter 1": "53, 58, 61, 62, 77, 83, 84, 85, 93, 103"}, "lux": "4", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Rough Leather"]}, {"name": "Clayhorn", "rating": "★★", "attack": "3", "defense": "3", "ap": "2", "hp": "15", "locations": {"Chapter 1": "38, 44, 77, 83,", "Chapter 2": "53, 61, 62, 73, 77, 83"}, "lux": "8", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Horn"]}, {"name": "Clayhorn", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "18", "locations": {"Chapter 3": "77"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Horn"]}, {"name": "Corrupted Brigand", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "12", "locations": {"Chapter 2": "52, 58, 73, 84, 90"}, "lux": "9", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Corrupted Brigand", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "15", "locations": {"Chapter 2": "85, IC - Old Armory", "Chapter 3": "58, 73, 85, 90, 103, 104, IC - Old Armory"}, "lux": "13", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Corrupted Brigand", "rating": "★★★★", "attack": "4", "defense": "3", "ap": "4", "hp": "18", "locations": {"Chapter 3": "84, 104", "Chapter 4": "58, 73, 84, 85, 90, 103, 104, IC - Old Armory"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Corrupted Fylakes", "rating": "★★", "attack": "2", "defense": "3", "ap": "2", "hp": "13", "locations": {"Chapter 2": "36, 37, 64, 72"}, "lux": "9", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Corrupted Fylakes", "rating": "★★★", "attack": "3", "defense": "4", "ap": "3", "hp": "16", "locations": {"Chapter 3": "36, 37, 44, 52, 61, 64, 72"}, "lux": "13", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Corrupted Fylakes", "rating": "★★★★", "attack": "4", "defense": "4", "ap": "4", "hp": "20", "locations": {"Chapter 3": "44", "Chapter 4": "36, 37, 52, 61, 64, 72"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Corrupted Guard", "rating": "★★", "attack": "2", "defense": "2", "ap": "2", "hp": "16", "locations": {}, "lux": "8", "silver": "5", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Corrupted Guard", "rating": "★★★", "attack": "3", "defense": "3", "ap": "2", "hp": "20", "locations": {}, "lux": "12", "silver": "10", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Corrupted Guard", "rating": "★★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "24", "locations": {}, "lux": "16", "silver": "15", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Corrupted Lobster", "rating": "★★", "attack": "4", "defense": "2", "ap": "3", "hp": "18", "locations": {"Chapter 2": "1, 27, 42, 80"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Horn"]}, {"name": "Corrupted Lobster", "rating": "★★★", "attack": "5", "defense": "3", "ap": "4", "hp": "24", "locations": {"Chapter 3": "27, 42, 50, 80"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Scales"]}, {"name": "Corrupted Lobster", "rating": "★★★★", "attack": "6", "defense": "4", "ap": "5", "hp": "30", "locations": {"Chapter 4": "1, 27, 42, 80"}, "lux": "20", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Carapace"]}, {"name": "Corrupted Priest", "rating": "★★★★", "attack": "4", "defense": "2", "ap": "3", "hp": "24", "locations": {}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Shards"]}, {"name": "Corrupted Soldier", "rating": "★★", "attack": "2", "defense": "3", "ap": "2", "hp": "16", "locations": {"Chapter 2": "14, 105"}, "lux": "10", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Corrupted Soldier", "rating": "★★★", "attack": "3", "defense": "3", "ap": "3", "hp": "20", "locations": {"Chapter 2": "7", "Chapter 3": "92, 97, 99, 104, 105"}, "lux": "14", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Corrupted Soldier", "rating": "★★★★", "attack": "4", "defense": "3", "ap": "4", "hp": "24", "locations": {"Chapter 4": "7, 30, 31, 35, 36, 37, 46, 58, 62, 63, 64, 67, 68, 76, 77, 83, 84, 85, 87, 90, 92, 93, 97, 99, 103, 105, 108"}, "lux": "18", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Disruptor", "rating": "★★", "attack": "4", "defense": "3", "ap": "1", "hp": "16", "locations": {"Chapter 2": "5, 7, 8, 50, 57, 91"}, "lux": "13", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Claw"]}, {"name": "Disruptor", "rating": "★★★", "attack": "4", "defense": "3", "ap": "2", "hp": "20", "locations": {"Chapter 2": "38", "Chapter 3": "5, 7, 8, 38, 47, 50, 68, 91"}, "lux": "17", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Claw"]}, {"name": "Disruptor", "rating": "★★★★", "attack": "5", "defense": "4", "ap": "3", "hp": "26", "locations": {"Chapter 4": "5, 7, 8, 10, 11, 38, 47, 50, 68, 91"}, "lux": "22", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Shards"]}, {"name": "Drakondor", "rating": "★", "attack": "3", "defense": "1", "ap": "1", "hp": "12", "locations": {"Chapter 1": "6, 80"}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Feathers"]}, {"name": "Drakondor", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "15", "locations": {"Chapter 2": "6, 80"}, "lux": "10", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Feathers"]}, {"name": "Drakondor", "rating": "★★★", "attack": "4", "defense": "2", "ap": "3", "hp": "18", "locations": {"Chapter 3": "80"}, "lux": "14", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Feathers"]}, {"name": "Dusk Stalker", "rating": "★★", "attack": "3", "defense": "2", "ap": "3", "hp": "16", "locations": {"Chapter 1": "FW - Mount Nebesa, FW - Skryvat Temple", "Chapter 2": "10, 19, 28, 35, 36, 92, 97, 99, 103, FW - Ice Fields, FW - Mount Nebesa, FW - Skryvat Temple, FW - Vniz Path"}, "lux": "8", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Claw"]}, {"name": "Dusk Stalker", "rating": "★★★", "attack": "4", "defense": "3", "ap": "4", "hp": "20", "locations": {"Chapter 3": "1, 7, 13, 19, 28, 30, 35, 36, 38, 40, 61, 62, 67, 68, 90, 92, 99, FW - Ice Fields, FW - Mount Nebesa, FW - Skryvat Temple, FW - Urok Span, FW - Vniz Path"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Spines"]}, {"name": "Dusk Stalker", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "4", "hp": "24", "locations": {"Chapter 4": "1, 7, 13, 18, 19, 26, 30, 35, 38, 46, 53, 62, 67, 84, 85, 91, 92, 93, 97, 99, 103, 108, FW - Ice Fields, FW - Mount Nebesa, FW - Reka Glacier, FW - Skryvat Temple, FW - The Broken Lands, FW - Uchitel Span, FW - Urok Span, FW - Vniz Path"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Shards"]}, {"name": "Eye of Uvidet", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "15", "locations": {}, "lux": "6", "silver": "5", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Eye of Uvidet", "rating": "★★★", "attack": "4", "defense": "2", "ap": "3", "hp": "18", "locations": {}, "lux": "10", "silver": "10", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Eye of Uvidet", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "3", "hp": "21", "locations": {}, "lux": "14", "silver": "15", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Falmund Scout", "rating": "★", "attack": "2", "defense": "2", "ap": "1", "hp": "8", "locations": {"Chapter 1": "7, 14, 19, 26, 36, 37, 57, 64, 90, 92, 97"}, "lux": "4", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Falmund Scout", "rating": "★★", "attack": "3", "defense": "3", "ap": "1", "hp": "11", "locations": {"Chapter 1": "76, 77, 93, 104, 105", "Chapter 2": "7, 19, 26, 28, 36, 37, 57, 62, 64, 77, 87, 90, 92, 99, 104, 105"}, "lux": "6", "silver": "5", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Falmund Scout", "rating": "★★★", "attack": "4", "defense": "3", "ap": "2", "hp": "14", "locations": {"Chapter 2": "14", "Chapter 3": "7, 19, 26, 28, 37, 57, 64, 77, 87, 92, 105"}, "lux": "8", "silver": "", "itemDrop": "Falmundian Rosehips", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Flesh Eating Fish", "rating": "★", "attack": "2", "defense": "1", "ap": "2", "hp": "7", "locations": {"Chapter 1": "11, 21, 27, 39, 42, 47, 65, 66, 80, 89"}, "lux": "2", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Bone Fragments"]}, {"name": "Flesh Eating Fish", "rating": "★★", "attack": "2", "defense": "2", "ap": "3", "hp": "10", "locations": {"Chapter 2": "11, 21, 27, 39, 42, 47, 65, 66, 80, 89"}, "lux": "4", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Bone Fragments"]}, {"name": "Flesh Eating Fish", "rating": "★★★", "attack": "3", "defense": "2", "ap": "4", "hp": "13", "locations": {"Chapter 3": "11, 21, 27, 39, 42, 47, 65, 66, 80, 89"}, "lux": "8", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Bone Fragments"]}, {"name": "Flesh Eating Fish", "rating": "★★★★", "attack": "4", "defense": "3", "ap": "4", "hp": "16", "locations": {"Chapter 4": "11, 21, 27, 39, 42, 47, 65, 66, 80, 89"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Bone Fragments"]}, {"name": "Glacial Worm", "rating": "★★★", "attack": "4", "defense": "3", "ap": "2", "hp": "24", "locations": {}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Carapace"]}, {"name": "Glacial Worm", "rating": "★★★★", "attack": "5", "defense": "4", "ap": "3", "hp": "30", "locations": {"Chapter 4": "FW - The Broken Lands, IC - Frozen Lake"}, "lux": "20", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Carapace"]}, {"name": "Golden Scythe Soldier", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "10", "locations": {}, "lux": "6", "silver": "10", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Golden Scythe Soldier", "rating": "★★★", "attack": "3", "defense": "3", "ap": "3", "hp": "13", "locations": {}, "lux": "10", "silver": "", "itemDrop": "Golden Potato", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Hand of Uvidet", "rating": "★★", "attack": "4", "defense": "2", "ap": "2", "hp": "15", "locations": {}, "lux": "8", "silver": "5", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Hand of Uvidet", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "18", "locations": {}, "lux": "12", "silver": "10", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Hand of Uvidet", "rating": "★★★★", "attack": "5", "defense": "4", "ap": "3", "hp": "21", "locations": {}, "lux": "16", "silver": "15", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Kingsguard", "rating": "★", "attack": "2", "defense": "2", "ap": "2", "hp": "8", "locations": {}, "lux": "4", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Kingsguard", "rating": "★★", "attack": "2", "defense": "3", "ap": "3", "hp": "11", "locations": {"Chapter 2": "31, 35, 91, 93, 104"}, "lux": "8", "silver": "10", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Kingsguard", "rating": "★★★", "attack": "3", "defense": "4", "ap": "3", "hp": "14", "locations": {"Chapter 2": "19", "Chapter 3": "19, 31, 35, 93"}, "lux": "12", "silver": "15", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Kingsguard", "rating": "★★★★", "attack": "5", "defense": "4", "ap": "3", "hp": "17", "locations": {"Chapter 4": "26, 31"}, "lux": "16", "silver": "20", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Metal Eater", "rating": "★★", "attack": "1", "defense": "3", "ap": "1", "hp": "5", "locations": {"Chapter 2": "40, 44, 46, 58, 93"}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments (40, 46, 58, 93)", "Bone Fragments", "Claw (58, 93)"]}, {"name": "Metal Eater", "rating": "★★★", "attack": "1", "defense": "4", "ap": "2", "hp": "8", "locations": {"Chapter 3": "40, 44, 58, 93"}, "lux": "9", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments", "Claw", "Horn (58, 93)"]}, {"name": "Metal Eater", "rating": "★★★★", "attack": "1", "defense": "5", "ap": "3", "hp": "12", "locations": {"Chapter 4": "23, 40, 46, 58, 93, 99, 103"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Claw", "Horn", "Scales (23*, 58)", "Carapace (23*)"]}, {"name": "Mountain Bear", "rating": "★", "attack": "3", "defense": "1", "ap": "2", "hp": "12", "locations": {"Chapter 1": "1, 6, 13, 18, 28, 30, 31, 36, FW - Ice Fields, FW - Mount Nebesa, FW - Reka Glacier, FW - Vniz Path, IC - Glacial Worm Bones, IC - Hall of Ice"}, "lux": "4", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Bear Pelt"]}, {"name": "Mountain Bear", "rating": "★★", "attack": "3", "defense": "2", "ap": "3", "hp": "15", "locations": {"Chapter 1": "7, 44, 64", "Chapter 2": "6, 36, FW - Mount Nebesa, FW - Reka Glacier"}, "lux": "8", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Bear Pelt"]}, {"name": "Mountain Bear", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "18", "locations": {"Chapter 2": "44, FW - Reka Glacier", "Chapter 3": "6, 36, FW - Reka Glacier, IC - Glacial Worm Bones, IC - Hall of Ice"}, "lux": "10", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Bear Pelt"]}, {"name": "Plains Strider", "rating": "★", "attack": "2", "defense": "1", "ap": "2", "hp": "7", "locations": {"Chapter 1": "38, 53, 57, 61, 62, 67, 72, 73, 76, 83, 84, 90, 93, 97, 104"}, "lux": "2", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Rough Leather"]}, {"name": "Plains Strider", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "10", "locations": {"Chapter 1": "53", "Chapter 2": "38, 53, 57, 67, 76, 83, 90, 93, 97"}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Rough Leather"]}, {"name": "Plains Strider", "rating": "★★★", "attack": "4", "defense": "2", "ap": "3", "hp": "13", "locations": {"Chapter 2": "72", "Chapter 3": "38, 53, 57, 61, 72, 73, 76, 90, 97, 104"}, "lux": "8", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Spines"]}, {"name": "Seer Acolyte", "rating": "★", "attack": "2", "defense": "1", "ap": "2", "hp": "8", "locations": {}, "lux": "3", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Seer Acolyte", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "11", "locations": {}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Seer Acolyte", "rating": "★★★", "attack": "4", "defense": "3", "ap": "2", "hp": "14", "locations": {}, "lux": "10", "silver": "", "itemDrop": "Midnight Hydrangea", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Seer Acolyte", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "3", "hp": "17", "locations": {}, "lux": "14", "silver": "", "itemDrop": "Midnight Hydrangea", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Seer Zealot", "rating": "★", "attack": "2", "defense": "1", "ap": "2", "hp": "7", "locations": {}, "lux": "3", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Seer Zealot", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "10", "locations": {}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Metal Fragments"]}, {"name": "Seer Zealot", "rating": "★★★", "attack": "4", "defense": "2", "ap": "3", "hp": "13", "locations": {}, "lux": "10", "silver": "", "itemDrop": "Ruinous Seed", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Seer Zealot", "rating": "★★★★", "attack": "5", "defense": "2", "ap": "4", "hp": "16", "locations": {}, "lux": "14", "silver": "", "itemDrop": "Ruinous Seed", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Seer's Assassin", "rating": "★★", "attack": "3", "defense": "2", "ap": "3", "hp": "15", "locations": {"Chapter 2": "52, 72"}, "lux": "10", "silver": "10", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Seer's Assassin", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "18", "locations": {"Chapter 3": "26, 46, 52, 72"}, "lux": "14", "silver": "15", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Seer's Assassin", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "4", "hp": "21", "locations": {"Chapter 3": "14, 37", "Chapter 4": "10, 14, 26, 28, 37, 52, 57, 58, 68, 73"}, "lux": "18", "silver": "20", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Stone Guardian", "rating": "★★", "attack": "3", "defense": "2", "ap": "3", "hp": "18", "locations": {"Chapter 1": "FW - Room of Columns", "Chapter 2": "FW - Room of Columns"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "Ancient Roots", "materialDrops": []}, {"name": "Stone Guardian", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "21", "locations": {"Chapter 3": "FW - Room of Columns"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Shards"]}, {"name": "Stone Guardian", "rating": "★★★★", "attack": "5", "defense": "4", "ap": "4", "hp": "24", "locations": {"Chapter 4": "FW - Room of Columns, FW - Vniz Path"}, "lux": "29", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Shards"]}, {"name": "Stonehunter", "rating": "★", "attack": "2", "defense": "2", "ap": "2", "hp": "8", "locations": {"Chapter 1": "14, 19, 27, 36, 37, 64, 72, 76, 85, 90, 92, 99, 104"}, "lux": "4", "silver": "5", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Stonehunter", "rating": "★★", "attack": "3", "defense": "3", "ap": "2", "hp": "11", "locations": {"Chapter 1": "14, 19, 26, 37, 52, 61, 72, 87, 105", "Chapter 2": "14, 28, 85, 87, 90, 92, 99"}, "lux": "8", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Rough Leather"]}, {"name": "Stonehunter", "rating": "★★★", "attack": "4", "defense": "3", "ap": "4", "hp": "14", "locations": {"Chapter 2": "64, 76", "Chapter 3": "14, 28, 36, 64, 76, 85, 87, 99, 105"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Rough Leather"]}, {"name": "Tenebris Clayhorn", "rating": "★★", "attack": "2", "defense": "3", "ap": "2", "hp": "18", "locations": {"Chapter 2": "38, 57, 62, 77, 83"}, "lux": "10", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Spines"]}, {"name": "Tenebris Clayhorn", "rating": "★★★", "attack": "3", "defense": "3", "ap": "3", "hp": "22", "locations": {"Chapter 3": "7, 38, 44, 53, 57, 61, 62, 73, 76, 77, 83, 85, 91, 103"}, "lux": "14", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Horn"]}, {"name": "Tenebris Clayhorn", "rating": "★★★★", "attack": "4", "defense": "4", "ap": "3", "hp": "26", "locations": {"Chapter 4": "38, 40, 46, 53, 62, 64, 73, 76, 77, 83, 85, 91"}, "lux": "18", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Scales"]}, {"name": "Tenebris Colossus", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "18", "locations": {"Chapter 2": "13, 18, 30, 31, 40, 46, 58, 67, 68, 76"}, "lux": "10", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Bear Pelt"]}, {"name": "Tenebris Colossus", "rating": "★★★", "attack": "4", "defense": "2", "ap": "3", "hp": "22", "locations": {"Chapter 3": "13, 18, 30, 31, 40, 46, 58, 67, 84, 90, FW - Mount Nebesa, FW - Reka Glacier"}, "lux": "14", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Horn"]}, {"name": "Tenebris Colossus", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "4", "hp": "26", "locations": {"Chapter 4": "13, 14, 28, 30, 31, 40, 44, 53, 58, 67, 90, FW - Mount Nebesa, FW - Reka Glacier, IC - Abandoned Quarters, IC - Glacial Worm Bones, IC - Hall of Ice, IC - Ossuary"}, "lux": "18", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Shards"]}, {"name": "Tenebris Drakondor", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "18", "locations": {}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Feathers"]}, {"name": "Tenebris Drakondor", "rating": "★★★", "attack": "4", "defense": "2", "ap": "3", "hp": "24", "locations": {"Chapter 2": "23", "Chapter 3": "6"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Feathers"]}, {"name": "Tenebris Drakondor", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "3", "hp": "30", "locations": {"Chapter 2": "6", "Chapter 4": "5, 6, 52, 77, 80, 108"}, "lux": "20", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Skull"]}, {"name": "Tenebris Guard", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "20", "locations": {"Chapter 3": "40, 91, 93, 104"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Claw"]}, {"name": "Tenebris Guard", "rating": "★★★★", "attack": "5", "defense": "4", "ap": "3", "hp": "24", "locations": {"Chapter 4": "19, 28, 35, 40, 57, 62, 90, 91, 93, 97, 104, 108"}, "lux": "20", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Shards"]}, {"name": "Tenebris Hunter", "rating": "★★", "attack": "4", "defense": "2", "ap": "3", "hp": "18", "locations": {"Chapter 2": "10, 12"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Claw"]}, {"name": "Tenebris Hunter", "rating": "★★★", "attack": "5", "defense": "2", "ap": "4", "hp": "22", "locations": {"Chapter 3": "6, 10, 12, 14"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Shards"]}, {"name": "Tenebris Hunter", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "5", "hp": "26", "locations": {"Chapter 4": "5, 6, 7, 10, 12, 13, 14, 19, FW - Mount Nebesa, IC - Abandoned Quarters, IC - Old Armory, IC - Ossuary"}, "lux": "20", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Skull"]}, {"name": "Tenebris Strider", "rating": "★★", "attack": "3", "defense": "2", "ap": "3", "hp": "16", "locations": {"Chapter 2": "53, 63, 91, 93, 104"}, "lux": "8", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Spines"]}, {"name": "Tenebris Strider", "rating": "★★★", "attack": "4", "defense": "2", "ap": "4", "hp": "20", "locations": {"Chapter 2": "61, 87", "Chapter 3": "53, 58, 61, 63, 83, 84, 87"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Spines"]}, {"name": "Tenebris Strider", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "4", "hp": "24", "locations": {"Chapter 4": "38, 40, 44, 52, 53, 57, 58, 61, 63, 67, 72, 73, 76, 83, 84, 85, 92, 97, 104, 108"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Scales"]}, {"name": "Tenebris Zhuk", "rating": "★★", "attack": "4", "defense": "3", "ap": "2", "hp": "20", "locations": {}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Claw"]}, {"name": "Tenebris Zhuk", "rating": "★★★", "attack": "4", "defense": "4", "ap": "3", "hp": "24", "locations": {"Chapter 3": "23"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Carapace"]}, {"name": "Tenebris Zhuk", "rating": "★★★★", "attack": "5", "defense": "4", "ap": "4", "hp": "28", "locations": {"Chapter 3": "8", "Chapter 4": "8, 23"}, "lux": "20", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Carapace"]}, {"name": "Timber Wolf", "rating": "★", "attack": "2", "defense": "1", "ap": "2", "hp": "7", "locations": {"Chapter 1": "1, 5, 7, 10, 12, 13, 18, 30, 31, 35, 38, 44, FW - Ice Fields, FW - Mount Nebesa, FW - Reka Glacier, FW - Skryvat Temple, FW - The Broken Lands, FW - Urok Span, FW - Vniz Path, IC - Ossuary"}, "lux": "2", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Wolf Pelt"]}, {"name": "Timber Wolf", "rating": "★★", "attack": "3", "defense": "1", "ap": "3", "hp": "10", "locations": {"Chapter 2": "1, 7, 10, 13, 18, 26, 30, 35, 44, FW - Ice Fields, FW - Mount Nebesa, FW - Reka Glacier, FW - Skryvat Temple, FW - The Broken Lands, FW - Urok Span, IC - Ossuary"}, "lux": "4", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Bone Fragments"]}, {"name": "Timber Wolf", "rating": "★★★", "attack": "4", "defense": "2", "ap": "3", "hp": "13", "locations": {"Chapter 2": "38,  FW - Vniz Path", "Chapter 3": "10, 18, 26, 44, FW - Reka Glacier, FW - Skryvat Temple, FW - The Broken Lands, FW - Vniz Path"}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Claw"]}, {"name": "Tumani Hunter", "rating": "★", "attack": "2", "defense": "1", "ap": "2", "hp": "7", "locations": {"Chapter 1": "5, 10, 12, 13, FW - Reka Glacier, FW - The Broken Lands, FW - Uchitel Span, FW - Urok Span, FW - Vniz Path"}, "lux": "2", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Wolf Pelt"]}, {"name": "Tumani Hunter", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "10", "locations": {"Chapter 2": "5, 10, 12, 13, FW - The Broken Lands, FW - Uchitel Span, FW - Urok Span, FW - Vniz Path"}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Animal Hide"]}, {"name": "Tumani Hunter", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "13", "locations": {"Chapter 2": "FW - Reka Glacier", "Chapter 3": "5, 10, 12, 13, FW - The Broken Lands, FW - Uchitel Span, FW - Urok Span, FW - Vniz Path"}, "lux": "10", "silver": "", "itemDrop": "Health Potion", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Tumani Hunter", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "4", "hp": "16", "locations": {"Chapter 3": "FW - Reka Glacier, FW - Uchitel Span, FW - Urok Span", "Chapter 4": "5, FW - Uchitel Span, FW - Urok Span"}, "lux": "13", "silver": "", "itemDrop": "Purifying Seed", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Tumani Mender", "rating": "★", "attack": "1", "defense": "1", "ap": "1", "hp": "7", "locations": {"Chapter 1": "5, 10, 12, FW - Reka Glacier, FW - Uchitel Span, FW - Urok Span, FW - Vniz Path"}, "lux": "2", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Wolf Pelt"]}, {"name": "Tumani Mender", "rating": "★★", "attack": "1", "defense": "2", "ap": "2", "hp": "10", "locations": {"Chapter 2": "5, 12, FW - Reka Glacier, FW - The Broken Lands, FW - Uchitel Span"}, "lux": "6", "silver": "", "itemDrop": "Midnight Hydrangea", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Tumani Mender", "rating": "★★★", "attack": "1", "defense": "3", "ap": "4", "hp": "13", "locations": {"Chapter 2": "FW - Urok Span, FW - Vniz Path", "Chapter 3": "5, 12, FW - Reka Glacier, FW - The Broken Lands, FW - Uchitel Span, FW - Urok Span, FW - Vniz Path"}, "lux": "10", "silver": "", "itemDrop": "Coastal Bluecaps", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Tumani Mender", "rating": "★★★★", "attack": "1", "defense": "3", "ap": "4", "hp": "16", "locations": {"Chapter 4": "FW - Uchitel Span, FW - Urok Span"}, "lux": "13", "silver": "", "itemDrop": "Midnight Hydrangea", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Tumani Raider", "rating": "★", "attack": "2", "defense": "2", "ap": "2", "hp": "8", "locations": {"Chapter 1": "11, 18, 21, 42, 50, 82, 87"}, "lux": "2", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Wolf Pelt"]}, {"name": "Tumani Raider", "rating": "★★", "attack": "3", "defense": "2", "ap": "3", "hp": "11", "locations": {"Chapter 2": "11, 18, 21, 42, 50, 82, 87"}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Animal Hide"]}, {"name": "Tumani Raider", "rating": "★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "14", "locations": {"Chapter 3": "11, 18, 21, 42, 50, 82"}, "lux": "10", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Animal Hide"]}, {"name": "Tumani Raider", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "4", "hp": "17", "locations": {"Chapter 3": "87", "Chapter 4": "11, 12, 18, 21, 42, 50, 63, 82, 87"}, "lux": "14", "silver": "", "itemDrop": "Coastal Bluecaps", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Volrok", "rating": "★", "attack": "3", "defense": "1", "ap": "1", "hp": "12", "locations": {"Chapter 1": "11, 21, 27, 39, 42, 47, 50, 65, 66, 80, 82, 89"}, "lux": "6", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Rough Leather"]}, {"name": "Volrok", "rating": "★★", "attack": "3", "defense": "2", "ap": "2", "hp": "15", "locations": {"Chapter 2": "11, 21, 39, 47, 50, 65, 66, 80, 82, 89"}, "lux": "10", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Rough Leather"]}, {"name": "Volrok", "rating": "★★★", "attack": "4", "defense": "3", "ap": "2", "hp": "18", "locations": {"Chapter 3": "11, 21, 27, 39, 47, 65, 66, 82, 89"}, "lux": "14", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Rough Leather"]}, {"name": "Volrok", "rating": "★★★★", "attack": "5", "defense": "3", "ap": "3", "hp": "21", "locations": {"Chapter 3": "80", "Chapter 4": "11, 21, 39, 42, 47, 50, 65, 66, 80, 89"}, "lux": "18", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Rough Leather"]}, {"name": "Waste Nomad", "rating": "★★", "attack": "2", "defense": "2", "ap": "1", "hp": "10", "locations": {"Chapter 2": "12, 18, 23, FW - Mount Nebesa, FW - Vniz Path"}, "lux": "6", "silver": "", "itemDrop": "Iron Ore, Purifying Seed, Ruinous Seed, or Midnight Hydrangea", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Waste Nomad", "rating": "★★★", "attack": "3", "defense": "3", "ap": "2", "hp": "13", "locations": {"Chapter 3": "12, 18, 23, 26, FW - Mount Nebesa, FW - Vniz Path"}, "lux": "9", "silver": "", "itemDrop": "Iron Ore, Purifying Seed, Ruinous Seed, or Midnight Hydrangea", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Waste Nomad", "rating": "★★★★", "attack": "4", "defense": "3", "ap": "3", "hp": "16", "locations": {"Chapter 4": "12, 18, 23, 26, FW - Mount Nebesa, FW - Vniz Path"}, "lux": "12", "silver": "", "itemDrop": "Iron Ore, Purifying Seed, Ruinous Seed, or Midnight Hydrangea", "speakingStoneDrop": "", "materialDrops": []}, {"name": "Waste Prowler", "rating": "★★", "attack": "4", "defense": "3", "ap": "2", "hp": "18", "locations": {"Chapter 1": "FW - Room of Columns, FW - Skryvat Temple", "Chapter 2": "5, FW - Room of Columns, FW - Skryvat Temple"}, "lux": "12", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Claw"]}, {"name": "Waste Prowler", "rating": "★★★", "attack": "5", "defense": "3", "ap": "3", "hp": "22", "locations": {"Chapter 3": "1, 5, FW - Ice Fields, FW - Room of Columns, FW - Skryvat Temple"}, "lux": "16", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Horn"]}, {"name": "Waste Prowler", "rating": "★★★★", "attack": "5", "defense": "4", "ap": "4", "hp": "26", "locations": {"Chapter 4": "1, 6, 12, 13, 18, FW - Ice Fields, FW - Reka Glacier, FW - Room of Columns, FW - Skryvat Temple, FW - Urok Span"}, "lux": "20", "silver": "", "itemDrop": "", "speakingStoneDrop": "", "materialDrops": ["Tenebris Skull"]}], "armorWeapons": [{"name": "Guard's Tunic", "city": "Mir", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "0⛊", "stoneSlots": "1", "bonusChip": "", "craftCost": "10", "sellPrice": "5", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Metal Fragments": {"qty": "2", "rep2": "1"}, "Rough Leather": {"qty": "4", "rep2": "2"}}, "wood": {}, "ores": {}}, {"name": "Woven Spine Armor", "city": "Mir", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "2⛊", "stoneSlots": "1", "bonusChip": "⛊⛊", "craftCost": "25", "sellPrice": "15", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Bone Fragments": {"qty": "4", "rep2": "2"}, "Rough Leather": {"qty": "2", "rep2": "1"}, "Spines": {"qty": "4", "rep2": "2"}}, "wood": {}, "ores": {}}, {"name": "Reinforced Tunic", "city": "Razdor, Ryba, Silny", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "1", "bonusChip": "", "craftCost": "20RAZDOR/SILNY\n15RYBA", "sellPrice": "15RAZDOR\n10RYBA/SILNY", "luxCost": "-", "prerequisite": "Guard's Tunic", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Metal Fragments": {"qty": "4", "rep2": "2"}, "Rough Leather": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Iron": {"qty": "2", "rep2": "1"}}}, {"name": "Bear Tunic", "city": "Silny, Strofa", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "2", "bonusChip": "", "craftCost": "35STROFA\n30SILNY", "sellPrice": "20STROFA\n15SILNY", "luxCost": "-", "prerequisite": "Reinforced Tunic", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Bear Pelt": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {}}, {"name": "Horned Cuirass", "city": "Mir, Ryba", "limitedTo": "", "rating": "★★★", "type": "Armor", "statIncrease": "2⛊", "stoneSlots": "2", "bonusChip": "", "craftCost": "48RYBA\n36MIRA", "sellPrice": "24RYBA\n18MIRA", "luxCost": "-", "prerequisite": "Reinforced Tunic", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Claw": {"qty": "2", "rep2": "1"}, "Horn": {"qty": "2Mir\n4Ryba", "rep2": "1Mir\n2Ryba"}}, "wood": {}, "ores": {"Silver": {"qty": "2", "rep2": "1"}}}, {"name": "Guild Cuirass", "city": "Razdor", "limitedTo": "", "rating": "★★★", "type": "Armor", "statIncrease": "2⛊", "stoneSlots": "3", "bonusChip": "❤︎", "craftCost": "56", "sellPrice": "28", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "2", "rep2": "1"}, "Spines": {"qty": "2", "rep2": "1"}, "Scales": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Iron": {"qty": "2", "rep2": "1"}}}, {"name": "Volkrok Tunic", "city": "Strofa", "limitedTo": "", "rating": "★★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "2", "bonusChip": "Evade", "craftCost": "48", "sellPrice": "24", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "4", "rep2": "2"}, "Claw": {"qty": "4", "rep2": "2"}}, "wood": {}, "ores": {}}, {"name": "Guard's Armor", "city": "Vouno", "limitedTo": "", "rating": "★★★★", "type": "Armor", "statIncrease": "3⛊", "stoneSlots": "2", "bonusChip": "", "craftCost": "56", "sellPrice": "28", "luxCost": "-", "prerequisite": "Horned Cuirass", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Animal Hide": {"qty": "2", "rep2": "1"}, "Scales": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Gold": {"qty": "2", "rep2": "1"}}}, {"name": "Hero's Armor", "city": "Vouno", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "4⛊", "stoneSlots": "1", "bonusChip": "🗡️⛊", "craftCost": "80", "sellPrice": "40", "luxCost": "-", "prerequisite": "Guard's Tunic", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Tenebris Shards": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Agate": {"qty": "2", "rep2": "1"}, "Crystal": {"qty": "2", "rep2": "1"}}}, {"name": "Raiding Armor", "city": "Ft. Istra (Blacksmith)", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "4⛊", "stoneSlots": "3", "bonusChip": "", "craftCost": "-", "sellPrice": "-", "luxCost": "50", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Scales": {"qty": "4", "rep2": "NA"}, "Carapace": {"qty": "2", "rep2": "NA"}}, "wood": {}, "ores": {"Diamond": {"qty": "2", "rep2": "NA"}}}, {"name": "Bone Armor", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "6⛊", "stoneSlots": "0", "bonusChip": "", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Bone Fragments": {"qty": "8", "rep2": "NA"}, "Horn": {"qty": "8", "rep2": "NA"}, "Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {}}, {"name": "Tunic of the Wild", "city": "Strofa", "limitedTo": "Grigory, Kharzin, Pavel", "rating": "★★★", "type": "Armor", "statIncrease": "3⛊", "stoneSlots": "1", "bonusChip": "", "craftCost": "60", "sellPrice": "30", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "2", "rep2": "1"}, "Claw": {"qty": "4", "rep2": "2"}, "Bear Pelt": {"qty": "2", "rep2": "1"}, "Scales": {"qty": "1", "rep2": "1"}}, "wood": {}, "ores": {}}, {"name": "Tenebris Scale", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Grigory", "rating": "★★", "type": "Armor", "statIncrease": "5⛊", "stoneSlots": "3", "bonusChip": "🗡️⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Black Diamond x2", "speakingStoneRep": "NA", "materials": {"Scales": {"qty": "4", "rep2": "NA"}, "Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {}}, {"name": "Veteran's Coat", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Kharzin", "rating": "★★", "type": "Armor", "statIncrease": "5⛊", "stoneSlots": "3", "bonusChip": "🗡️⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Onyx", "speakingStoneRep": "", "materials": {"Animal Hide": {"qty": "4", "rep2": "NA"}, "Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {}}, {"name": "Brother's Keeper", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Pavel", "rating": "★★", "type": "Armor", "statIncrease": "5⛊", "stoneSlots": "3", "bonusChip": "🗡️⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Animal Hide": {"qty": "2", "rep2": "NA"}, "Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Diamond": {"qty": "4", "rep2": "NA"}}}, {"name": "Journey Attire", "city": "Ryba", "limitedTo": "Alek, Yury", "rating": "★★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "1", "bonusChip": "Evade", "craftCost": "42", "sellPrice": "21", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Bone Fragments": {"qty": "2", "rep2": "1"}, "Rough Leather": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Silver": {"qty": "2", "rep2": "1"}, "Crystal": {"qty": "2", "rep2": "1"}}}, {"name": "Zephyr's Tunic", "city": "Razdor", "limitedTo": "Alek, Yury", "rating": "★", "type": "Armor", "statIncrease": "3⛊", "stoneSlots": "3", "bonusChip": "Evade", "craftCost": "68", "sellPrice": "34", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Feathers": {"qty": "4", "rep2": "2"}, "Rough Leather": {"qty": "4", "rep2": "2"}}, "wood": {}, "ores": {"Crystal": {"qty": "2", "rep2": "1"}}}, {"name": "Stardust Jacket", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Alek", "rating": "★★", "type": "Armor", "statIncrease": "5⛊", "stoneSlots": "3", "bonusChip": "🗡️⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Diamond x3", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "4", "rep2": "NA"}, "Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {}}, {"name": "Brigandine", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Yury", "rating": "★★", "type": "Armor", "statIncrease": "5⛊", "stoneSlots": "3", "bonusChip": "🗡️⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Lapis Lazuli x2", "speakingStoneRep": "", "materials": {"Animal Hide": {"qty": "2", "rep2": "NA"}, "Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {}}, {"name": "Adventurer's Garb", "city": "Ryba", "limitedTo": "Catherine, Vera, Yana", "rating": "★★★", "type": "Armor", "statIncrease": "0⛊", "stoneSlots": "1", "bonusChip": "Evade x2", "craftCost": "42", "sellPrice": "21", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Bone Fragments": {"qty": "2", "rep2": "1"}, "Rough Leather": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Silver": {"qty": "2", "rep2": "1"}, "Crystal": {"qty": "2", "rep2": "1"}}}, {"name": "Hunter's Tunic", "city": "Silny", "limitedTo": "Catherine, Vera, Yana", "rating": "★★★", "type": "Armor", "statIncrease": "2⛊", "stoneSlots": "2", "bonusChip": "1 AP", "craftCost": "65", "sellPrice": "33", "luxCost": "-", "prerequisite": "Reinforced Tunic", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Wolf Pelt": {"qty": "2", "rep2": "1"}, "Animal Hide": {"qty": "2", "rep2": "1"}, "Bear Pelt": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {}}, {"name": "Red Scale Armor", "city": "Ft. Istra (The Misty Forge)", "limitedTo": "Catherine, Vera, Yana", "rating": "★★★★", "type": "Armor", "statIncrease": "3⛊", "stoneSlots": "3", "bonusChip": "❤︎", "craftCost": "85", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "Falmundian Rosehips x2", "speakingStone": "", "speakingStoneRep": "", "materials": {"Scales": {"qty": "2", "rep2": "NA"}}, "wood": {}, "ores": {"Crystal": {"qty": "4", "rep2": "NA"}}}, {"name": "Drakondor Armor", "city": "Vouno", "limitedTo": "Catherine, Vera, Yana", "rating": "★★★★", "type": "Armor", "statIncrease": "2⛊", "stoneSlots": "3", "bonusChip": "Evade", "craftCost": "68", "sellPrice": "34", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Feathers": {"qty": "4", "rep2": "2"}, "Rough Leather": {"qty": "2", "rep2": "1"}, "Claw": {"qty": "4", "rep2": "2"}, "Carapace": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Agate": {"qty": "4", "rep2": "2"}}}, {"name": "Wanderer of the Fields", "city": "Mir", "limitedTo": "Catherine, Vera, Yana", "rating": "★", "type": "Armor", "statIncrease": "3⛊", "stoneSlots": "2", "bonusChip": "🗡️⛊", "craftCost": "77", "sellPrice": "38", "luxCost": "-", "prerequisite": "Reinforced Tunic", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Carapace": {"qty": "4", "rep2": "2"}}, "wood": {}, "ores": {"Agate": {"qty": "4", "rep2": "2"}, "Crystal": {"qty": "2", "rep2": "1"}}}, {"name": "Scholar's Tunic", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Catherine", "rating": "★★", "type": "Armor", "statIncrease": "5⛊", "stoneSlots": "3", "bonusChip": "1 AP", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "Coastal Bluecaps x4", "speakingStone": "Topaz", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "4", "rep2": "NA"}, "Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {}}, {"name": "Crimson Vest", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Vera", "rating": "★★", "type": "Armor", "statIncrease": "5⛊", "stoneSlots": "3", "bonusChip": "🗡️⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Star Fragment", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "4", "rep2": "NA"}, "Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {}}, {"name": "Prophet's Jacket", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Yana", "rating": "★★", "type": "Armor", "statIncrease": "5⛊", "stoneSlots": "3", "bonusChip": "❤︎", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Aventurine", "speakingStoneRep": "", "materials": {"Wolf Pelt": {"qty": "4", "rep2": "NA"}, "Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Silver": {"qty": "4", "rep2": "NA"}}}, {"name": "Alloy Short Sword", "city": "Razdor, Ryba, Silny", "limitedTo": "", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": "", "craftCost": "12", "sellPrice": "6", "luxCost": "-", "prerequisite": "Iron Short Sword", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Metal Fragments": {"qty": "2", "rep2": "1"}}, "wood": {"Pine": {"qty": "2", "rep2": "1"}}, "ores": {}}, {"name": "Scaled Dagger", "city": "Ft. Istra (The Brothers' Anvil)", "limitedTo": "", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "1", "bonusChip": "Poison", "craftCost": "75", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Scales": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Silver": {"qty": "4", "rep2": "NA"}, "Gold": {"qty": "2", "rep2": "NA"}}}, {"name": "Relic Glove", "city": "Ft. Istra (The Brothers' Anvil)", "limitedTo": "", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "1", "bonusChip": "Stun", "craftCost": "55", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "Aquamarine", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {"Silver": {"qty": "8", "rep2": "NA"}, "Crystal": {"qty": "4", "rep2": "NA"}}}, {"name": "Bleeding Heart Dagger", "city": "Ft. Istra (The Brothers' Anvil)", "limitedTo": "", "rating": "★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "70", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "Garnet x2", "speakingStoneRep": "", "materials": {"Scales": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Silver": {"qty": "4", "rep2": "2"}, "Gold": {"qty": "2", "rep2": "1"}}}, {"name": "Volk Blade", "city": "Razdor, Silny", "limitedTo": "Grigory", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": "", "craftCost": "15", "sellPrice": "8", "luxCost": "-", "prerequisite": "Captain's Blade", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {"Pine": {"qty": "4", "rep2": "2"}}, "ores": {"Iron": {"qty": "2", "rep2": "1"}}}, {"name": "Argent Blade", "city": "Mir", "limitedTo": "Grigory", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "40", "sellPrice": "20", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Horn": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Iron": {"qty": "2", "rep2": "1"}, "Silver": {"qty": "4", "rep2": "2"}}}, {"name": "Radiance", "city": "Razdor", "limitedTo": "Grigory", "rating": "★★★★", "type": "Weapon", "statIncrease": "3👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "48", "sellPrice": "24", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Carapace": {"qty": "4", "rep2": "2"}}, "wood": {"Dogwood": {"qty": "2", "rep2": "1"}}, "ores": {"Silver": {"qty": "4", "rep2": "2"}, "Gold": {"qty": "4", "rep2": "2"}}}, {"name": "Lapis Blade", "city": "Ft. Istra (Blacksmith)", "limitedTo": "Grigory", "rating": "★", "type": "Weapon", "statIncrease": "4👊", "stoneSlots": "3", "bonusChip": "❤︎", "craftCost": "-", "sellPrice": "-", "luxCost": "50", "prerequisite": "", "itemRequired": "", "speakingStone": "Lapis Lazuli x2", "speakingStoneRep": "NA", "materials": {"Tenebris Shards": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Crystal": {"qty": "8", "rep2": "NA"}}}, {"name": "Sword of Isofar", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Grigory", "rating": "★★", "type": "Weapon", "statIncrease": "5👊", "stoneSlots": "3", "bonusChip": "🗡️⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Topaz x2", "speakingStoneRep": "NA", "materials": {"Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Diamond": {"qty": "8", "rep2": "NA"}}}, {"name": "Golden Scythe", "city": "Mir", "limitedTo": "Alek", "rating": "★★★", "type": "Weapon", "statIncrease": "3👊", "stoneSlots": "1", "bonusChip": "", "craftCost": "46", "sellPrice": "23", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {"Autumn Blaze": {"qty": "4", "rep2": "2"}}, "ores": {"Gold": {"qty": "4", "rep2": "2"}, "Agate": {"qty": "2", "rep2": "1"}}}, {"name": "Silver Flame", "city": "Vouno", "limitedTo": "Alek", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "36", "sellPrice": "18", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Horn": {"qty": "2", "rep2": "1"}}, "wood": {"Autumn Blaze": {"qty": "2", "rep2": "1"}}, "ores": {"Silver": {"qty": "4", "rep2": "2"}}}, {"name": "Swift Gale", "city": "Vouno", "limitedTo": "Alek", "rating": "★★★★", "type": "Weapon", "statIncrease": "3👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "48", "sellPrice": "24", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Carapace": {"qty": "2", "rep2": "1"}}, "wood": {"Dogwood": {"qty": "4", "rep2": "2"}}, "ores": {"Agate": {"qty": "4", "rep2": "2"}}}, {"name": "Star Blade", "city": "Ft. Istra (Blacksmith)", "limitedTo": "Alek", "rating": "★", "type": "Weapon", "statIncrease": "5👊", "stoneSlots": "3", "bonusChip": "", "craftCost": "-", "sellPrice": "-", "luxCost": "50", "prerequisite": "", "itemRequired": "", "speakingStone": "Star Fragment", "speakingStoneRep": "NA", "materials": {"Tenebris Shards": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Crystal": {"qty": "8", "rep2": "NA"}}}, {"name": "Jade Sword", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Alek", "rating": "★★", "type": "Weapon", "statIncrease": "6👊", "stoneSlots": "3", "bonusChip": "", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Peridot x2", "speakingStoneRep": "NA", "materials": {"Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Diamond": {"qty": "4", "rep2": "NA"}}}, {"name": "Sword of Truth", "city": "Strofa", "limitedTo": "Catherine", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": "🗡️🗡️", "craftCost": "30", "sellPrice": "15", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Metal Fragments": {"qty": "3", "rep2": "2"}}, "wood": {"Rosewood": {"qty": "2", "rep2": "1"}}, "ores": {"Iron": {"qty": "4", "rep2": "2"}}}, {"name": "Euphonic Edge", "city": "Razdor", "limitedTo": "Catherine", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "36", "sellPrice": "18", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Scales": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Silver": {"qty": "4", "rep2": "2"}, "Gold": {"qty": "2", "rep2": "1"}}}, {"name": "Sky Splitter", "city": "Razdor", "limitedTo": "Catherine", "rating": "★★★★", "type": "Weapon", "statIncrease": "3👊", "stoneSlots": "3", "bonusChip": "", "craftCost": "40", "sellPrice": "20", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Carapace": {"qty": "3", "rep2": "2"}}, "wood": {}, "ores": {"Agate": {"qty": "4", "rep2": "2"}}}, {"name": "Glorious", "city": "Ft. Istra (Blacksmith)", "limitedTo": "Catherine", "rating": "★", "type": "Weapon", "statIncrease": "4👊", "stoneSlots": "3", "bonusChip": "⛊⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "50", "prerequisite": "", "itemRequired": "", "speakingStone": "Star Quartz x2", "speakingStoneRep": "NA", "materials": {"Tenebris Shards": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Diamond": {"qty": "8", "rep2": "NA"}}}, {"name": "Revelation", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Catherine", "rating": "★★", "type": "Weapon", "statIncrease": "5👊", "stoneSlots": "3", "bonusChip": "Poison", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Coral", "speakingStoneRep": "", "materials": {"Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Gold": {"qty": "8", "rep2": "NA"}, "Diamond": {"qty": "4", "rep2": "NA"}}}, {"name": "Alloy Hand Axes", "city": "Ryba", "limitedTo": "Yury", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": "", "craftCost": "12", "sellPrice": "6", "luxCost": "-", "prerequisite": "Iron Hand Axes", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {"Ash": {"qty": "4", "rep2": "2"}}, "ores": {"Silver": {"qty": "2", "rep2": "1"}}}, {"name": "Ornate Cleavers", "city": "Silny", "limitedTo": "Yury", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "34", "sellPrice": "17", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Horn": {"qty": "2", "rep2": "1"}}, "wood": {"Autumn Blaze": {"qty": "4", "rep2": "2"}}, "ores": {"Iron": {"qty": "2", "rep2": "1"}, "Silver": {"qty": "2", "rep2": "1"}}}, {"name": "Reckoning Tides", "city": "Ryba", "limitedTo": "Yury", "rating": "★★★★", "type": "Weapon", "statIncrease": "3👊", "stoneSlots": "2", "bonusChip": "❤︎", "craftCost": "48", "sellPrice": "24", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Tenebris Shards": {"qty": "2", "rep2": "1"}}, "wood": {"Dogwood": {"qty": "2", "rep2": "1"}}, "ores": {"Agate": {"qty": "4", "rep2": "2"}}}, {"name": "Dangerous Duo", "city": "Ft. Istra (Blacksmith)", "limitedTo": "Yury", "rating": "★", "type": "Weapon", "statIncrease": "4👊", "stoneSlots": "3", "bonusChip": "🗡️🗡️", "craftCost": "-", "sellPrice": "-", "luxCost": "50", "prerequisite": "", "itemRequired": "", "speakingStone": "Carnelian x2", "speakingStoneRep": "NA", "materials": {"Tenebris Shards": {"qty": "4", "rep2": "NA"}}, "wood": {"Ancient Oak": {"qty": "4", "rep2": "NA"}}, "ores": {"Diamond": {"qty": "4", "rep2": "NA"}}}, {"name": "Wind Cutters", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Yury", "rating": "★★", "type": "Weapon", "statIncrease": "5👊", "stoneSlots": "3", "bonusChip": "1 AP", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Aventuring x2", "speakingStoneRep": "", "materials": {"Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {"Ancient Oak": {"qty": "4", "rep2": "NA"}}, "ores": {"Diamond": {"qty": "4", "rep2": "NA"}}}, {"name": "Hunter's Spear", "city": "Mir", "limitedTo": "Kharzin", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": "", "craftCost": "20", "sellPrice": "10", "luxCost": "-", "prerequisite": "Guard's Spear", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {"Pine": {"qty": "4", "rep2": "2"}}, "ores": {"Iron": {"qty": "4", "rep2": "2"}}}, {"name": "Partisan", "city": "Strofa", "limitedTo": "Kharzin", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "44", "sellPrice": "22", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Horn": {"qty": "2", "rep2": "1"}}, "wood": {"Ash": {"qty": "4", "rep2": "2"}}, "ores": {"Silver": {"qty": "2", "rep2": "1"}}}, {"name": "Ryban Glaive", "city": "Ryba", "limitedTo": "Kharzin", "rating": "★★★★", "type": "Weapon", "statIncrease": "3👊", "stoneSlots": "2", "bonusChip": "🗡️🗡️", "craftCost": "48", "sellPrice": "24", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Carapace": {"qty": "2", "rep2": "1"}, "Tenebris Shards": {"qty": "4", "rep2": "2"}}, "wood": {"Cedar": {"qty": "2", "rep2": "1"}}, "ores": {"Agate": {"qty": "2", "rep2": "1"}}}, {"name": "Cerulean Pike", "city": "Ft. Istra (Blacksmith)", "limitedTo": "Kharzin", "rating": "★", "type": "Weapon", "statIncrease": "4👊", "stoneSlots": "3", "bonusChip": "❤︎", "craftCost": "-", "sellPrice": "-", "luxCost": "50", "prerequisite": "", "itemRequired": "", "speakingStone": "Lapis Lazuli x2", "speakingStoneRep": "NA", "materials": {"Tenebris Shards": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Crystal": {"qty": "4", "rep2": "NA"}}}, {"name": "Guardian Lance", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Kharzin", "rating": "★★", "type": "Weapon", "statIncrease": "5👊", "stoneSlots": "3", "bonusChip": "⛊⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Star Quartz x4", "speakingStoneRep": "NA", "materials": {"Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Diamond": {"qty": "4", "rep2": "NA"}}}, {"name": "Falmundian Bow", "city": "Razdor", "limitedTo": "Vera", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": "", "craftCost": "12", "sellPrice": "6", "luxCost": "-", "prerequisite": "Long Bow", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {"Ash": {"qty": "4", "rep2": "2"}}, "ores": {"Iron": {"qty": "2", "rep2": "1"}}}, {"name": "Silver Bow", "city": "Vouno", "limitedTo": "Vera", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "40", "sellPrice": "20", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Horn": {"qty": "2", "rep2": "1"}}, "wood": {"Autumn Blaze": {"qty": "2", "rep2": "1"}, "Dogwood": {"qty": "1", "rep2": "1"}}, "ores": {"Silver": {"qty": "4", "rep2": "2"}}}, {"name": "Hunter's Pride", "city": "Strofa", "limitedTo": "Vera", "rating": "★★★★", "type": "Weapon", "statIncrease": "3👊", "stoneSlots": "2", "bonusChip": "🗡️🗡️", "craftCost": "56", "sellPrice": "28", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Scales": {"qty": "4", "rep2": "2"}}, "wood": {}, "ores": {"Gold": {"qty": "4", "rep2": "2"}, "Agate": {"qty": "2", "rep2": "1"}}}, {"name": "Drakonbow", "city": "Ft. Istra (Blacksmith)", "limitedTo": "Vera", "rating": "★", "type": "Weapon", "statIncrease": "4👊", "stoneSlots": "3", "bonusChip": "Evade", "craftCost": "-", "sellPrice": "-", "luxCost": "50", "prerequisite": "", "itemRequired": "", "speakingStone": "Diamond x2", "speakingStoneRep": "NA", "materials": {"Tenebris Shards": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Crystal": {"qty": "4", "rep2": "NA"}}}, {"name": "Vanguard's Promise", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Vera", "rating": "★★", "type": "Weapon", "statIncrease": "5👊", "stoneSlots": "3", "bonusChip": "1 AP", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Black Diamond x3", "speakingStoneRep": "NA", "materials": {"Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Diamond": {"qty": "4", "rep2": "NA"}}}, {"name": "Silver Hammer", "city": "Vouno", "limitedTo": "Pavel", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": "", "craftCost": "18", "sellPrice": "9", "luxCost": "-", "prerequisite": "Iron Hammer", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {"Rosewood": {"qty": "2", "rep2": "1"}}, "ores": {"Silver": {"qty": "4", "rep2": "2"}}}, {"name": "Alloy Driver", "city": "Mir", "limitedTo": "Pavel", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "34", "sellPrice": "17", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Horn": {"qty": "2", "rep2": "1"}}, "wood": {"Autumn Blaze": {"qty": "4", "rep2": "2"}}, "ores": {"Silver": {"qty": "4", "rep2": "2"}, "Gold": {"qty": "4", "rep2": "2"}}}, {"name": "Golden Mallet", "city": "Strofa", "limitedTo": "Pavel", "rating": "★★★★", "type": "Weapon", "statIncrease": "3👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "60", "sellPrice": "30", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Carapace": {"qty": "2", "rep2": "1"}}, "wood": {"Dogwood": {"qty": "4", "rep2": "2"}}, "ores": {"Gold": {"qty": "4", "rep2": "2"}, "Agate": {"qty": "2", "rep2": "1"}}}, {"name": "Ground Shaker", "city": "Ft. Istra (Blacksmith)", "limitedTo": "Pavel", "rating": "★", "type": "Weapon", "statIncrease": "4👊", "stoneSlots": "3", "bonusChip": "", "craftCost": "-", "sellPrice": "-", "luxCost": "50", "prerequisite": "", "itemRequired": "", "speakingStone": "Diamond x2", "speakingStoneRep": "NA", "materials": {"Tenebris Shards": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Diamond": {"qty": "8", "rep2": "NA"}}}, {"name": "Final Wish", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Pavel", "rating": "★★", "type": "Weapon", "statIncrease": "5👊", "stoneSlots": "3", "bonusChip": "🗡️⛊", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Topaz", "speakingStoneRep": "", "materials": {}, "wood": {"Ancient Oak": {"qty": "4", "rep2": ""}}, "ores": {"Gold": {"qty": "8", "rep2": "NA"}}}, {"name": "Cerulean Staff", "city": "Silny", "limitedTo": "Yana", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": "", "craftCost": "20", "sellPrice": "10", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "Aquamarine", "speakingStoneRep": "None", "materials": {}, "wood": {"Pine": {"qty": "4", "rep2": "2"}}, "ores": {}}, {"name": "Rosewind Staff", "city": "Razdor", "limitedTo": "Yana", "rating": "★★★", "type": "Weapon", "statIncrease": "2👊", "stoneSlots": "2", "bonusChip": "", "craftCost": "40", "sellPrice": "20", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "Jade", "speakingStoneRep": "None", "materials": {"Scales": {"qty": "4", "rep2": "2"}}, "wood": {"Autumn Blaze": {"qty": "2", "rep2": "1"}}, "ores": {"Silver": {"qty": "2", "rep2": "1"}}}, {"name": "Forteller's Staff", "city": "Vouno", "limitedTo": "Yana", "rating": "★★★★", "type": "Weapon", "statIncrease": "3👊", "stoneSlots": "3", "bonusChip": "🗡️🗡️", "craftCost": "56", "sellPrice": "28", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "Garnet", "speakingStoneRep": "None", "materials": {"Tenebris Shards": {"qty": "4", "rep2": "2"}}, "wood": {"Dogwood": {"qty": "4", "rep2": "2"}}, "ores": {}}, {"name": "Contorted Staff", "city": "Ft. Istra (Blacksmith)", "limitedTo": "Yana", "rating": "★", "type": "Weapon", "statIncrease": "4👊", "stoneSlots": "3", "bonusChip": "❤︎", "craftCost": "-", "sellPrice": "-", "luxCost": "50", "prerequisite": "", "itemRequired": "", "speakingStone": "Black Diamond x2", "speakingStoneRep": "NA", "materials": {"Tenebris Shards": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Crystal": {"qty": "8", "rep2": "NA"}}}, {"name": "Magi's Command", "city": "Ft. Istra (Baren's Forge)", "limitedTo": "Yana", "rating": "★★", "type": "Weapon", "statIncrease": "5👊", "stoneSlots": "3", "bonusChip": "1 AP", "craftCost": "-", "sellPrice": "-", "luxCost": "75", "prerequisite": "", "itemRequired": "", "speakingStone": "Carnelian x2", "speakingStoneRep": "NA", "materials": {"Tenebris Skull": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Diamond": {"qty": "8", "rep2": "NA"}}}], "accessories": [{"name": "Aegis Shield", "city": "Ft. Istra (Anvil Artistry)", "type": "Accessory", "usableInField": "", "effect": "Each time a ⛊⛊ is drawn by this Guard, add ⛊+1 to bag.", "craftCost": "50", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {"Cedar": {"qty": "2", "rep2": "NA"}, "Ancient Oak": {"qty": "4", "rep2": "NA"}}, "ores": {"Agate": {"qty": "4", "rep2": "NA"}}}, {"name": "Barrier Tonic", "city": "Ft. Istra (Apothecary)", "type": "Item", "usableInField": "Yes", "effect": "Add 5 ⛊+1 to both bags.", "craftCost": "-", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "Coastal Bluecaps, Midnight Hydrangea", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {}}, {"name": "Bottled Courage", "city": "Ft. Istra (Apothecary)", "type": "Item", "usableInField": "", "effect": "This Guard gains 2 👊+1 and 2 blue defense cubes.", "craftCost": "-", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "Coastal Bluecaps, Falmundia Rosehips", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {}}, {"name": "Carapace Helmet", "city": "Vouno", "type": "Accessory", "usableInField": "", "effect": "Immune to red stun, and AP may not be exhausted by enemies.", "craftCost": "28", "sellPrice": "14", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Carapace": {"qty": "1", "rep2": "1"}}, "wood": {}, "ores": {"Agate": {"qty": "2", "rep2": "1"}}}, {"name": "Chrono Locket", "city": "Ft. Istra (The Cottage Smith)", "type": "Accessory", "usableInField": "", "effect": "Look through AI draw deck of 1 enemy, and choose 1 card to place on top. Shuffle remaining cards of draw pile.", "craftCost": "85", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "Ancient Roots x2", "speakingStoneRep": "", "materials": {"Metal Fragments": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Gold": {"qty": "4", "rep2": "NA"}}}, {"name": "Chronos Boots", "city": "Ft. Istra (The Cottage Smith)", "type": "Accessory", "usableInField": "", "effect": "Each time a 🗡️⛊ chip is drawn, gain Evade.", "craftCost": "55", "sellPrice": "-", "luxCost": "-", "prerequisite": "Traveling Boots", "itemRequired": "", "speakingStone": "Jade x2", "speakingStoneRep": "", "materials": {"Animal Hide": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {}}, {"name": "Cleansing Amulet", "city": "Ft. Istra (Anvil Artistry)", "type": "Accessory", "usableInField": "", "effect": "Remove 1 Green AP from this Guard to remove 1 negative chip from both Guards' bags", "craftCost": "75", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "Jade x2", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {"Silver": {"qty": "2", "rep2": "NA"}}}, {"name": "Concealing Cloak", "city": "Razdor", "type": "Accessory", "usableInField": "", "effect": "While equipped, add 1 Evasion Chip to the event bag. Chip acts as another Compass Chip if drawn.", "craftCost": "20", "sellPrice": "10", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {}}, {"name": "Expanded Satchel", "city": "Strofa", "type": "Item", "usableInField": "", "effect": "Equip to satchel slot. Store up to 4 cards underneath this card.", "craftCost": "10", "sellPrice": "5", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "4", "rep2": "2"}}, "wood": {}, "ores": {}}, {"name": "Feathered Mantle", "city": "Strofa", "type": "Accessory", "usableInField": "", "effect": "While equipped, add 1 purple Evasion Chip to Guard's bag.", "craftCost": "30", "sellPrice": "15", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Feathers": {"qty": "4", "rep2": "2"}, "Rough Leather": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {}}, {"name": "Goat Skull Mask", "city": "Strofa", "type": "Accessory", "usableInField": "", "effect": "Once per turn, you may redraw 1 drawn chip.", "craftCost": "15", "sellPrice": "10", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "1", "rep2": "1"}}, "wood": {}, "ores": {}}, {"name": "Invigorating Potion", "city": "Ft. Istra (Apothecary)", "type": "Item", "usableInField": "", "effect": "Gain 2 green AP.", "craftCost": "-", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "Midnight Hydrangea, Purifying Seed", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {}}, {"name": "Leather Gauntlets", "city": "Mir", "type": "Accessory", "usableInField": "", "effect": "At the start of battle, add 1 👊+1 to Guard's bag.", "craftCost": "14", "sellPrice": "7", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "4", "rep2": "2"}, "Claw": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {}}, {"name": "Leather Gauntlets", "city": "Ft. Istra (The Brothers' Anvil)", "type": "Accessory", "usableInField": "", "effect": "At the start of battle, add 1 👊+1 to Guard's bag.", "craftCost": "10", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "2", "rep2": "NA"}, "Claw": {"qty": "1", "rep2": "NA"}}, "wood": {}, "ores": {}}, {"name": "Nomad's Trap", "city": "Silny", "type": "Accessory", "usableInField": "", "effect": "After an enemy attacks, that enemy exhausts 1 AP.", "craftCost": "10", "sellPrice": "5", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Metal Fragments": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Iron": {"qty": "4", "rep2": "2"}, "Silver": {"qty": "4", "rep2": "2"}}}, {"name": "Pendant of Wisdom", "city": "Ft. Istra (Anvil Artistry)", "type": "Accessory", "usableInField": "", "effect": "While equipped gain 3 stone slots.", "craftCost": "80", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {"Gold": {"qty": "4", "rep2": "NA"}, "Agate": {"qty": "4", "rep2": "NA"}, "Crystal": {"qty": "4", "rep2": "NA"}}}, {"name": "Power Belt", "city": "Ft. Istra (The Cottage Smith)", "type": "Accessory", "usableInField": "", "effect": "Each time a Yellow Stonebound ability is activated, add 1 👊+1 to Guard's bag.", "craftCost": "70", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "Adamant x2", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "4", "rep2": "NA"}}, "wood": {}, "ores": {"Gold": {"qty": "2", "rep2": "NA"}}}, {"name": "Purifying Dust", "city": "Ft. Istra (Apothecary)", "type": "Item", "usableInField": "Yes", "effect": "Remove all negative chips from both bags.", "craftCost": "", "sellPrice": "", "luxCost": "", "prerequisite": "", "itemRequired": "Purifying Seed x2", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {}}, {"name": "Ruinous Dust", "city": "Ft. Istra (Apothecary)", "type": "Item", "usableInField": "", "effect": "Add 2 ⛊-1 to all enemies.", "craftCost": "", "sellPrice": "", "luxCost": "", "prerequisite": "", "itemRequired": "Ruinous Seed x2", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {}}, {"name": "Scale Shield", "city": "Ft. Istra (The Misty Forge)", "type": "Accessory", "usableInField": "", "effect": "At the start of battle, add 3 ⛊+1 to Guard's bag.", "craftCost": "45", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Scales": {"qty": "2", "rep2": "NA"}}, "wood": {}, "ores": {"Iron": {"qty": "4", "rep2": "NA"}, "Silver": {"qty": "2", "rep2": "NA"}}}, {"name": "Scale Shield", "city": "Ryba", "type": "Accessory", "usableInField": "", "effect": "At the start of battle, add 3 ⛊+1 to Guard's bag.", "craftCost": "36", "sellPrice": "18", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Scales": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Iron": {"qty": "4", "rep2": "2"}, "Silver": {"qty": "2", "rep2": "1"}}}, {"name": "Smoke Bomb", "city": "Silny, Strofa", "type": "Item", "usableInField": "", "effect": "Both Guards gain 2 Evasion Chips.", "craftCost": "10STROFA, 8SILNY", "sellPrice": "5STROFA, 4SILNY", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Metal Fragments": {"qty": "1", "rep2": "1"}}, "wood": {}, "ores": {"Iron": {"qty": "2", "rep2": "1"}}}, {"name": "Stonebound Talisman", "city": "Ft. Istra (Anvil Artistry)", "type": "Accessory", "usableInField": "", "effect": "Whenever this Guard activates a Stonebound ability, heal ally by 1 ❤︎.", "craftCost": "50", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {"Gold": {"qty": "4", "rep2": "NA"}, "Crystal": {"qty": "4", "rep2": "NA"}, "Diamond": {"qty": "4", "rep2": "NA"}}}, {"name": "Tent", "city": "Silny, Strofa", "type": "Item", "usableInField": "", "effect": "Create a save point at current node and heal both Guards by 10 ❤︎.", "craftCost": "15STROFA, 10SILNY", "sellPrice": "7STROFA, 5SILNY", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Animal Hide": {"qty": "1", "rep2": "1"}}, "wood": {"Rosewood": {"qty": "2", "rep2": "1"}}, "ores": {}}, {"name": "Traveling Boots", "city": "Mir", "type": "Accessory", "usableInField": "", "effect": "During the exploration phase, you may mulligan once per node.", "craftCost": "8", "sellPrice": "4", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Iron": {"qty": "1", "rep2": "1"}}}, {"name": "Traveling Boots", "city": "Ft. Istra (The Cottage Smith)", "type": "Accessory", "usableInField": "", "effect": "During the exploration phase, you may mulligan once per node.", "craftCost": "5", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Rough Leather": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Iron": {"qty": "1", "rep2": "NA"}}}, {"name": "Twilight Guantlet", "city": "Ft. Istra (The Brothers' Anvil)", "type": "Accessory", "usableInField": "", "effect": "Standard attacks heal this Guard by 1 ❤︎.", "craftCost": "40", "sellPrice": "-", "luxCost": "-", "prerequisite": "Leather Gauntlets", "itemRequired": "", "speakingStone": "Obsidian", "speakingStoneRep": "", "materials": {}, "wood": {}, "ores": {"Agate": {"qty": "4", "rep2": "NA"}}}, {"name": "Wolf Head Tunic", "city": "Silny", "type": "Accessory", "usableInField": "", "effect": "At the start of battle, add 1 Bolster chip to Guard's bag.", "craftCost": "10", "sellPrice": "5", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Wolf Pelt": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {}}, {"name": "Wolf Tooth Ring", "city": "Ryba, Silny", "type": "Accessory", "usableInField": "", "effect": "Negate 2 red chips per battle.", "craftCost": "8", "sellPrice": "4", "luxCost": "-", "prerequisite": "", "itemRequired": "", "speakingStone": "", "speakingStoneRep": "", "materials": {"Metal Fragments": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Silver": {"qty": "2", "rep2": "1"}}}, {"name": "Zoya's Elixir", "city": "Ft. Istra (Apothecary)", "type": "Item", "usableInField": "Yes", "effect": "Add 5 green ❤︎ to this Guard's bag.", "craftCost": "-", "sellPrice": "-", "luxCost": "-", "prerequisite": "", "itemRequired": "Midnight Hydrangea, Health Potion", "speakingStone": "", "speakingStoneRep": "", "materials": {"Metal Fragments": {"qty": "2", "rep2": "1"}}, "wood": {}, "ores": {"Silver": {"qty": "2", "rep2": "1"}}}], "market": [{"name": "Animal Hide", "effect": "Used in crafting", "prices": {"Strofa": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Vouno": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Fort Istra Apothecary": {"buy": "4", "buy2Rep": "", "sell": ""}}}, {"name": "Bear Pelt", "effect": "Used in crafting", "prices": {"Silny": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Vouno": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Fort Istra Apothecary": {"buy": "4", "buy2Rep": "", "sell": ""}}}, {"name": "Bone Fragments", "effect": "Used in crafting", "prices": {"Mir": {"buy": "8", "buy2Rep": "4", "sell": "4"}, "Vouno": {"buy": "8", "buy2Rep": "4", "sell": "4"}, "Fort Istra Apothecary": {"buy": "2", "buy2Rep": "", "sell": ""}}}, {"name": "Carapace", "effect": "Used in crafting", "prices": {"Fort Istra Apothecary": {"buy": "10", "buy2Rep": "", "sell": ""}}}, {"name": "Claw", "effect": "Used in crafting", "prices": {"Razdor": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Strofa": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Fort Istra Apothecary": {"buy": "4", "buy2Rep": "", "sell": ""}}}, {"name": "Feathers", "effect": "Used in crafting", "prices": {"Silny": {"buy": "60", "buy2Rep": "30", "sell": "30"}, "Fort Istra Apothecary": {"buy": "2", "buy2Rep": "", "sell": ""}}}, {"name": "Horn", "effect": "Used in crafting", "prices": {"Razdor": {"buy": "-", "buy2Rep": "-", "sell": "20"}, "Vouno": {"buy": "-", "buy2Rep": "-", "sell": "8"}, "Fort Istra Apothecary": {"buy": "6", "buy2Rep": "", "sell": ""}}}, {"name": "Metal Fragments", "effect": "Used in crafting", "prices": {"Mir": {"buy": "-", "buy2Rep": "-", "sell": "10"}, "Silny": {"buy": "-", "buy2Rep": "-", "sell": "5"}, "Fort Istra Apothecary": {"buy": "-", "buy2Rep": "", "sell": ""}}}, {"name": "Rough Leather", "effect": "Used in crafting", "prices": {"Mir": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Strofa": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Fort Istra Apothecary": {"buy": "4", "buy2Rep": "", "sell": ""}}}, {"name": "Scales", "effect": "Used in crafting", "prices": {"Fort Istra Apothecary": {"buy": "8", "buy2Rep": "", "sell": ""}}}, {"name": "Spines", "effect": "Used in crafting", "prices": {"Razdor": {"buy": "-", "buy2Rep": "-", "sell": "20"}, "Vouno": {"buy": "-", "buy2Rep": "-", "sell": "8"}, "Fort Istra Apothecary": {"buy": "6", "buy2Rep": "", "sell": ""}}}, {"name": "Tenebris Shards", "effect": "Used in crafting", "prices": {"Fort Istra Apothecary": {"buy": "10", "buy2Rep": "", "sell": ""}}}, {"name": "Tenebris Skull", "effect": "Used in crafting", "prices": {"Fort Istra Apothecary": {"buy": "15", "buy2Rep": "", "sell": ""}}}, {"name": "Wolf Pelt", "effect": "Used in crafting", "prices": {"Razdor": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Silny": {"buy": "8", "buy2Rep": "4", "sell": "4"}, "Strofa": {"buy": "16", "buy2Rep": "8", "sell": "8"}, "Fort Istra Apothecary": {"buy": "2", "buy2Rep": "", "sell": ""}}}, {"name": "Amethyst Trout", "effect": "Heal 5 ❤︎ and draw 2 purple chips from bag", "prices": {"Ryba": {"buy": "25", "buy2Rep": "15", "sell": "10"}}}, {"name": "Dusk Tuna", "effect": "Heal 3 ❤︎ and draw 3 chips", "prices": {"Ryba": {"buy": "15", "buy2Rep": "10", "sell": "10"}}}, {"name": "Emerald Koi", "effect": "Heal 3 ❤︎ and gain 1 🟦 cube", "prices": {"Ryba": {"buy": "20", "buy2Rep": "10", "sell": "10"}}}, {"name": "Foxtail Carp", "effect": "Heal 3 ❤︎ and remove up to 2 red chips from bag", "prices": {"Ryba": {"buy": "20", "buy2Rep": "10", "sell": "10"}}}, {"name": "Health Potion", "effect": "Heal 5 ❤︎", "prices": {"Mir": {"buy": "5", "buy2Rep": "5", "sell": "2"}, "Razdor": {"buy": "5", "buy2Rep": "5", "sell": "2"}, "Ryba": {"buy": "5", "buy2Rep": "5", "sell": "2"}, "Silny": {"buy": "5", "buy2Rep": "5", "sell": "2"}, "Strofa": {"buy": "10", "buy2Rep": "10", "sell": "5"}, "Vouno": {"buy": "10", "buy2Rep": "10", "sell": "5"}}}, {"name": "Mir Bread", "effect": "Heal 3 ❤︎ and gain 3 🟦 cubes", "prices": {"Mir": {"buy": "5", "buy2Rep": "5", "sell": "2"}}}, {"name": "Ryba Blue Fins", "effect": "Heal 7 ❤︎", "prices": {"Ryba": {"buy": "10", "buy2Rep": "10", "sell": "5"}}}, {"name": "Clayhorn Steak", "effect": "Add 2 👊+1 to bag", "prices": {"Razdor": {"buy": "5", "buy2Rep": "5", "sell": "2"}}}, {"name": "Golden Potato", "effect": "Add 2 ⛊+1 to bag", "prices": {"Mir": {"buy": "5", "buy2Rep": "5", "sell": "2"}}}, {"name": "Tent", "effect": "Create a save point at current node and heal both Guards by 10 ❤︎", "prices": {"Silny": {"buy": "20", "buy2Rep": "10", "sell": "10"}, "Strofa": {"buy": "30", "buy2Rep": "15", "sell": "15"}}}], "buildings": [{"name": "Lumbermill", "itemRequired": "", "wood": {"Pine": "4"}, "ores": {}}, {"name": "Lumbermill (Upgraded)", "itemRequired": "", "wood": {"Ash": "4", "Dogwood": "4", "Ancient Oak": "4"}, "ores": {"Iron": "4", "Silver": "4"}}, {"name": "Boat Dock", "itemRequired": "", "wood": {"Cedar": "4"}, "ores": {"Iron": "4"}}, {"name": "Boat Dock (Upgraded)", "itemRequired": "", "wood": {"Pine": "4", "Autumn Blaze": "4", "Cherry": "4"}, "ores": {"Iron": "4", "Agate": "4"}}, {"name": "Barracks", "itemRequired": "", "wood": {"Pine": "4"}, "ores": {"Iron": "4"}}, {"name": "Barracks (Upgraded)", "itemRequired": "", "wood": {"Ash": "4", "Ancient Oak": "4"}, "ores": {"Iron": "4", "Agate": "4", "Crystal": "4"}}, {"name": "Training Yard", "itemRequired": "", "wood": {"Ancient Oak": "4"}, "ores": {"Gold": "4"}}, {"name": "Training Yard (Upgraded)", "itemRequired": "", "wood": {}, "ores": {"Agate": "4", "Crystal": "4", "Diamond": "4"}}, {"name": "Blacksmith", "itemRequired": "1x Feathers, 1x Scales", "wood": {"Cedar": "4"}, "ores": {"Iron": "4", "Gold": "4"}}, {"name": "Baren's Forge", "itemRequired": "1x Broken Blade", "wood": {"Cedar": "4"}, "ores": {"Iron": "4", "Gold": "4"}}, {"name": "Apothecary", "itemRequired": "", "wood": {"Rosewood": "4", "Ash": "4", "Autumn Blaze": "4"}, "ores": {"Agate": "4"}}, {"name": "Zoya's Shop", "itemRequired": "", "wood": {"Cherry": "4", "Ancient Oak": "4"}, "ores": {"Crystal": "4", "Diamond": "4"}}, {"name": "Lapidary", "itemRequired": "", "wood": {"Cedar": "4"}, "ores": {"Iron": "4"}}, {"name": "Lapidary (Upgraded)", "itemRequired": "", "wood": {"Cherry": "4", "Ancient Oak": "4"}, "ores": {"Agate": "4", "Crystal": "4", "Diamond": "4"}}], "harvestLocations": {"Pine": "17, 86, 98", "Rosewood": "86", "Ash": "45", "Autumn Blaze": "71", "Dogwood": "25", "Cedar": "41", "Cherry": "71", "Ancient Oak": "17", "Iron": "15, 88", "Silver": "24, 34", "Gold": "29", "Agate": "2", "Crystal": "Ice Caves: Crystal Vein", "Diamond": "Frozen Wastes: Diamond Vein"}, "resourceLuxCosts": {"Pine": "8", "Rosewood": "10", "Ash": "18", "Autumn Blaze": "12", "Dogwood": "20", "Cedar": "16", "Cherry": "14", "Ancient Oak": "30", "Iron": "10", "Silver": "12", "Gold": "14", "Agate": "20", "Crystal": "30", "Diamond": "40"}, "speakingStones": [{"name": "Adamant", "available": "4", "element": "Neutral", "color": "Yellow", "bonus": "⛊⛊", "lapidaryExchange": ""}, {"name": "Ancient Roots", "available": "4", "element": "Earth", "color": "Orange", "bonus": "❤︎+1", "lapidaryExchange": ""}, {"name": "Aquamarine", "available": "4", "element": "Water", "color": "Blue", "bonus": "❤︎", "lapidaryExchange": ""}, {"name": "Aventurine", "available": "4", "element": "Wind", "color": "Green", "bonus": "1 AP", "lapidaryExchange": "Jade x2"}, {"name": "Black Diamond", "available": "4", "element": "Darkness", "color": "Purple", "bonus": "🗡️⛊ ; 🗡️⛊", "lapidaryExchange": "Obsidian x2"}, {"name": "Carnelian", "available": "4", "element": "Fire", "color": "Red", "bonus": "🗡️🗡️ ; 🗡️🗡️", "lapidaryExchange": "Garnet x2"}, {"name": "Diamond", "available": "4", "element": "Neutral", "color": "Yellow", "bonus": "⛊⛊ ; ⛊⛊", "lapidaryExchange": "Adamant x2"}, {"name": "Garnet", "available": "4", "element": "Fire", "color": "Red", "bonus": "🗡️🗡️", "lapidaryExchange": ""}, {"name": "Jade", "available": "4", "element": "Wind", "color": "Green", "bonus": "Evade", "lapidaryExchange": ""}, {"name": "Lapis Lazuli", "available": "4", "element": "Water", "color": "Blue", "bonus": "❤︎ ; ❤︎", "lapidaryExchange": "Aquamarine x2"}, {"name": "Obsidian", "available": "4", "element": "Darkness", "color": "Purple", "bonus": "🗡️⛊", "lapidaryExchange": ""}, {"name": "Orichalcum", "available": "4", "element": "Light", "color": "White", "bonus": "🗡️🗡️ ; 🗡️🗡️ ; ⛊⛊ ; ⛊⛊", "lapidaryExchange": ""}, {"name": "Rainbow Obsidian", "available": "4", "element": "Rainbow", "color": "Any color", "bonus": "🗡️🗡️ ; 🗡️🗡️ ; ⛊⛊ ; ⛊⛊ ; 🗡️⛊ ; 🗡️⛊", "lapidaryExchange": ""}, {"name": "Star Fragment", "available": "4", "element": "Light", "color": "White", "bonus": "🗡️🗡️ ; ⛊⛊", "lapidaryExchange": ""}, {"name": "Star Quartz", "available": "4", "element": "Earth", "color": "Orange", "bonus": "❤︎+2", "lapidaryExchange": "Ancient Roots x2"}], "prereqChains": [[{"name": "Blacksmith Prerequisites", "city": "City", "limitedTo": "Limited To", "rating": "Rating", "type": "Type", "statIncrease": "Stat Increase Rating", "stoneSlots": "Stonebound Slots", "bonusChip": "Bonus Chip"}, {"name": "Guard's Tunic", "city": "Mir", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "0⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Reinforced Tunic", "city": "Razdor, Ryba, Silny", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "1", "bonusChip": ""}], [{"name": "Guard's Tunic", "city": "Mir", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "0⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Reinforced Tunic", "city": "Razdor, Ryba, Silny", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Bear Tunic", "city": "Silny, Strofa", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "2", "bonusChip": ""}], [{"name": "Guard's Tunic", "city": "Mir", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "0⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Reinforced Tunic", "city": "Razdor, Ryba, Silny", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Hunter's Tunic", "city": "Silny", "limitedTo": "Catherine, Vera, Yana", "rating": "★★★", "type": "Armor", "statIncrease": "2⛊", "stoneSlots": "2", "bonusChip": "1 AP"}], [{"name": "Guard's Tunic", "city": "Mir", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "0⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Reinforced Tunic", "city": "Razdor, Ryba, Silny", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Horned Cuirass", "city": "Mir, Ryba", "limitedTo": "", "rating": "★★★", "type": "Armor", "statIncrease": "2⛊", "stoneSlots": "2", "bonusChip": ""}, {"name": "Guard's Armor", "city": "Vouno", "limitedTo": "", "rating": "★★★★", "type": "Armor", "statIncrease": "3⛊", "stoneSlots": "2", "bonusChip": ""}], [{"name": "Guard's Tunic", "city": "Mir", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "0⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Reinforced Tunic", "city": "Razdor, Ryba, Silny", "limitedTo": "", "rating": "★★", "type": "Armor", "statIncrease": "1⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Wanderer of the Fields", "city": "Mir", "limitedTo": "Catherine, Vera, Yana", "rating": "★", "type": "Armor", "statIncrease": "3⛊", "stoneSlots": "2", "bonusChip": "🗡️⛊"}], [{"name": "Guard's Tunic", "city": "Mir", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "0⛊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Hero's Armor", "city": "Vouno", "limitedTo": "", "rating": "★", "type": "Armor", "statIncrease": "4⛊", "stoneSlots": "1", "bonusChip": "🗡️⛊"}], [{"name": "Captain's Blade", "city": "", "limitedTo": "Grigory", "rating": "★", "type": "Weapon", "statIncrease": "0👊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Volk Blade", "city": "Razdor", "limitedTo": "Grigory", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": ""}], [{"name": "Guard's Spear", "city": "", "limitedTo": "Kharzin", "rating": "★", "type": "Weapon", "statIncrease": "0👊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Hunter's Spear", "city": "", "limitedTo": "Kharzin", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": ""}], [{"name": "Long Bow", "city": "", "limitedTo": "Vera", "rating": "★", "type": "Weapon", "statIncrease": "0👊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Falmundian Bow", "city": "", "limitedTo": "Vera", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": ""}], [{"name": "Iron Hand Axes", "city": "", "limitedTo": "Yury", "rating": "★", "type": "Weapon", "statIncrease": "0👊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Alloy Hand Axes", "city": "", "limitedTo": "Yury", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": ""}], [{"name": "Iron Hammer", "city": "", "limitedTo": "Pavel", "rating": "★", "type": "Weapon", "statIncrease": "0👊", "stoneSlots": "1", "bonusChip": ""}, {"name": "Silver Hammer", "city": "", "limitedTo": "Pavel", "rating": "★★", "type": "Weapon", "statIncrease": "1👊", "stoneSlots": "1", "bonusChip": ""}]], "mapGraph": {"nodes": {"1": {"x": 1106, "y": 743, "name": "1", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Lobster", "Dusk Stalker", "Mountain Bear", "Timber Wolf", "Waste Prowler"], "resources": []}, "2": {"x": 1439, "y": 650, "name": "2", "chapters": [], "enemies": [], "resources": ["Agate"]}, "3": {"x": 2089, "y": 596, "name": "3", "chapters": [], "enemies": [], "resources": []}, "4": {"x": 2605, "y": 603, "name": "4", "chapters": [], "enemies": [], "resources": []}, "5": {"x": 2004, "y": 657, "name": "5", "chapters": ["1", "2", "3", "4"], "enemies": ["Disruptor", "Tenebris Drakondor", "Tenebris Hunter", "Timber Wolf", "Tumani Hunter", "Tumani Mender", "Waste Prowler"], "resources": []}, "6": {"x": 550, "y": 817, "name": "6", "chapters": ["1", "2", "3", "4"], "enemies": ["Drakondor", "Mountain Bear", "Tenebris Drakondor", "Tenebris Hunter", "Waste Prowler"], "resources": []}, "7": {"x": 1352, "y": 755, "name": "7", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Soldier", "Disruptor", "Dusk Stalker", "Falmund Scout", "Mountain Bear", "Tenebris Clayhorn", "Tenebris Hunter", "Timber Wolf"], "resources": []}, "8": {"x": 369, "y": 1049, "name": "8", "chapters": ["1", "2", "3", "4"], "enemies": ["Armored Zhuk", "Cave Stalker", "Disruptor", "Tenebris Zhuk"], "resources": []}, "9": {"x": 1727, "y": 768, "name": "9", "chapters": [], "enemies": [], "resources": []}, "10": {"x": 1857, "y": 770, "name": "10", "chapters": ["1", "2", "3", "4"], "enemies": ["Cave Stalker", "Disruptor", "Dusk Stalker", "Seer's Assassin", "Tenebris Hunter", "Timber Wolf", "Tumani Hunter", "Tumani Mender"], "resources": []}, "11": {"x": 2066, "y": 899, "name": "11", "chapters": ["1", "2", "3", "4"], "enemies": ["Disruptor", "Flesh Eating Fish", "Tumani Raider", "Volrok"], "resources": []}, "12": {"x": 2654, "y": 742, "name": "12", "chapters": ["1", "2", "3", "4"], "enemies": ["Tenebris Hunter", "Timber Wolf", "Tumani Hunter", "Tumani Mender", "Tumani Raider", "Waste Nomad", "Waste Prowler"], "resources": []}, "13": {"x": 2487, "y": 886, "name": "13", "chapters": ["1", "2", "3", "4"], "enemies": ["Dusk Stalker", "Mountain Bear", "Tenebris Colossus", "Tenebris Hunter", "Timber Wolf", "Tumani Hunter", "Waste Prowler"], "resources": []}, "14": {"x": 1680, "y": 969, "name": "14", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Soldier", "Falmund Scout", "Seer's Assassin", "Stonehunter", "Tenebris Colossus", "Tenebris Hunter"], "resources": []}, "15": {"x": 2523, "y": 1027, "name": "15", "chapters": [], "enemies": [], "resources": ["Iron"]}, "16": {"x": 1618, "y": 1125, "name": "16", "chapters": [], "enemies": [], "resources": []}, "17": {"x": 2251, "y": 1076, "name": "17", "chapters": [], "enemies": [], "resources": ["Pine", "Ancient Oak"]}, "18": {"x": 2603, "y": 1079, "name": "18", "chapters": ["1", "2", "3", "4"], "enemies": ["Dusk Stalker", "Mountain Bear", "Tenebris Colossus", "Timber Wolf", "Tumani Raider", "Waste Nomad", "Waste Prowler"], "resources": []}, "19": {"x": 2369, "y": 1184, "name": "19", "chapters": ["1", "2", "3", "4"], "enemies": ["Dusk Stalker", "Falmund Scout", "Kingsguard", "Stonehunter", "Tenebris Guard", "Tenebris Hunter"], "resources": []}, "20": {"x": 1427, "y": 1309, "name": "20", "chapters": [], "enemies": [], "resources": []}, "21": {"x": 2842, "y": 1341, "name": "21", "chapters": ["1", "2", "3", "4"], "enemies": ["Flesh Eating Fish", "Tumani Raider", "Volrok"], "resources": []}, "22": {"x": 2441, "y": 1377, "name": "22", "chapters": [], "enemies": [], "resources": []}, "23": {"x": 302, "y": 1342, "name": "23", "chapters": ["1", "2", "3", "4"], "enemies": ["Armored Zhuk", "Cave Stalker", "Metal Eater", "Tenebris Drakondor", "Tenebris Zhuk", "Waste Nomad"], "resources": []}, "24": {"x": 454, "y": 1530, "name": "24", "chapters": [], "enemies": [], "resources": ["Silver"]}, "25": {"x": 1221, "y": 1494, "name": "25", "chapters": [], "enemies": [], "resources": ["Dogwood"]}, "26": {"x": 1449, "y": 1466, "name": "26", "chapters": ["1", "2", "3", "4"], "enemies": ["Dusk Stalker", "Falmund Scout", "Kingsguard", "Seer's Assassin", "Stonehunter", "Timber Wolf", "Waste Nomad"], "resources": []}, "27": {"x": 1715, "y": 1453, "name": "27", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Lobster", "Flesh Eating Fish", "Stonehunter", "Volrok"], "resources": []}, "28": {"x": 1453, "y": 1663, "name": "28", "chapters": ["1", "2", "3", "4"], "enemies": ["Dusk Stalker", "Falmund Scout", "Mountain Bear", "Seer's Assassin", "Stonehunter", "Tenebris Colossus", "Tenebris Guard"], "resources": []}, "29": {"x": 1577, "y": 1635, "name": "29", "chapters": [], "enemies": [], "resources": ["Gold"]}, "30": {"x": 1627, "y": 1726, "name": "30", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Marauder", "Corrupted Soldier", "Dusk Stalker", "Mountain Bear", "Tenebris Colossus", "Timber Wolf"], "resources": []}, "31": {"x": 1824, "y": 1730, "name": "31", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Corrupted Soldier", "Kingsguard", "Mountain Bear", "Tenebris Colossus", "Timber Wolf"], "resources": []}, "32": {"x": 1973, "y": 1714, "name": "32", "chapters": [], "enemies": [], "resources": []}, "33": {"x": 2405, "y": 1693, "name": "33", "chapters": [], "enemies": [], "resources": []}, "34": {"x": 2572, "y": 1754, "name": "34", "chapters": [], "enemies": [], "resources": ["Silver"]}, "35": {"x": 2425, "y": 1765, "name": "35", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Marauder", "Corrupted Soldier", "Dusk Stalker", "Kingsguard", "Tenebris Guard", "Timber Wolf"], "resources": []}, "36": {"x": 283, "y": 1840, "name": "36", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Fylakes", "Corrupted Soldier", "Dusk Stalker", "Falmund Scout", "Mountain Bear", "Stonehunter"], "resources": []}, "37": {"x": 807, "y": 1810, "name": "37", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Fylakes", "Corrupted Soldier", "Falmund Scout", "Seer's Assassin", "Stonehunter"], "resources": []}, "38": {"x": 1267, "y": 1807, "name": "38", "chapters": ["1", "2", "3", "4"], "enemies": ["Clayhorn", "Disruptor", "Dusk Stalker", "Plains Strider", "Tenebris Clayhorn", "Tenebris Strider", "Timber Wolf"], "resources": []}, "39": {"x": 1934, "y": 1850, "name": "39", "chapters": ["1", "2", "3", "4"], "enemies": ["Flesh Eating Fish", "Volrok"], "resources": []}, "40": {"x": 2420, "y": 1926, "name": "40", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Chief", "Brigand Marauder", "Dusk Stalker", "Metal Eater", "Tenebris Clayhorn", "Tenebris Colossus", "Tenebris Guard", "Tenebris Strider"], "resources": []}, "41": {"x": 2518, "y": 1937, "name": "41", "chapters": [], "enemies": [], "resources": ["Cedar"]}, "42": {"x": 2801, "y": 1970, "name": "42", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Lobster", "Flesh Eating Fish", "Tumani Raider", "Volrok"], "resources": []}, "43": {"x": 299, "y": 1967, "name": "43", "chapters": [], "enemies": [], "resources": []}, "44": {"x": 695, "y": 2023, "name": "44", "chapters": ["1", "2", "3", "4"], "enemies": ["Clayhorn", "Corrupted Fylakes", "Metal Eater", "Mountain Bear", "Tenebris Clayhorn", "Tenebris Colossus", "Tenebris Strider", "Timber Wolf"], "resources": []}, "45": {"x": 1098, "y": 2030, "name": "45", "chapters": [], "enemies": [], "resources": ["Ash"]}, "46": {"x": 1280, "y": 2008, "name": "46", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Marauder", "Corrupted Soldier", "Dusk Stalker", "Metal Eater", "Seer's Assassin", "Tenebris Clayhorn", "Tenebris Colossus"], "resources": []}, "47": {"x": 1772, "y": 2015, "name": "47", "chapters": ["1", "2", "3", "4"], "enemies": ["Disruptor", "Flesh Eating Fish", "Volrok"], "resources": []}, "48": {"x": 2433, "y": 2047, "name": "48", "chapters": [], "enemies": [], "resources": []}, "49": {"x": 1289, "y": 2096, "name": "49", "chapters": [], "enemies": [], "resources": []}, "50": {"x": 2598, "y": 2243, "name": "50", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Lobster", "Disruptor", "Tumani Raider", "Volrok"], "resources": []}, "51": {"x": 399, "y": 2274, "name": "51", "chapters": [], "enemies": [], "resources": []}, "52": {"x": 770, "y": 2236, "name": "52", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Marauder", "Corrupted Brigand", "Corrupted Fylakes", "Seer's Assassin", "Stonehunter", "Tenebris Drakondor", "Tenebris Strider"], "resources": []}, "53": {"x": 1006, "y": 2265, "name": "53", "chapters": ["1", "2", "3", "4"], "enemies": ["Clayhorn", "Dusk Stalker", "Plains Strider", "Tenebris Clayhorn", "Tenebris Colossus", "Tenebris Strider"], "resources": []}, "54": {"x": 1109, "y": 2261, "name": "54", "chapters": [], "enemies": [], "resources": []}, "55": {"x": 1437, "y": 2239, "name": "55", "chapters": [], "enemies": [], "resources": []}, "56": {"x": 1251, "y": 2386, "name": "56", "chapters": [], "enemies": [], "resources": []}, "57": {"x": 1713, "y": 2237, "name": "57", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Marauder", "Disruptor", "Falmund Scout", "Plains Strider", "Seer's Assassin", "Tenebris Clayhorn", "Tenebris Guard", "Tenebris Strider"], "resources": []}, "58": {"x": 1969, "y": 2222, "name": "58", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Chief", "Brigand Marauder", "Clayhorn", "Corrupted Brigand", "Corrupted Soldier", "Metal Eater", "Seer's Assassin", "Tenebris Colossus", "Tenebris Strider"], "resources": []}, "59": {"x": 2204, "y": 2261, "name": "59", "chapters": [], "enemies": [], "resources": []}, "60": {"x": 2418, "y": 2253, "name": "60", "chapters": [], "enemies": [], "resources": []}, "61": {"x": 936, "y": 2426, "name": "61", "chapters": ["1", "2", "3", "4"], "enemies": ["Clayhorn", "Corrupted Fylakes", "Dusk Stalker", "Plains Strider", "Stonehunter", "Tenebris Clayhorn", "Tenebris Strider"], "resources": []}, "62": {"x": 1860, "y": 2366, "name": "62", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Marauder", "Clayhorn", "Corrupted Soldier", "Dusk Stalker", "Falmund Scout", "Plains Strider", "Tenebris Clayhorn", "Tenebris Guard"], "resources": []}, "63": {"x": 2399, "y": 2388, "name": "63", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Chief", "Brigand Marauder", "Corrupted Soldier", "Tenebris Strider", "Tumani Raider"], "resources": []}, "64": {"x": 476, "y": 2640, "name": "64", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Fylakes", "Corrupted Soldier", "Falmund Scout", "Mountain Bear", "Stonehunter", "Tenebris Clayhorn"], "resources": []}, "65": {"x": 1016, "y": 2586, "name": "65", "chapters": ["1", "2", "3", "4"], "enemies": ["Flesh Eating Fish", "Volrok"], "resources": []}, "66": {"x": 1479, "y": 2547, "name": "66", "chapters": ["1", "2", "3", "4"], "enemies": ["Flesh Eating Fish", "Volrok"], "resources": []}, "67": {"x": 1686, "y": 2532, "name": "67", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Chief", "Brigand Marauder", "Corrupted Soldier", "Dusk Stalker", "Plains Strider", "Tenebris Colossus", "Tenebris Strider"], "resources": []}, "68": {"x": 2311, "y": 2528, "name": "68", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Chief", "Brigand Marauder", "Corrupted Soldier", "Disruptor", "Dusk Stalker", "Seer's Assassin", "Tenebris Colossus"], "resources": []}, "69": {"x": 2322, "y": 2603, "name": "69", "chapters": [], "enemies": [], "resources": []}, "70": {"x": 1475, "y": 2637, "name": "70", "chapters": [], "enemies": [], "resources": []}, "71": {"x": 348, "y": 2954, "name": "71", "chapters": [], "enemies": [], "resources": ["Autumn Blaze", "Cherry"]}, "72": {"x": 496, "y": 2904, "name": "72", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Fylakes", "Plains Strider", "Seer's Assassin", "Stonehunter", "Tenebris Strider"], "resources": []}, "73": {"x": 712, "y": 2940, "name": "73", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Chief", "Brigand Marauder", "Clayhorn", "Corrupted Brigand", "Plains Strider", "Seer's Assassin", "Tenebris Clayhorn", "Tenebris Strider"], "resources": []}, "74": {"x": 1141, "y": 2790, "name": "74", "chapters": [], "enemies": [], "resources": []}, "75": {"x": 1460, "y": 2762, "name": "75", "chapters": [], "enemies": [], "resources": []}, "76": {"x": 1689, "y": 2768, "name": "76", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Soldier", "Falmund Scout", "Plains Strider", "Stonehunter", "Tenebris Clayhorn", "Tenebris Colossus", "Tenebris Strider"], "resources": []}, "77": {"x": 1969, "y": 2742, "name": "77", "chapters": ["1", "2", "3", "4"], "enemies": ["Clayhorn", "Corrupted Soldier", "Falmund Scout", "Tenebris Clayhorn", "Tenebris Drakondor"], "resources": []}, "78": {"x": 2232, "y": 2745, "name": "78", "chapters": [], "enemies": [], "resources": []}, "79": {"x": 2593, "y": 2773, "name": "79", "chapters": [], "enemies": [], "resources": []}, "80": {"x": 1931, "y": 2854, "name": "80", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Lobster", "Drakondor", "Flesh Eating Fish", "Tenebris Drakondor", "Volrok"], "resources": []}, "81": {"x": 2286, "y": 2849, "name": "81", "chapters": [], "enemies": [], "resources": []}, "82": {"x": 2855, "y": 2838, "name": "82", "chapters": ["1", "2", "3", "4"], "enemies": ["Tumani Raider", "Volrok"], "resources": []}, "83": {"x": 1025, "y": 3035, "name": "83", "chapters": ["1", "2", "3", "4"], "enemies": ["Clayhorn", "Corrupted Soldier", "Plains Strider", "Tenebris Clayhorn", "Tenebris Strider"], "resources": []}, "84": {"x": 1125, "y": 2969, "name": "84", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Chief", "Brigand Marauder", "Clayhorn", "Corrupted Brigand", "Corrupted Soldier", "Dusk Stalker", "Plains Strider", "Tenebris Colossus", "Tenebris Strider"], "resources": []}, "85": {"x": 1460, "y": 3037, "name": "85", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Chief", "Brigand Marauder", "Clayhorn", "Corrupted Brigand", "Corrupted Soldier", "Dusk Stalker", "Stonehunter", "Tenebris Clayhorn", "Tenebris Strider"], "resources": []}, "86": {"x": 1794, "y": 3080, "name": "86", "chapters": [], "enemies": [], "resources": ["Pine", "Rosewood"]}, "87": {"x": 2259, "y": 3034, "name": "87", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Soldier", "Falmund Scout", "Stonehunter", "Tenebris Strider", "Tumani Raider"], "resources": []}, "88": {"x": 469, "y": 3441, "name": "88", "chapters": [], "enemies": [], "resources": ["Iron"]}, "89": {"x": 826, "y": 3373, "name": "89", "chapters": ["1", "2", "3", "4"], "enemies": ["Flesh Eating Fish", "Volrok"], "resources": []}, "90": {"x": 1164, "y": 3252, "name": "90", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Chief", "Corrupted Brigand", "Corrupted Soldier", "Dusk Stalker", "Falmund Scout", "Plains Strider", "Stonehunter", "Tenebris Colossus", "Tenebris Guard"], "resources": []}, "91": {"x": 1510, "y": 3281, "name": "91", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Marauder", "Disruptor", "Dusk Stalker", "Kingsguard", "Tenebris Clayhorn", "Tenebris Guard", "Tenebris Strider"], "resources": []}, "92": {"x": 1828, "y": 3176, "name": "92", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Soldier", "Dusk Stalker", "Falmund Scout", "Stonehunter", "Tenebris Strider"], "resources": []}, "93": {"x": 2139, "y": 3171, "name": "93", "chapters": ["1", "2", "3", "4"], "enemies": ["Clayhorn", "Corrupted Soldier", "Dusk Stalker", "Falmund Scout", "Kingsguard", "Metal Eater", "Plains Strider", "Tenebris Guard", "Tenebris Strider"], "resources": []}, "94": {"x": 1615, "y": 3344, "name": "94", "chapters": [], "enemies": [], "resources": []}, "95": {"x": 2086, "y": 3252, "name": "95", "chapters": [], "enemies": [], "resources": []}, "96": {"x": 921, "y": 3512, "name": "96", "chapters": [], "enemies": [], "resources": []}, "97": {"x": 1051, "y": 3500, "name": "97", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Chief", "Brigand Marauder", "Corrupted Soldier", "Dusk Stalker", "Falmund Scout", "Plains Strider", "Tenebris Guard", "Tenebris Strider"], "resources": []}, "98": {"x": 1264, "y": 3490, "name": "98", "chapters": [], "enemies": [], "resources": ["Pine"]}, "99": {"x": 1105, "y": 3636, "name": "99", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Marauder", "Corrupted Soldier", "Dusk Stalker", "Falmund Scout", "Metal Eater", "Stonehunter"], "resources": []}, "100": {"x": 1637, "y": 3694, "name": "100", "chapters": [], "enemies": [], "resources": []}, "101": {"x": 703, "y": 3816, "name": "101", "chapters": [], "enemies": [], "resources": []}, "102": {"x": 1046, "y": 3788, "name": "102", "chapters": [], "enemies": [], "resources": []}, "103": {"x": 1368, "y": 3811, "name": "103", "chapters": ["1", "2", "3", "4"], "enemies": ["Brigand Archer", "Brigand Chief", "Brigand Marauder", "Clayhorn", "Corrupted Brigand", "Corrupted Soldier", "Dusk Stalker", "Metal Eater", "Tenebris Clayhorn"], "resources": []}, "104": {"x": 1597, "y": 3755, "name": "104", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Brigand", "Corrupted Soldier", "Falmund Scout", "Kingsguard", "Plains Strider", "Stonehunter", "Tenebris Guard", "Tenebris Strider"], "resources": []}, "105": {"x": 1723, "y": 3804, "name": "105", "chapters": ["1", "2", "3", "4"], "enemies": ["Corrupted Soldier", "Falmund Scout", "Stonehunter"], "resources": []}, "106": {"x": 1199, "y": 3883, "name": "106", "chapters": [], "enemies": [], "resources": []}, "107": {"x": 761, "y": 3955, "name": "107", "chapters": [], "enemies": [], "resources": []}, "108": {"x": 649, "y": 4319, "name": "108", "chapters": ["4"], "enemies": ["Corrupted Soldier", "Dusk Stalker", "Tenebris Drakondor", "Tenebris Guard", "Tenebris Strider"], "resources": []}, "forgotten tower": {"x": 1006, "y": 4301, "name": "Forgotten Tower", "chapters": [], "enemies": [], "resources": []}, "fort_istra": {"x": 949, "y": 3875, "name": "Fort Istra", "type": "town", "chapters": [], "enemies": [], "resources": []}, "razdor": {"x": 2031, "y": 3502, "name": "Razdor", "type": "town", "chapters": [], "enemies": [], "resources": []}, "mir": {"x": 1349, "y": 2737, "name": "Mir", "type": "town", "chapters": [], "enemies": [], "resources": []}, "ryba": {"x": 2426, "y": 2742, "name": "Ryba", "type": "town", "chapters": [], "enemies": [], "resources": []}, "vouno": {"x": 285, "y": 2129, "name": "Vouno", "type": "town", "chapters": [], "enemies": [], "resources": []}, "silny": {"x": 2236, "y": 1559, "name": "Silny", "type": "town", "chapters": [], "enemies": [], "resources": []}, "strofa": {"x": 1253, "y": 2304, "name": "Strofa", "type": "town", "chapters": [], "enemies": [], "resources": []}}, "edges": [["102", "99"], ["99", "97"], ["97", "98"], ["97", "96"], ["97", "90"], ["90", "91"], ["91", "94"], ["94", "100"], ["100", "104"], ["104", "103"], ["103", "106"], ["106", "102"], ["90", "83"], ["83", "84"], ["84", "85"], ["85", "91"], ["91", "92"], ["92", "86"], ["92", "93"], ["93", "95"], ["95", "94"], ["95", "100"], ["104", "105"], ["85", "90"], ["84", "74"], ["74", "75"], ["75", "76"], ["76", "77"], ["77", "78"], ["78", "81"], ["81", "87"], ["77", "80"], ["80", "85"], ["85", "75"], ["74", "73"], ["73", "72"], ["72", "71"], ["75", "70"], ["70", "74"], ["72", "64"], ["64", "51"], ["51", "43"], ["43", "36"], ["36", "24"], ["51", "52"], ["52", "53"], ["53", "54"], ["53", "61"], ["61", "73"], ["61", "74"], ["54", "55"], ["55", "57"], ["57", "62"], ["62", "67"], ["67", "70"], ["62", "68"], ["68", "69"], ["69", "78"], ["68", "63"], ["63", "60"], ["60", "59"], ["59", "58"], ["58", "57"], ["55", "49"], ["49", "54"], ["49", "46"], ["46", "45"], ["46", "38"], ["38", "37"], ["37", "44"], ["44", "51"], ["44", "52"], ["60", "48"], ["48", "40"], ["40", "41"], ["40", "35"], ["35", "33"], ["33", "32"], ["32", "31"], ["31", "30"], ["30", "28"], ["28", "29"], ["30", "38"], ["29", "26"], ["26", "25"], ["26", "20"], ["20", "16"], ["16", "14"], ["14", "7"], ["7", "1"], ["7", "2"], ["14", "9"], ["9", "10"], ["10", "5"], ["5", "3"], ["10", "11"], ["33", "22"], ["22", "19"], ["19", "17"], ["19", "15"], ["19", "18"], ["19", "13"], ["13", "12"], ["12", "4"], ["24", "23"], ["23", "8"], ["8", "6"], ["73", "88"], ["fort_istra", "107"], ["fort_istra", "101"], ["fort_istra", "102"], ["fort_istra", "106"], ["razdor", "100"], ["razdor", "95"], ["razdor", "94"], ["mir", "74"], ["mir", "75"], ["mir", "70"], ["ryba", "79"], ["ryba", "81"], ["ryba", "78"], ["ryba", "69"], ["vouno", "43"], ["vouno", "51"], ["silny", "32"], ["silny", "33"], ["silny", "22"], ["strofa", "54"], ["strofa", "56"], ["strofa", "55"], ["strofa", "49"], ["82", "50", "water"], ["50", "42", "water"], ["82", "79", "water"], ["27", "39", "water"], ["39", "47", "water"], ["47", "66", "water"], ["66", "56", "water"], ["56", "65", "water"], ["65", "66", "water"], ["65", "89", "water"], ["89", "101", "water"], ["89", "80", "water"], ["80", "39", "water"], ["80", "82", "water"], ["42", "21", "water"], ["18", "21"], ["34", "35"], ["108", "107"], ["forgotten tower", "108"]]}};

// --- Utility ---
function esc(s) { if (!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function escJs(s) { if (!s) return ''; return String(s).replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\n/g,'\\n'); }

function formatCost(s) {
  if (!s || s === '-') return s || '';
  // Split on newlines, then fix each part: "20RAZDOR/SILNY" -> "$20 Razdor/Silny"
  return s.split(/\n/).map(part => {
    part = part.trim();
    if (!part) return '';
    // Insert space between number and letters: "20RAZDOR" -> "20 RAZDOR"
    part = part.replace(/^(\d+)([A-Za-z])/, '$1 $2');
    // Add $ before leading number
    part = part.replace(/^(\d)/, '$$$1');
    return part;
  }).filter(Boolean).join(', ');
}

function ratingStars(r) {
  if (!r) return '';
  return '<span class="rating">' + esc(r) + '</span>';
}

// --- Cross-reference index builders ---
const materialToEnemies = {};
const materialToCraft = {};
const materialToMarket = {};

function buildIndices() {
  // Enemies -> materials
  DATA.enemies.forEach(e => {
    e.materialDrops.forEach(d => {
      let matName = d.includes('(') ? d.substring(0, d.indexOf('(')).trim() : d;
      if (!materialToEnemies[matName]) materialToEnemies[matName] = [];
      materialToEnemies[matName].push(e);
    });
  });

  // Armor/Weapons -> materials
  DATA.armorWeapons.forEach(item => {
    [item.materials, item.wood, item.ores].forEach(group => {
      Object.keys(group).forEach(mat => {
        if (!materialToCraft[mat]) materialToCraft[mat] = [];
        materialToCraft[mat].push({ name: item.name, type: 'armor-weapon', item });
      });
    });
    if (item.speakingStone) {
      let sName = item.speakingStone.replace(/\s*x\d+/i, '');
      if (!materialToCraft[sName]) materialToCraft[sName] = [];
      materialToCraft[sName].push({ name: item.name, type: 'armor-weapon', item });
    }
  });

  // Accessories -> materials
  DATA.accessories.forEach(item => {
    [item.materials, item.wood, item.ores].forEach(group => {
      Object.keys(group).forEach(mat => {
        if (!materialToCraft[mat]) materialToCraft[mat] = [];
        materialToCraft[mat].push({ name: item.name, type: 'accessory', item });
      });
    });
    if (item.speakingStone) {
      let sName = item.speakingStone.replace(/\s*x\d+/i, '');
      if (!materialToCraft[sName]) materialToCraft[sName] = [];
      materialToCraft[sName].push({ name: item.name, type: 'accessory', item });
    }
  });

  // Market -> materials
  DATA.market.forEach(item => {
    materialToMarket[item.name] = item;
  });
}

// --- All unique materials ---
function getAllMaterials() {
  const mats = new Set();
  DATA.enemies.forEach(e => e.materialDrops.forEach(d => {
    mats.add(d.includes('(') ? d.substring(0, d.indexOf('(')).trim() : d);
  }));
  DATA.armorWeapons.forEach(i => {
    [i.materials, i.wood, i.ores].forEach(g => Object.keys(g).forEach(m => mats.add(m)));
  });
  DATA.accessories.forEach(i => {
    [i.materials, i.wood, i.ores].forEach(g => Object.keys(g).forEach(m => mats.add(m)));
  });
  return [...mats].sort();
}

// --- Navigation ---
function showDetail(type, identifier) {
  const overlay = document.getElementById('overlay');
  const content = document.getElementById('detail-content');

  if (type === 'enemy') {
    const entries = DATA.enemies.filter(e => e.name === identifier);
    if (!entries.length) return;
    let html = '<h2>' + esc(identifier) + '</h2>';
    html += '<div class="card-subtitle">Enemy</div>';

    entries.forEach(e => {
      html += '<div style="margin-top:12px;padding:10px;background:var(--bg);border-radius:6px;">';
      html += '<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">' + ratingStars(e.rating) + '</div>';
      html += '<div class="stat-row">';
      html += '<span class="stat attack"><span class="stat-label">ATK</span><span class="stat-value">' + esc(e.attack) + '</span></span>';
      html += '<span class="stat defense"><span class="stat-label">DEF</span><span class="stat-value">' + esc(e.defense) + '</span></span>';
      html += '<span class="stat ap"><span class="stat-label">AP</span><span class="stat-value">' + esc(e.ap) + '</span></span>';
      html += '<span class="stat hp"><span class="stat-label">HP</span><span class="stat-value">' + esc(e.hp) + '</span></span>';
      if (e.lux) html += '<span class="stat lux"><span class="stat-label">Lux</span><span class="stat-value">' + esc(e.lux) + '</span></span>';
      if (e.silver) html += '<span class="stat silver"><span class="stat-label">Silver</span><span class="stat-value">' + esc(e.silver) + '</span></span>';
      html += '</div>';

      if (Object.keys(e.locations).length) {
        html += '<div class="section-label">Locations</div>';
        Object.entries(e.locations).forEach(([ch, loc]) => {
          html += '<div style="font-size:0.85rem;margin-bottom:2px;"><span style="color:var(--text2);">' + esc(ch) + ':</span> <span style="color:var(--green);">' + esc(loc) + '</span></div>';
        });
      }

      if (e.materialDrops.length) {
        html += '<div class="section-label">Material Drops</div><div class="tag-list">';
        e.materialDrops.forEach(d => {
          let matName = d.includes('(') ? d.substring(0, d.indexOf('(')).trim() : d;
          html += '<a class="tag" onclick="showDetail(\'material\',\'' + escJs(matName) + '\')">' + esc(d) + '</a>';
        });
        html += '</div>';
      }

      if (e.itemDrop) {
        html += '<div class="section-label">Special Drops</div>';
        html += '<span class="tag item">' + esc(e.itemDrop) + '</span>';
      }
      if (e.speakingStoneDrop) {
        html += '<div class="section-label">Speaking Stone Drop</div>';
        html += '<span class="tag item">' + esc(e.speakingStoneDrop) + '</span>';
      }
      html += '</div>';
    });

    content.innerHTML = html;

  } else if (type === 'craft' || type === 'armor-weapon' || type === 'accessory') {
    let item = DATA.armorWeapons.find(i => i.name === identifier);
    let itemType = 'armor-weapon';
    if (!item) {
      item = DATA.accessories.find(i => i.name === identifier);
      itemType = 'accessory';
    }
    if (!item) return;

    let html = '<h2>' + esc(item.name) + '</h2>';
    html += '<div class="card-subtitle">';
    html += esc(item.type || '') + (item.city ? ' &mdash; ' + esc(item.city) : '') + (item.limitedTo ? ' (Limited: ' + esc(item.limitedTo) + ')' : '');
    html += '</div>';

    html += '<div class="stat-row">';
    if (item.rating) html += '<span class="stat">' + ratingStars(item.rating) + '</span>';
    if (item.statIncrease) html += '<span class="stat"><span class="stat-label">Stat</span><span class="stat-value">' + esc(item.statIncrease) + '</span></span>';
    if (item.stoneSlots) html += '<span class="stat"><span class="stat-label">Slots</span><span class="stat-value">' + esc(item.stoneSlots) + '</span></span>';
    if (item.bonusChip) html += '<span class="stat"><span class="stat-label">Bonus</span><span class="stat-value">' + esc(item.bonusChip) + '</span></span>';
    html += '</div>';

    if (item.effect) {
      html += '<div style="font-size:0.85rem;color:var(--text);margin:8px 0;padding:8px;background:var(--bg);border-radius:4px;">' + esc(item.effect) + '</div>';
    }

    // Cost
    html += '<div class="stat-row" style="margin-top:8px;">';
    if (item.craftCost && item.craftCost !== '-') html += '<span class="stat lux"><span class="stat-label">Craft</span><span class="stat-value">' + esc(formatCost(item.craftCost)) + '</span></span>';
    if (item.sellPrice && item.sellPrice !== '-') html += '<span class="stat silver"><span class="stat-label">Sell</span><span class="stat-value">' + esc(formatCost(item.sellPrice)) + '</span></span>';
    if (item.luxCost && item.luxCost !== '-') html += '<span class="stat lux"><span class="stat-label">Lux</span><span class="stat-value">' + esc(formatCost(item.luxCost)) + '</span></span>';
    html += '</div>';

    // Prerequisite
    if (item.prerequisite) {
      html += '<h3>Prerequisite Equipment</h3>';
      html += '<a class="tag craft" onclick="showDetail(\'craft\',\'' + escJs(item.prerequisite) + '\')">' + esc(item.prerequisite) + '</a>';

      // Show chain
      let chain = findPrereqChain(item.name);
      if (chain && chain.length > 1) {
        html += '<div class="prereq-chain">';
        chain.forEach((c, i) => {
          html += '<a class="chain-item" onclick="showDetail(\'craft\',\'' + escJs(c.name) + '\')">' + esc(c.name) + ' ' + ratingStars(c.rating) + '</a>';
          if (i < chain.length - 1) html += '<span class="chain-arrow">&rarr;</span>';
        });
        html += '</div>';
      }
    }

    // Required items
    if (item.itemRequired) {
      html += '<h3>Required Items</h3>';
      html += '<span class="tag item">' + esc(item.itemRequired) + '</span>';
    }

    // Speaking Stone
    if (item.speakingStone) {
      html += '<h3>Speaking Stone Required</h3>';
      let stName = item.speakingStone.replace(/\s*x\d+/i, '').trim();
      html += '<a class="tag item" onclick="showDetail(\'stone\',\'' + escJs(stName) + '\')">' + esc(item.speakingStone) + '</a>';
    }

    // Crafting materials
    let hasMats = Object.keys(item.materials).length || Object.keys(item.wood).length || Object.keys(item.ores).length;
    if (hasMats) {
      html += '<h3>Crafting Materials</h3>';
      let detailRes = getResources();
      html += '<table class="recipe-table"><tr><th>Material</th><th>Owned</th><th>Qty</th><th>Qty (2 Rep)</th><th>Source</th></tr>';

      const renderMats = (group, category) => {
        Object.entries(group).forEach(([mat, info]) => {
          let source = '';
          if (materialToEnemies[mat]) {
            let names = [...new Set(materialToEnemies[mat].map(e => e.name))];
            source = names.map(n => '<a onclick="showDetail(\'enemy\',\'' + escJs(n) + '\')" style="color:var(--red)">' + esc(n) + '</a>').join(', ');
          }
          if (materialToMarket[mat]) {
            if (source) source += ' | ';
            source += '<span style="color:var(--green)">Market</span>';
          }
          if (DATA.harvestLocations[mat]) {
            if (source) source += ' | ';
            source += '<span style="color:var(--orange)">Nodes: ' + esc(DATA.harvestLocations[mat]) + '</span>';
          }
          let owned = detailRes[mat] || 0;
          let needed = parseInt(info.qty || info) || 0;
          let ownColor = owned >= needed ? 'var(--green)' : 'var(--red)';
          html += '<tr><td><a onclick="showDetail(\'material\',\'' + escJs(mat) + '\')">' + esc(mat) + '</a></td>';
          html += '<td style="color:' + ownColor + ';font-weight:600;">' + owned + '</td>';
          html += '<td>' + esc(info.qty || info) + '</td><td>' + esc(info.rep2 || info['2R'] || '') + '</td>';
          html += '<td style="font-size:0.8rem;">' + (source || '-') + '</td></tr>';
        });
      };

      if (Object.keys(item.materials).length) renderMats(item.materials, 'Monster');
      if (Object.keys(item.wood).length) renderMats(item.wood, 'Wood');
      if (Object.keys(item.ores).length) renderMats(item.ores, 'Ore');
      html += '</table>';
    }

    // Plan Route link
    if (hasMats) {
      html += '<div style="margin-top:14px;"><a class="rp-btn rp-btn-primary" style="text-decoration:none;" onclick="planRouteFor(\'' + escJs(item.name) + '\')">Plan Route</a></div>';
    }

    content.innerHTML = html;

  } else if (type === 'material') {
    let html = '<h2>' + esc(identifier) + '</h2>';
    html += '<div class="card-subtitle">Material / Resource</div>';

    // Dropped by enemies
    if (materialToEnemies[identifier]) {
      html += '<h3>Dropped By Enemies</h3>';
      let uniqueEnemies = {};
      materialToEnemies[identifier].forEach(e => {
        if (!uniqueEnemies[e.name]) uniqueEnemies[e.name] = [];
        uniqueEnemies[e.name].push(e);
      });
      Object.entries(uniqueEnemies).forEach(([name, entries]) => {
        html += '<div style="margin-bottom:8px;padding:8px;background:var(--bg);border-radius:4px;">';
        html += '<a onclick="showDetail(\'enemy\',\'' + escJs(name) + '\')" style="font-weight:600;color:var(--red);">' + esc(name) + '</a>';
        html += '<div style="font-size:0.82rem;color:var(--text2);margin-top:4px;">';
        entries.forEach(e => {
          let locs = Object.values(e.locations).join(', ');
          html += ratingStars(e.rating) + ' ' + (locs ? '<span style="color:var(--green)">' + esc(locs) + '</span>' : 'Location varies') + '<br>';
        });
        html += '</div></div>';
      });
    }

    // Bought at market
    if (materialToMarket[identifier]) {
      let m = materialToMarket[identifier];
      html += '<h3>Market Availability</h3>';
      html += '<table class="recipe-table"><tr><th>Town</th><th>Buy</th><th>Buy (2 Rep)</th><th>Sell</th></tr>';
      Object.entries(m.prices).forEach(([town, p]) => {
        html += '<tr><td>' + esc(town) + '</td><td>' + esc(p.buy || '-') + '</td><td>' + esc(p.buy2Rep || '-') + '</td><td>' + esc(p.sell || '-') + '</td></tr>';
      });
      html += '</table>';
    }

    // Harvest locations
    if (DATA.harvestLocations[identifier]) {
      html += '<h3>Harvesting/Mining Locations</h3>';
      html += '<div style="color:var(--green);font-size:0.9rem;">Nodes: ' + esc(DATA.harvestLocations[identifier]) + '</div>';
    }
    if (DATA.resourceLuxCosts[identifier]) {
      if (canBuyResource(identifier)) {
        html += '<div style="color:var(--gold);font-size:0.85rem;margin-top:4px;">Lux cost to buy x4: ' + esc(DATA.resourceLuxCosts[identifier]) + '</div>';
      } else {
        let reqB = WOOD_MATS.includes(identifier) ? 'Lumbermill (Upgraded)' : 'Lapidary';
        html += '<div style="color:var(--text2);font-size:0.85rem;margin-top:4px;">Lux cost to buy x4: <span style="text-decoration:line-through;">' + esc(DATA.resourceLuxCosts[identifier]) + '</span> <span style="color:var(--red);">(requires ' + esc(reqB) + ')</span></div>';
      }
    }

    // Used in crafting
    if (materialToCraft[identifier]) {
      html += '<h3>Used to Craft</h3>';
      html += '<div class="tag-list" style="gap:6px;">';
      materialToCraft[identifier].forEach(c => {
        html += '<a class="tag craft" onclick="showDetail(\'craft\',\'' + escJs(c.name) + '\')">' + esc(c.name) + '</a>';
      });
      html += '</div>';
    }

    content.innerHTML = html;

  } else if (type === 'stone') {
    let stone = DATA.speakingStones.find(s => s.name === identifier);
    if (!stone) return;
    let html = '<h2>' + esc(stone.name) + '</h2>';
    html += '<div class="card-subtitle">Speaking Stone</div>';
    html += '<div class="stat-row">';
    html += '<span class="stat"><span class="stat-label">Element</span><span class="stat-value">' + esc(stone.element) + '</span></span>';
    html += '<span class="stat"><span class="stat-label">Color</span><span class="stat-value">' + esc(stone.color) + '</span></span>';
    html += '<span class="stat"><span class="stat-label">Available</span><span class="stat-value">' + esc(stone.available) + '</span></span>';
    html += '</div>';
    html += '<div style="margin:8px 0;padding:8px;background:var(--bg);border-radius:4px;font-size:0.9rem;">' + esc(stone.bonus) + '</div>';
    if (stone.lapidaryExchange) {
      if (canBuyStones()) {
        html += '<div style="font-size:0.85rem;color:var(--text2);">Lapidary Exchange: ' + esc(stone.lapidaryExchange) + '</div>';
      } else {
        html += '<div style="font-size:0.85rem;color:var(--text2);">Lapidary Exchange: <span style="text-decoration:line-through;">' + esc(stone.lapidaryExchange) + '</span> <span style="color:var(--red);">(requires Lapidary (Upgraded))</span></div>';
      }
    }

    // Used in crafting
    if (materialToCraft[identifier]) {
      html += '<h3>Used to Craft</h3>';
      html += '<div class="tag-list" style="gap:6px;">';
      materialToCraft[identifier].forEach(c => {
        html += '<a class="tag craft" onclick="showDetail(\'craft\',\'' + escJs(c.name) + '\')">' + esc(c.name) + '</a>';
      });
      html += '</div>';
    }

    content.innerHTML = html;
  }

  overlay.classList.add('active');
}

function findPrereqChain(itemName) {
  for (const chain of DATA.prereqChains) {
    let idx = chain.findIndex(c => c.name === itemName);
    if (idx >= 0) return chain.slice(0, idx + 1);
  }
  return null;
}

// --- Render functions ---
function renderEnemies(filter, search) {
  const grid = document.getElementById('enemy-grid');
  let grouped = {};
  DATA.enemies.forEach(e => {
    if (filter !== 'all' && e.rating !== filter) return;
    if (search && !matchesSearch(e, search)) return;
    if (!grouped[e.name]) grouped[e.name] = [];
    grouped[e.name].push(e);
  });

  if (!Object.keys(grouped).length) {
    grid.innerHTML = '<div class="empty-msg">No enemies match your filters.</div>';
    return;
  }

  let html = '';
  Object.entries(grouped).forEach(([name, entries]) => {
    html += '<div class="card">';
    html += '<div class="card-title"><a onclick="showDetail(\'enemy\',\'' + escJs(name) + '\')">' + esc(name) + '</a></div>';

    entries.forEach(e => {
      html += '<div style="margin-bottom:6px;">';
      html += '<div style="display:flex;align-items:center;gap:8px;margin-bottom:3px;">' + ratingStars(e.rating);
      html += '<span class="stat attack"><span class="stat-label">ATK</span><span class="stat-value">' + esc(e.attack) + '</span></span>';
      html += '<span class="stat defense"><span class="stat-label">DEF</span><span class="stat-value">' + esc(e.defense) + '</span></span>';
      html += '<span class="stat ap"><span class="stat-label">AP</span><span class="stat-value">' + esc(e.ap) + '</span></span>';
      html += '<span class="stat hp"><span class="stat-label">HP</span><span class="stat-value">' + esc(e.hp) + '</span></span>';
      if (e.lux) html += '<span class="stat lux"><span class="stat-label">Lux</span><span class="stat-value">' + esc(e.lux) + '</span></span>';
      html += '</div>';

      if (e.materialDrops.length) {
        html += '<div class="tag-list">';
        e.materialDrops.forEach(d => {
          let matName = d.includes('(') ? d.substring(0, d.indexOf('(')).trim() : d;
          html += '<a class="tag" onclick="event.stopPropagation();showDetail(\'material\',\'' + escJs(matName) + '\')">' + esc(d) + '</a>';
        });
        html += '</div>';
      }
      if (e.itemDrop) html += '<span class="tag item" style="margin-top:3px;">' + esc(e.itemDrop) + '</span>';
      html += '</div>';
    });

    // Compact locations
    let allLocs = {};
    entries.forEach(e => Object.entries(e.locations).forEach(([ch, loc]) => {
      if (!allLocs[ch]) allLocs[ch] = new Set();
      loc.split(',').forEach(l => allLocs[ch].add(l.trim()));
    }));
    if (Object.keys(allLocs).length) {
      html += '<div class="locations-list">';
      Object.entries(allLocs).forEach(([ch, locs]) => {
        html += '<div><span style="color:var(--text2);font-size:0.78rem;">' + esc(ch) + ':</span> <span>' + esc([...locs].join(', ')) + '</span></div>';
      });
      html += '</div>';
    }

    html += '</div>';
  });
  grid.innerHTML = html;
}

function renderArmorWeapons(typeFilter, ratingFilter, search) {
  const grid = document.getElementById('aw-grid');
  let filtered = DATA.armorWeapons.filter(i => {
    if (typeFilter !== 'all' && i.type !== typeFilter) return false;
    if (ratingFilter !== 'all' && i.rating !== ratingFilter) return false;
    if (search && !matchesSearchCraft(i, search)) return false;
    if (!itemMatchesHeroes(i)) return false;
    return true;
  });

  if (!filtered.length) {
    grid.innerHTML = '<div class="empty-msg">No items match your filters.</div>';
    return;
  }

  grid.innerHTML = filtered.map(item => renderCraftCard(item, 'armor-weapon')).join('');
}

function renderAccessories(typeFilter, search) {
  const grid = document.getElementById('acc-grid');
  let filtered = DATA.accessories.filter(i => {
    if (typeFilter !== 'all' && i.type !== typeFilter) return false;
    if (search && !matchesSearchCraft(i, search)) return false;
    return true;
  });

  if (!filtered.length) {
    grid.innerHTML = '<div class="empty-msg">No items match your filters.</div>';
    return;
  }

  grid.innerHTML = filtered.map(item => renderCraftCard(item, 'accessory')).join('');
}

function renderCraftCard(item, type) {
  let html = '<div class="card">';
  html += '<div class="card-title"><a onclick="showDetail(\'craft\',\'' + escJs(item.name) + '\')">' + esc(item.name) + '</a>';
  if (item.rating) html += ' ' + ratingStars(item.rating);
  html += '<!--CRAFT_BADGE--></div>';

  let sub = [];
  if (item.type) sub.push(item.type);
  if (item.city) sub.push(item.city);
  if (item.limitedTo) sub.push('Limited: ' + item.limitedTo);
  html += '<div class="card-subtitle">' + esc(sub.join(' | ')) + '</div>';

  html += '<div class="stat-row">';
  if (item.statIncrease) html += '<span class="stat"><span class="stat-label">Stat</span><span class="stat-value">' + esc(item.statIncrease) + '</span></span>';
  if (item.stoneSlots) html += '<span class="stat"><span class="stat-label">Slots</span><span class="stat-value">' + esc(item.stoneSlots) + '</span></span>';
  if (item.bonusChip) html += '<span class="stat"><span class="stat-label">Bonus</span><span class="stat-value">' + esc(item.bonusChip) + '</span></span>';
  if (item.craftCost && item.craftCost !== '-') html += '<span class="stat lux"><span class="stat-label">Craft</span><span class="stat-value">' + esc(formatCost(item.craftCost)) + '</span></span>';
  if (item.luxCost && item.luxCost !== '-') html += '<span class="stat lux"><span class="stat-label">Lux</span><span class="stat-value">' + esc(formatCost(item.luxCost)) + '</span></span>';
  html += '</div>';

  if (item.effect) {
    html += '<div style="font-size:0.82rem;color:var(--text);margin:4px 0;">' + esc(item.effect) + '</div>';
  }

  if (item.prerequisite) {
    html += '<div class="section-label">Requires</div>';
    html += '<a class="tag craft" onclick="event.stopPropagation();showDetail(\'craft\',\'' + escJs(item.prerequisite) + '\')">' + esc(item.prerequisite) + '</a>';
  }

  // Show materials compactly with owned/needed
  let mats = [];
  const myRes = getResources();
  let allMet = true;
  Object.entries(item.materials || {}).forEach(([m, info]) => { let need = parseInt(info.qty || info) || 0; mats.push({name:m, need}); });
  Object.entries(item.wood || {}).forEach(([m, info]) => { let need = parseInt(info.qty || info) || 0; mats.push({name:m, need}); });
  Object.entries(item.ores || {}).forEach(([m, info]) => { let need = parseInt(info.qty || info) || 0; mats.push({name:m, need}); });
  if (item.speakingStone) mats.push({name: item.speakingStone, need: 0, raw: true});
  if (item.itemRequired) mats.push({name: item.itemRequired, need: 0, raw: true});

  mats.forEach(m => { if (!m.raw && m.need > 0 && (myRes[m.name] || 0) < m.need) allMet = false; });
  let hasCraftMats = mats.some(m => !m.raw && m.need > 0);

  if (mats.length) {
    html += '<div class="section-label">Materials</div><div class="tag-list">';
    mats.forEach(m => {
      if (m.raw) {
        html += '<a class="tag" onclick="event.stopPropagation();showDetail(\'material\',\'' + escJs(m.name.replace(/\s*x\d+.*/i,'').trim()) + '\')">' + esc(m.name) + '</a>';
      } else {
        let owned = myRes[m.name] || 0;
        let cls = owned >= m.need ? 'mat-have' : 'mat-need';
        html += '<a class="tag ' + cls + '" onclick="event.stopPropagation();showDetail(\'material\',\'' + escJs(m.name) + '\')">' + esc(m.name) + ' ' + owned + '/' + m.need + '</a>';
      }
    });
    html += '</div>';
  }

  if (hasCraftMats && allMet) {
    html = html.replace('<!--CRAFT_BADGE-->', '<span class="craft-badge">Can Craft</span>');
  } else {
    html = html.replace('<!--CRAFT_BADGE-->', '');
  }

  if (hasCraftMats) {
    html += '<div class="card-actions">';
    html += '<button class="card-route-btn" onclick="event.stopPropagation();addToRouteAndGo(\'' + escJs(item.name) + '\')">Plan Route</button>';
    html += '<button class="card-route-btn" onclick="event.stopPropagation();addToRoutePlanner(\'' + escJs(item.name) + '\')">+ Add to Route</button>';
    html += '</div>';
  }

  html += '</div>';
  return html;
}

function renderMarket() {
  const container = document.getElementById('market-content');
  const towns = ['Mir', 'Razdor', 'Ryba', 'Silny', 'Strofa', 'Vouno', 'Fort Istra Apothecary'];

  let html = '<table class="market-table"><thead>';
  html += '<tr><th rowspan="2">Item</th><th rowspan="2">Effect</th>';
  towns.forEach(t => html += '<th class="town-header" colspan="3">' + esc(t) + '</th>');
  html += '</tr><tr>';
  towns.forEach(() => html += '<th class="buy">Buy</th><th class="buy">2Rep</th><th class="sell">Sell</th>');
  html += '</tr></thead><tbody>';

  DATA.market.forEach(item => {
    html += '<tr><td><a onclick="showDetail(\'material\',\'' + escJs(item.name) + '\')" style="font-weight:600;">' + esc(item.name) + '</a></td>';
    html += '<td style="font-size:0.8rem;color:var(--text2);max-width:200px;">' + esc(item.effect) + '</td>';
    towns.forEach(t => {
      let p = item.prices[t] || {};
      html += '<td>' + esc(p.buy || '-') + '</td><td>' + esc(p.buy2Rep || '-') + '</td><td>' + esc(p.sell || '-') + '</td>';
    });
    html += '</tr>';
  });

  html += '</tbody></table>';
  container.innerHTML = html;
}

function renderBuildings() {
  const container = document.getElementById('buildings-content');
  const done = getCompletedBuildings();
  const doneCount = DATA.buildings.filter(b => done.includes(b.name)).length;

  let html = '<div class="bldg-toggle">';
  html += '<label style="color:var(--text2);font-size:0.85rem;cursor:pointer;display:flex;align-items:center;gap:6px;">';
  html += '<input type="checkbox" ' + (showCompletedBuildings ? 'checked' : '') + ' onchange="showCompletedBuildings=this.checked;renderBuildings();" /> Show completed (' + doneCount + '/' + DATA.buildings.length + ')';
  html += '</label></div>';

  html += '<div class="card-grid">';

  const bldgRes = getResources();
  DATA.buildings.forEach(b => {
    let isDone = done.includes(b.name);
    if (isDone && !showCompletedBuildings) return;

    let card = '<div class="card' + (isDone ? ' bldg-completed' : '') + '">';
    card += '<div class="card-title" style="flex-wrap:wrap;">' + esc(b.name);

    let mats = [];
    Object.entries(b.wood).forEach(([m, qty]) => mats.push({ name: m, need: parseInt(qty) || 0 }));
    Object.entries(b.ores).forEach(([m, qty]) => mats.push({ name: m, need: parseInt(qty) || 0 }));

    let allMet = mats.length > 0;
    mats.forEach(m => { if ((bldgRes[m.name] || 0) < m.need) allMet = false; });

    if (allMet && mats.length && !isDone) {
      card += ' <span class="craft-badge">Can Craft</span>';
    }

    card += '<button class="bldg-done-btn' + (isDone ? ' completed' : '') + '" onclick="toggleBuildingDone(\'' + escJs(b.name) + '\')">' + (isDone ? 'Completed' : 'Mark Done') + '</button>';

    if (b.itemRequired) {
      card += '</div><div class="card-subtitle">Requires: ' + esc(b.itemRequired) + '</div>';
    } else {
      card += '</div>';
    }

    if (mats.length) {
      card += '<div class="section-label">Resources Needed</div><div class="tag-list">';
      mats.forEach(m => {
        let owned = bldgRes[m.name] || 0;
        let cls = owned >= m.need ? 'mat-have' : 'mat-need';
        card += '<a class="tag ' + cls + '" onclick="showDetail(\'material\',\'' + escJs(m.name) + '\')">' + esc(m.name) + ' ' + owned + '/' + m.need + '</a>';
      });
      card += '</div>';
    }

    if (mats.length) {
      card += '<div class="card-actions">';
      card += '<button class="card-route-btn" onclick="event.stopPropagation();addToRouteAndGo(\'' + escJs(b.name) + '\')">Plan Route</button>';
      card += '<button class="card-route-btn" onclick="event.stopPropagation();addToRoutePlanner(\'' + escJs(b.name) + '\')">+ Add to Route</button>';
      card += '</div>';
    }

    card += '</div>';
    html += card;
  });

  html += '</div>';

  // Harvesting locations
  html += '<h3 style="color:var(--gold);margin-top:20px;margin-bottom:10px;">Harvesting & Mining Locations</h3>';
  html += '<table class="recipe-table"><tr><th>Resource</th><th>Nodes</th><th>Lux Cost (x4)</th><th>Requires</th></tr>';
  Object.entries(DATA.harvestLocations).forEach(([mat, locs]) => {
    const unlocked = canBuyResource(mat);
    const reqBuilding = WOOD_MATS.includes(mat) ? 'Lumbermill (Upgraded)' : 'Lapidary';
    html += '<tr><td><a onclick="showDetail(\'material\',\'' + escJs(mat) + '\')">' + esc(mat) + '</a></td>';
    html += '<td style="color:var(--green)">' + esc(locs) + '</td>';
    if (unlocked) {
      html += '<td style="color:var(--gold)">' + esc(DATA.resourceLuxCosts[mat] || '-') + '</td>';
      html += '<td style="color:var(--green);font-size:0.8rem;">Unlocked</td>';
    } else {
      html += '<td style="color:var(--text2);text-decoration:line-through;">' + esc(DATA.resourceLuxCosts[mat] || '-') + '</td>';
      html += '<td style="color:var(--red);font-size:0.8rem;">' + esc(reqBuilding) + '</td>';
    }
    html += '</tr>';
  });
  html += '</table>';

  container.innerHTML = html;
}

function renderStones() {
  const grid = document.getElementById('stones-grid');
  const colorMap = { 'Yellow': '#f0c040', 'Orange': '#ffa726', 'Blue': '#42a5f5', 'Green': '#66bb6a',
    'Red': '#ef5350', 'Purple': '#ab47bc', 'White': '#e0e0e0', 'Any color': '#e0e0e0' };

  grid.innerHTML = DATA.speakingStones.map(s => {
    let clr = colorMap[s.color] || 'var(--text)';
    let html = '<div class="card">';
    html += '<div class="card-title"><a onclick="showDetail(\'stone\',\'' + escJs(s.name) + '\')" style="color:' + clr + '">' + esc(s.name) + '</a></div>';
    html += '<div class="card-subtitle">' + esc(s.element) + ' | ' + esc(s.color) + ' | x' + esc(s.available) + '</div>';
    html += '<div style="padding:6px;background:var(--bg);border-radius:4px;font-size:0.9rem;">' + esc(s.bonus) + '</div>';
    if (s.lapidaryExchange) {
      if (canBuyStones()) {
        html += '<div style="font-size:0.82rem;color:var(--text2);margin-top:4px;">Exchange: ' + esc(s.lapidaryExchange) + '</div>';
      } else {
        html += '<div style="font-size:0.82rem;color:var(--text2);margin-top:4px;">Exchange: <span style="text-decoration:line-through;">' + esc(s.lapidaryExchange) + '</span> <span style="color:var(--red);font-size:0.78rem;">(Lapidary Upgraded)</span></div>';
      }
    }

    // What uses this stone
    if (materialToCraft[s.name]) {
      html += '<div class="section-label">Used In</div><div class="tag-list">';
      materialToCraft[s.name].forEach(c => {
        html += '<a class="tag craft" onclick="event.stopPropagation();showDetail(\'craft\',\'' + escJs(c.name) + '\')">' + esc(c.name) + '</a>';
      });
      html += '</div>';
    }

    html += '</div>';
    return html;
  }).join('');
}

function renderMaterialIndex() {
  const container = document.getElementById('material-index');
  const mats = getAllMaterials();
  container.innerHTML = mats.map(m =>
    '<a class="tag" onclick="showDetail(\'material\',\'' + escJs(m) + '\')" style="font-size:0.9rem;padding:6px 12px;">' + esc(m) + '</a>'
  ).join('');
}

// --- Resource Tracker ---
const RES_GROUPS = {
  'Monster Materials': ['Metal Fragments','Bone Fragments','Feathers','Wolf Pelt','Rough Leather','Animal Hide','Claw','Bear Pelt','Horn','Spines','Scales','Carapace','Tenebris Shards','Tenebris Skull','Tenebris Essence'],
  'Woods': ['Pine','Rosewood','Ash','Autumn Blaze','Dogwood','Cedar','Cherry','Ancient Oak'],
  'Ores': ['Iron','Silver','Gold','Agate','Crystal','Diamond']
};

const ALL_HEROES = ['Alek','Catherine','Grigory','Kharzin','Pavel','Vera','Yana','Yury'];

function getSelectedHeroes() {
  try {
    let raw = localStorage.getItem('tig_heroes');
    if (!raw) return [];
    let arr = JSON.parse(raw);
    return Array.isArray(arr) ? arr.filter(h => ALL_HEROES.includes(h)) : [];
  } catch(e) { return []; }
}

function saveSelectedHeroes(arr) {
  localStorage.setItem('tig_heroes', JSON.stringify(arr));
}

function toggleHero(name) {
  let heroes = getSelectedHeroes();
  let idx = heroes.indexOf(name);
  if (idx >= 0) heroes.splice(idx, 1);
  else heroes.push(name);
  saveSelectedHeroes(heroes);
  renderResources();
}

function itemMatchesHeroes(item) {
  if (!item.limitedTo) return true;
  let heroes = getSelectedHeroes();
  if (!heroes.length) return true;
  let itemHeroes = item.limitedTo.split(',').map(s => s.trim());
  return itemHeroes.some(h => heroes.includes(h));
}

const WOOD_MATS = RES_GROUPS['Woods'];
const ORE_MATS = RES_GROUPS['Ores'];

function canBuyResource(mat) {
  const done = getCompletedBuildings();
  if (WOOD_MATS.includes(mat)) return done.includes('Lumbermill (Upgraded)');
  if (ORE_MATS.includes(mat)) return done.includes('Lapidary');
  return false;
}

function canBuyStones() {
  return getCompletedBuildings().includes('Lapidary (Upgraded)');
}

function getResources() {
  try {
    let raw = localStorage.getItem('tig_resources');
    if (!raw) return {};
    let obj = JSON.parse(raw);
    if (typeof obj !== 'object' || obj === null || Array.isArray(obj)) return {};
    let clean = {};
    for (let k in obj) { clean[k] = Math.max(0, parseInt(obj[k]) || 0); }
    return clean;
  } catch(e) { return {}; }
}

function saveResources(res) {
  localStorage.setItem('tig_resources', JSON.stringify(res));
}

function renderResources() {
  const container = document.getElementById('resources-content');
  const res = getResources();
  const heroes = getSelectedHeroes();

  let html = '<div class="hero-picker"><div class="hero-picker-label">My Heroes</div>';
  html += '<div class="hero-grid">';
  ALL_HEROES.forEach(h => {
    html += '<button class="hero-btn' + (heroes.includes(h) ? ' selected' : '') + '" onclick="toggleHero(\'' + escJs(h) + '\')">' + esc(h) + '</button>';
  });
  html += '</div>';
  if (!heroes.length) html += '<div style="color:var(--text2);font-size:0.82rem;margin-top:6px;">No heroes selected — all items shown on Armor &amp; Weapons tab.</div>';
  else html += '<div style="color:var(--text2);font-size:0.82rem;margin-top:6px;">Armor &amp; Weapons tab will hide items limited to other heroes.</div>';
  html += '</div>';

  html += '<button class="res-clear-btn" onclick="clearAllResources()">Clear All</button>';

  Object.entries(RES_GROUPS).forEach(([group, mats]) => {
    html += '<div class="res-section-title">' + esc(group) + '</div>';
    html += '<div class="res-grid">';
    mats.forEach(mat => {
      let qty = res[mat] || 0;
      html += '<div class="res-card">';
      html += '<div class="res-name">' + esc(mat) + '</div>';
      html += '<div class="res-controls">';
      html += '<button class="res-qty-btn" onclick="adjustResource(\'' + escJs(mat) + '\',-1)">&#8722;</button>';
      html += '<input type="number" class="res-qty-input" min="0" value="' + qty + '" data-mat="' + escJs(mat) + '" onchange="setResource(this)" />';
      html += '<button class="res-qty-btn" onclick="adjustResource(\'' + escJs(mat) + '\',1)">+</button>';
      html += '</div></div>';
    });
    html += '</div>';
  });

  container.innerHTML = html;
}

function adjustResource(mat, delta) {
  let res = getResources();
  res[mat] = Math.max(0, (res[mat] || 0) + delta);
  saveResources(res);
  renderResources();
}

function setResource(input) {
  let res = getResources();
  res[input.dataset.mat] = Math.max(0, parseInt(input.value) || 0);
  saveResources(res);
}

function clearAllResources() {
  saveResources({});
  renderResources();
  refreshCurrentTab();
}

function getCompletedBuildings() {
  try {
    let raw = localStorage.getItem('tig_buildings_done');
    if (!raw) return [];
    let arr = JSON.parse(raw);
    return Array.isArray(arr) ? arr : [];
  } catch(e) { return []; }
}

function saveCompletedBuildings(arr) {
  localStorage.setItem('tig_buildings_done', JSON.stringify(arr));
}

function toggleBuildingDone(name) {
  let done = getCompletedBuildings();
  let idx = done.indexOf(name);
  if (idx >= 0) done.splice(idx, 1);
  else done.push(name);
  saveCompletedBuildings(done);
  renderBuildings();
  // Rebuild route planner adjacency if boat dock status changed
  if (name.toLowerCase().includes('boat dock') && RP.graph) {
    rpBuildAdj();
  }
}

let showCompletedBuildings = false;

// --- Search ---
function matchesSearch(enemy, q) {
  q = q.toLowerCase();
  if (enemy.name.toLowerCase().includes(q)) return true;
  if (enemy.materialDrops.some(d => d.toLowerCase().includes(q))) return true;
  if (enemy.itemDrop && enemy.itemDrop.toLowerCase().includes(q)) return true;
  if (Object.values(enemy.locations).some(l => l.toLowerCase().includes(q))) return true;
  return false;
}

function matchesSearchCraft(item, q) {
  q = q.toLowerCase();
  if (item.name.toLowerCase().includes(q)) return true;
  if (item.city && item.city.toLowerCase().includes(q)) return true;
  if (item.limitedTo && item.limitedTo.toLowerCase().includes(q)) return true;
  if (item.type && item.type.toLowerCase().includes(q)) return true;
  if (item.effect && item.effect.toLowerCase().includes(q)) return true;
  if (item.prerequisite && item.prerequisite.toLowerCase().includes(q)) return true;
  let allMats = [...Object.keys(item.materials || {}), ...Object.keys(item.wood || {}), ...Object.keys(item.ores || {})];
  if (allMats.some(m => m.toLowerCase().includes(q))) return true;
  return false;
}

// --- Event wiring ---
let currentTab = 'enemies';
let enemyFilter = 'all';
let awTypeFilter = 'all';
let awRatingFilter = 'all';
let accTypeFilter = 'all';
let searchQuery = '';

function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
  document.querySelectorAll('.panel').forEach(p => p.classList.toggle('active', p.id === 'panel-' + tab));
  refreshCurrentTab();
  if (tab === 'resources') renderResources();
  if (tab === 'route-planner' && typeof rpInit === 'function') rpInit();
}

function refreshCurrentTab() {
  if (currentTab === 'enemies') renderEnemies(enemyFilter, searchQuery);
  else if (currentTab === 'armor-weapons') renderArmorWeapons(awTypeFilter, awRatingFilter, searchQuery);
  else if (currentTab === 'accessories') renderAccessories(accTypeFilter, searchQuery);
  else if (currentTab === 'buildings') renderBuildings();
  else if (currentTab === 'stones') renderStones();
  else if (currentTab === 'resources') renderResources();
}

document.getElementById('tabs').addEventListener('click', e => {
  if (e.target.classList.contains('tab')) switchTab(e.target.dataset.tab);
});

document.getElementById('enemy-filters').addEventListener('click', e => {
  if (e.target.classList.contains('filter-btn')) {
    document.querySelectorAll('#enemy-filters .filter-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    enemyFilter = e.target.dataset.filter;
    renderEnemies(enemyFilter, searchQuery);
  }
});

document.getElementById('aw-filters').addEventListener('click', e => {
  if (e.target.classList.contains('filter-btn')) {
    if (e.target.dataset.filter !== undefined) {
      document.querySelectorAll('#aw-filters .filter-btn[data-filter]').forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      awTypeFilter = e.target.dataset.filter;
    }
    if (e.target.dataset.rating !== undefined) {
      document.querySelectorAll('#aw-filters .filter-btn[data-rating]').forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');
      awRatingFilter = e.target.dataset.rating;
    }
    renderArmorWeapons(awTypeFilter, awRatingFilter, searchQuery);
  }
});

document.getElementById('acc-filters').addEventListener('click', e => {
  if (e.target.classList.contains('filter-btn')) {
    document.querySelectorAll('#acc-filters .filter-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    accTypeFilter = e.target.dataset.filter;
    renderAccessories(accTypeFilter, searchQuery);
  }
});

document.getElementById('globalSearch').addEventListener('input', e => {
  searchQuery = e.target.value.trim();
  refreshCurrentTab();
});

document.getElementById('close-detail').addEventListener('click', () => {
  document.getElementById('overlay').classList.remove('active');
});
document.getElementById('overlay').addEventListener('click', e => {
  if (e.target === document.getElementById('overlay')) {
    document.getElementById('overlay').classList.remove('active');
  }
});
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') document.getElementById('overlay').classList.remove('active');
});

// --- Route Planner ---
const RP = {
  initialized: false,
  canvas: null, ctx: null,
  mapImg: null, mapLoaded: false,
  // View state (pan/zoom)
  viewX: 0, viewY: 0, zoom: 1, minZoom: 0.1, maxZoom: 3,
  MAP_W: 3000, MAP_H: 4511,
  // Graph (loaded from DATA or localStorage)
  graph: null,
  adj: {},          // adjacency list: nodeId -> [nodeId, ...]
  distMatrix: null, // lazy-computed BFS distance matrix
  // Route result
  route: null,
  // Editor state
  editMode: false, connectMode: false, waterEdgeMode: false,
  dragNode: null, dragOffX: 0, dragOffY: 0,
  edgeStart: null,
  // Mouse state
  mouseX: 0, mouseY: 0, isPanning: false, panStartX: 0, panStartY: 0,
  hoverNode: null,
};

function rpValidateGraph(g) {
  if (!g || typeof g !== 'object') return false;
  if (!g.nodes || typeof g.nodes !== 'object') return false;
  if (!Array.isArray(g.edges)) return false;
  for (const [nid, n] of Object.entries(g.nodes)) {
    if (typeof n.x !== 'number' || typeof n.y !== 'number') return false;
    if (n.name !== undefined && typeof n.name !== 'string') return false;
  }
  for (const e of g.edges) {
    if (!Array.isArray(e) || e.length < 2 || e.length > 3) return false;
  }
  return true;
}

function rpInit() {
  if (RP.initialized) { rpResize(); rpDraw(); return; }
  RP.initialized = true;
  RP.canvas = document.getElementById('rp-canvas');
  RP.ctx = RP.canvas.getContext('2d');
  // Load graph from localStorage or embedded data
  const saved = localStorage.getItem('tig_map_graph');
  if (saved) {
    try {
      const parsed = JSON.parse(saved);
      if (rpValidateGraph(parsed)) RP.graph = parsed;
    } catch(e) { RP.graph = null; }
  }
  if (!RP.graph) RP.graph = JSON.parse(JSON.stringify(DATA.mapGraph));
  rpBuildAdj();
  // Load map image
  RP.mapImg = new Image();
  RP.mapImg.onload = () => { RP.mapLoaded = true; rpFitView(); rpDraw(); };
  RP.mapImg.src = 'map-of-isofar.png';
  // Populate dropdowns
  rpPopulateItems();
  rpPopulateStartLocations();
  // Event listeners
  rpBindEvents();
  rpResize();
  rpDraw();
}

function rpIsBoatDockBuilt() {
  return getCompletedBuildings().some(b => b.toLowerCase().includes('boat dock'));
}

function rpBuildAdj() {
  RP.adj = {};
  const nodes = RP.graph.nodes;
  const boatOk = rpIsBoatDockBuilt();
  for (const nid in nodes) RP.adj[nid] = [];
  RP.graph.edges.forEach(e => {
    const [a, b] = e;
    const isWater = e[2] === 'water';
    if (isWater && !boatOk) return;
    if (nodes[a] && nodes[b]) {
      if (!RP.adj[a]) RP.adj[a] = [];
      if (!RP.adj[b]) RP.adj[b] = [];
      if (!RP.adj[a].includes(b)) RP.adj[a].push(b);
      if (!RP.adj[b].includes(a)) RP.adj[b].push(a);
    }
  });
  RP.distMatrix = null; // invalidate cache
}

function rpBFS(start) {
  const dist = {}; dist[start] = 0;
  const queue = [start]; let qi = 0;
  while (qi < queue.length) {
    const u = queue[qi++];
    (RP.adj[u] || []).forEach(v => {
      if (dist[v] === undefined) { dist[v] = dist[u] + 1; queue.push(v); }
    });
  }
  return dist;
}

function rpGetDist(a, b) {
  if (!RP.distMatrix) RP.distMatrix = {};
  if (!RP.distMatrix[a]) RP.distMatrix[a] = rpBFS(a);
  const d = RP.distMatrix[a][b];
  return d === undefined ? Infinity : d;
}

function rpBFSPath(start, end) {
  if (start === end) return [start];
  const prev = {}; prev[start] = null;
  const queue = [start]; let qi = 0;
  while (qi < queue.length) {
    const u = queue[qi++];
    for (const v of (RP.adj[u] || [])) {
      if (prev[v] === undefined) {
        prev[v] = u;
        if (v === end) {
          const path = [];
          let c = end;
          while (c !== null) { path.unshift(c); c = prev[c]; }
          return path;
        }
        queue.push(v);
      }
    }
  }
  return null; // unreachable
}

// --- Material Source Resolution ---
function rpGetMaterialSources(materialName, chapter) {
  const sources = [];
  const ch = String(chapter);
  const nodes = RP.graph.nodes;
  // Enemy drops: find enemies that drop this material at nodes available in the selected chapter
  if (materialToEnemies[materialName]) {
    const seen = new Set();
    materialToEnemies[materialName].forEach(enemy => {
      // Only check the exact selected chapter (enemies may not persist across chapters)
      const locStr = enemy.locations['Chapter ' + ch];
      if (locStr) {
        locStr.split(',').forEach(part => {
          let p = part.trim().replace(/\.$/, '');
          // Try as number
          const num = parseInt(p);
          if (!isNaN(num) && nodes[String(num)]) { seen.add(String(num)); return; }
          // Try as special area name
          const saId = rpSpecialAreaId(p);
          if (saId && nodes[saId]) seen.add(saId);
        });
      }
    });
    seen.forEach(nid => sources.push(nid));
  }
  // Market: find towns that sell this material
  if (materialToMarket[materialName]) {
    const m = materialToMarket[materialName];
    Object.keys(m.prices).forEach(town => {
      if (m.prices[town].buy) {
        // Map town name to node ID
        const tid = rpTownId(town);
        if (tid && nodes[tid]) sources.push(tid);
      }
    });
  }
  // Harvest nodes
  if (DATA.harvestLocations[materialName]) {
    const locStr = String(DATA.harvestLocations[materialName]);
    locStr.split(',').forEach(part => {
      const p = part.trim();
      const num = parseInt(p);
      if (!isNaN(num) && nodes[String(num)]) sources.push(String(num));
    });
  }
  return [...new Set(sources)];
}

const _specialAreaMap = {
  "FW - Ice Fields": "fw_ice_fields", "FW - Mount Nebesa": "fw_mount_nebesa",
  "FW - Reka Glacier": "fw_reka_glacier", "FW - Room of Columns": "fw_room_of_columns",
  "FW - Skryvat Temple": "fw_skryvat_temple", "FW - The Broken Lands": "fw_broken_lands",
  "FW - Uchitel Span": "fw_uchitel_span", "FW - Urok Span": "fw_urok_span",
  "FW - Vniz Path": "fw_vniz_path",
  "IC - Abandoned Quarters": "ic_abandoned_quarters", "IC - Abandoned Quartes": "ic_abandoned_quarters",
  "IC - Frozen Lake": "ic_frozen_lake", "IC - Glacial Worm Bones": "ic_glacial_worm_bones",
  "IC - Hall of Ice": "ic_hall_of_ice", "IC - Old Armory": "ic_old_armory", "IC - Ossuary": "ic_ossuary",
};
function rpSpecialAreaId(name) { return _specialAreaMap[name] || null; }

function rpTownId(townName) {
  const map = {
    'Mir': 'mir', 'Razdor': 'razdor', 'Ryba': 'ryba', 'Silny': 'silny',
    'Strofa': 'strofa', 'Vouno': 'vouno',
    'Fort Istra Apothecary': 'fort_istra', 'Fort Istra': 'fort_istra',
  };
  for (const [k, v] of Object.entries(map)) {
    if (townName.includes(k)) return v;
  }
  return null;
}

// --- Multi-Stop Route Optimization ---
function rpComputeRoute(itemName, startNode, chapter) {
  // Determine required materials
  let item = DATA.armorWeapons.find(i => i.name === itemName);
  if (!item) item = DATA.accessories.find(i => i.name === itemName);
  if (!item) item = DATA.buildings.find(i => i.name === itemName);
  if (!item) return null;

  const materialsNeeded = [];
  [item.materials, item.wood, item.ores].forEach(group => {
    Object.entries(group || {}).forEach(([mat, info]) => {
      materialsNeeded.push({ name: mat, qty: info.qty || info });
    });
  });
  if (!materialsNeeded.length) return null;

  // For each material, find source nodes accessible in this chapter
  const matSources = {};
  materialsNeeded.forEach(m => {
    matSources[m.name] = rpGetMaterialSources(m.name, chapter);
  });

  // Check if all materials have at least one source
  const unreachable = materialsNeeded.filter(m => !matSources[m.name].length);
  if (unreachable.length) {
    return { error: 'No accessible sources for: ' + unreachable.map(m => m.name).join(', ') };
  }

  // Greedy nearest-unvisited-source heuristic
  let current = startNode;
  const collected = new Set();
  const stops = []; // { nodeId, materials: [...], dist }

  while (collected.size < materialsNeeded.length) {
    let bestNode = null, bestDist = Infinity, bestMats = [];
    materialsNeeded.forEach(m => {
      if (collected.has(m.name)) return;
      matSources[m.name].forEach(nid => {
        const d = rpGetDist(current, nid);
        if (d < bestDist) {
          bestDist = d;
          bestNode = nid;
          bestMats = [m.name];
        } else if (d === bestDist && nid === bestNode) {
          bestMats.push(m.name);
        }
      });
    });
    if (!bestNode || bestDist === Infinity) {
      return { error: 'Cannot reach all material sources from ' + current };
    }
    // Check if this node provides other uncollected materials too
    const allMatsHere = [];
    materialsNeeded.forEach(m => {
      if (!collected.has(m.name) && matSources[m.name].includes(bestNode)) {
        allMatsHere.push(m.name);
      }
    });
    allMatsHere.forEach(mn => collected.add(mn));
    stops.push({ nodeId: bestNode, materials: allMatsHere, distFromPrev: bestDist });
    current = bestNode;
  }

  // 2-opt improvement
  for (let improved = true; improved;) {
    improved = false;
    for (let i = 0; i < stops.length - 1; i++) {
      for (let j = i + 1; j < stops.length; j++) {
        // Compute current cost of segment i..j
        const before = i === 0 ? startNode : stops[i - 1].nodeId;
        let oldCost = rpGetDist(before, stops[i].nodeId);
        for (let k = i; k < j; k++) oldCost += rpGetDist(stops[k].nodeId, stops[k + 1].nodeId);
        // Compute cost if we reverse i..j
        const rev = stops.slice(i, j + 1).reverse();
        let newCost = rpGetDist(before, rev[0].nodeId);
        for (let k = 0; k < rev.length - 1; k++) newCost += rpGetDist(rev[k].nodeId, rev[k + 1].nodeId);
        if (j + 1 < stops.length) {
          oldCost += rpGetDist(stops[j].nodeId, stops[j + 1].nodeId);
          newCost += rpGetDist(rev[rev.length - 1].nodeId, stops[j + 1].nodeId);
        }
        if (newCost < oldCost) {
          for (let k = 0; k < rev.length; k++) stops[i + k] = rev[k];
          improved = true;
        }
      }
    }
  }

  // Recalculate distances after optimization
  let prev = startNode;
  let totalDist = 0;
  stops.forEach(s => {
    s.distFromPrev = rpGetDist(prev, s.nodeId);
    totalDist += s.distFromPrev;
    prev = s.nodeId;
  });

  // Build full path for drawing
  const fullPath = [];
  prev = startNode;
  stops.forEach(s => {
    const seg = rpBFSPath(prev, s.nodeId);
    if (seg) { if (fullPath.length) seg.shift(); fullPath.push(...seg); }
    prev = s.nodeId;
  });

  return { stops, totalDist, fullPath, startNode, materialsNeeded };
}

function rpComputeRouteMulti(itemNames, startNode, chapter) {
  // Merge materials from all items
  const materialMap = {}; // name -> total qty needed
  let foundAny = false;
  itemNames.forEach(itemName => {
    let item = DATA.armorWeapons.find(i => i.name === itemName);
    if (!item) item = DATA.accessories.find(i => i.name === itemName);
    if (!item) item = DATA.buildings.find(i => i.name === itemName);
    if (!item) return;
    [item.materials, item.wood, item.ores].forEach(group => {
      Object.entries(group || {}).forEach(([mat, info]) => {
        foundAny = true;
        const qty = parseInt(info.qty || info) || 0;
        materialMap[mat] = (materialMap[mat] || 0) + qty;
      });
    });
  });
  if (!foundAny) return null;

  const materialsNeeded = Object.entries(materialMap).map(([name, qty]) => ({ name, qty }));

  // For each material, find source nodes accessible in this chapter
  const matSources = {};
  materialsNeeded.forEach(m => {
    matSources[m.name] = rpGetMaterialSources(m.name, chapter);
  });

  // Check if all materials have at least one source
  const unreachable = materialsNeeded.filter(m => !matSources[m.name].length);
  if (unreachable.length) {
    return { error: 'No accessible sources for: ' + unreachable.map(m => m.name).join(', ') };
  }

  // Greedy nearest-unvisited-source heuristic
  let current = startNode;
  const collected = new Set();
  const stops = [];

  while (collected.size < materialsNeeded.length) {
    let bestNode = null, bestDist = Infinity, bestMats = [];
    materialsNeeded.forEach(m => {
      if (collected.has(m.name)) return;
      matSources[m.name].forEach(nid => {
        const d = rpGetDist(current, nid);
        if (d < bestDist) {
          bestDist = d;
          bestNode = nid;
          bestMats = [m.name];
        } else if (d === bestDist && nid === bestNode) {
          bestMats.push(m.name);
        }
      });
    });
    if (!bestNode || bestDist === Infinity) {
      return { error: 'Cannot reach all material sources from ' + current };
    }
    const allMatsHere = [];
    materialsNeeded.forEach(m => {
      if (!collected.has(m.name) && matSources[m.name].includes(bestNode)) {
        allMatsHere.push(m.name);
      }
    });
    allMatsHere.forEach(mn => collected.add(mn));
    stops.push({ nodeId: bestNode, materials: allMatsHere, distFromPrev: bestDist });
    current = bestNode;
  }

  // 2-opt improvement
  for (let improved = true; improved;) {
    improved = false;
    for (let i = 0; i < stops.length - 1; i++) {
      for (let j = i + 1; j < stops.length; j++) {
        const before = i === 0 ? startNode : stops[i - 1].nodeId;
        let oldCost = rpGetDist(before, stops[i].nodeId);
        for (let k = i; k < j; k++) oldCost += rpGetDist(stops[k].nodeId, stops[k + 1].nodeId);
        const rev = stops.slice(i, j + 1).reverse();
        let newCost = rpGetDist(before, rev[0].nodeId);
        for (let k = 0; k < rev.length - 1; k++) newCost += rpGetDist(rev[k].nodeId, rev[k + 1].nodeId);
        if (j + 1 < stops.length) {
          oldCost += rpGetDist(stops[j].nodeId, stops[j + 1].nodeId);
          newCost += rpGetDist(rev[rev.length - 1].nodeId, stops[j + 1].nodeId);
        }
        if (newCost < oldCost) {
          for (let k = 0; k < rev.length; k++) stops[i + k] = rev[k];
          improved = true;
        }
      }
    }
  }

  // Recalculate distances after optimization
  let prev = startNode;
  let totalDist = 0;
  stops.forEach(s => {
    s.distFromPrev = rpGetDist(prev, s.nodeId);
    totalDist += s.distFromPrev;
    prev = s.nodeId;
  });

  // Build full path for drawing
  const fullPath = [];
  prev = startNode;
  stops.forEach(s => {
    const seg = rpBFSPath(prev, s.nodeId);
    if (seg) { if (fullPath.length) seg.shift(); fullPath.push(...seg); }
    prev = s.nodeId;
  });

  return { stops, totalDist, fullPath, startNode, materialsNeeded };
}

// --- Canvas Rendering ---
function rpResize() {
  const area = document.getElementById('rp-map-area');
  if (!area) return;
  RP.canvas.width = area.clientWidth;
  RP.canvas.height = area.clientHeight;
  if (!RP.mapLoaded) rpFitView();
  rpDraw();
}

function rpFitView() {
  if (!RP.canvas) return;
  const cw = RP.canvas.width || 800, ch = RP.canvas.height || 600;
  RP.zoom = Math.min(cw / RP.MAP_W, ch / RP.MAP_H) * 0.95;
  RP.viewX = (cw - RP.MAP_W * RP.zoom) / 2;
  RP.viewY = (ch - RP.MAP_H * RP.zoom) / 2;
}

function rpMapToScreen(mx, my) {
  return [mx * RP.zoom + RP.viewX, my * RP.zoom + RP.viewY];
}
function rpScreenToMap(sx, sy) {
  return [(sx - RP.viewX) / RP.zoom, (sy - RP.viewY) / RP.zoom];
}

function rpDraw() {
  const ctx = RP.ctx;
  if (!ctx) return;
  const cw = RP.canvas.width, ch = RP.canvas.height;
  ctx.clearRect(0, 0, cw, ch);
  ctx.save();
  ctx.translate(RP.viewX, RP.viewY);
  ctx.scale(RP.zoom, RP.zoom);

  // Draw map image
  if (RP.mapLoaded) {
    ctx.drawImage(RP.mapImg, 0, 0, RP.MAP_W, RP.MAP_H);
  } else {
    ctx.fillStyle = '#1a1a2e';
    ctx.fillRect(0, 0, RP.MAP_W, RP.MAP_H);
    ctx.fillStyle = '#666';
    ctx.font = '40px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Loading map...', RP.MAP_W / 2, RP.MAP_H / 2);
  }

  const nodes = RP.graph.nodes;
  const r = Math.max(8, 12 / Math.sqrt(RP.zoom));

  // Draw edges
  const boatOk = rpIsBoatDockBuilt();
  // Land edges first
  ctx.strokeStyle = 'rgba(255,255,255,0.6)';
  ctx.lineWidth = 4 / RP.zoom;
  RP.graph.edges.forEach(e => {
    if (e[2] === 'water') return;
    if (!nodes[e[0]] || !nodes[e[1]]) return;
    ctx.beginPath();
    ctx.moveTo(nodes[e[0]].x, nodes[e[0]].y);
    ctx.lineTo(nodes[e[1]].x, nodes[e[1]].y);
    ctx.stroke();
  });
  // Water edges
  RP.graph.edges.forEach(e => {
    if (e[2] !== 'water') return;
    if (!nodes[e[0]] || !nodes[e[1]]) return;
    ctx.save();
    ctx.strokeStyle = boatOk ? 'rgba(30,90,160,0.9)' : 'rgba(30,90,160,0.35)';
    ctx.lineWidth = 4 / RP.zoom;
    ctx.setLineDash([12 / RP.zoom, 8 / RP.zoom]);
    ctx.beginPath();
    ctx.moveTo(nodes[e[0]].x, nodes[e[0]].y);
    ctx.lineTo(nodes[e[1]].x, nodes[e[1]].y);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.restore();
  });

  // Draw connect-mode preview line (dashed line from edgeStart to cursor)
  if (RP.connectMode && RP.edgeStart && nodes[RP.edgeStart]) {
    const sn = nodes[RP.edgeStart];
    const [cmx, cmy] = rpScreenToMap(RP.mouseX, RP.mouseY);
    ctx.save();
    ctx.strokeStyle = RP.waterEdgeMode ? '#42a5f5' : '#66bb6a';
    ctx.lineWidth = 3 / RP.zoom;
    ctx.setLineDash([10 / RP.zoom, 8 / RP.zoom]);
    ctx.beginPath();
    ctx.moveTo(sn.x, sn.y);
    ctx.lineTo(cmx, cmy);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.restore();
  }

  // Draw route path
  if (RP.route && RP.route.fullPath) {
    ctx.strokeStyle = '#e94560';
    ctx.lineWidth = 4 / RP.zoom;
    ctx.lineJoin = 'round';
    ctx.setLineDash([]);
    ctx.beginPath();
    RP.route.fullPath.forEach((nid, i) => {
      const n = nodes[nid];
      if (!n) return;
      if (i === 0) ctx.moveTo(n.x, n.y); else ctx.lineTo(n.x, n.y);
    });
    ctx.stroke();

    // Draw direction arrows along path
    ctx.fillStyle = '#e94560';
    for (let i = 1; i < RP.route.fullPath.length; i++) {
      const prev = nodes[RP.route.fullPath[i - 1]];
      const curr = nodes[RP.route.fullPath[i]];
      if (!prev || !curr) continue;
      const mx = (prev.x + curr.x) / 2, my = (prev.y + curr.y) / 2;
      const angle = Math.atan2(curr.y - prev.y, curr.x - prev.x);
      const sz = 10 / RP.zoom;
      ctx.save();
      ctx.translate(mx, my);
      ctx.rotate(angle);
      ctx.beginPath();
      ctx.moveTo(sz, 0);
      ctx.lineTo(-sz / 2, -sz / 2);
      ctx.lineTo(-sz / 2, sz / 2);
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }
  }

  // Build set of water nodes (nodes with at least one water edge)
  const waterNodes = new Set();
  RP.graph.edges.forEach(e => {
    if (e[2] === 'water') { waterNodes.add(e[0]); waterNodes.add(e[1]); }
  });

  // Draw nodes
  for (const [nid, n] of Object.entries(nodes)) {
    let color = waterNodes.has(nid) ? '#42a5f5' : '#66bb6a'; // water: blue, regular: green
    if (n.type === 'town') color = '#f0c040';
    else if (n.type === 'special') color = '#ab47bc';
    // Highlight route stops
    let isStop = false, stopIdx = -1;
    if (RP.route && RP.route.stops) {
      const idx = RP.route.stops.findIndex(s => s.nodeId === nid);
      if (idx >= 0) { isStop = true; stopIdx = idx; color = '#ef5350'; }
      if (nid === RP.route.startNode) { isStop = true; stopIdx = -1; color = '#66bb6a'; }
    }
    // Highlight hover
    if (RP.hoverNode === nid) {
      ctx.beginPath();
      ctx.arc(n.x, n.y, r * 1.6, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(233,69,96,0.3)';
      ctx.fill();
    }
    // Editor: highlight edge start
    if (RP.editMode && RP.edgeStart === nid) {
      ctx.beginPath();
      ctx.arc(n.x, n.y, r * 1.8, 0, Math.PI * 2);
      ctx.strokeStyle = '#66bb6a';
      ctx.lineWidth = 3 / RP.zoom;
      ctx.stroke();
    }
    // Node circle
    ctx.beginPath();
    ctx.arc(n.x, n.y, r, 0, Math.PI * 2);
    ctx.fillStyle = color;
    ctx.fill();
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 1.5 / RP.zoom;
    ctx.stroke();
    // Label
    const fontSize = Math.max(9, 11 / Math.sqrt(RP.zoom));
    ctx.font = 'bold ' + fontSize + 'px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = '#000';
    const label = n.type === 'town' ? n.name : (n.type === 'special' ? '' : nid);
    ctx.fillText(label, n.x, n.y);
    // Route stop number
    if (isStop && stopIdx >= 0) {
      const nr = r * 0.7;
      ctx.beginPath();
      ctx.arc(n.x + r, n.y - r, nr, 0, Math.PI * 2);
      ctx.fillStyle = '#e94560';
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.font = 'bold ' + (fontSize * 0.8) + 'px sans-serif';
      ctx.fillText(String(stopIdx + 1), n.x + r, n.y - r);
    }
  }
  ctx.restore();
}

function rpNodeAtScreen(sx, sy) {
  const [mx, my] = rpScreenToMap(sx, sy);
  const hitR = Math.max(15, 20 / RP.zoom);
  let closest = null, closestDist = Infinity;
  for (const [nid, n] of Object.entries(RP.graph.nodes)) {
    const d = Math.hypot(n.x - mx, n.y - my);
    if (d < hitR && d < closestDist) { closest = nid; closestDist = d; }
  }
  return closest;
}

// --- Event Binding ---
function rpBindEvents() {
  const canvas = RP.canvas;
  const area = document.getElementById('rp-map-area');
  const tooltip = document.getElementById('rp-tooltip');

  canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    const sx = e.clientX - rect.left, sy = e.clientY - rect.top;
    const nid = rpNodeAtScreen(sx, sy);

    // --- Connect mode: click nodes to chain edges ---
    if (RP.editMode && RP.connectMode) {
      if (nid) {
        if (RP.edgeStart && RP.edgeStart !== nid) {
          // Connect previous node to this one
          rpToggleEdge(RP.edgeStart, nid);
          RP.edgeStart = nid; // chain: keep going from this node
        } else if (RP.edgeStart === nid) {
          // Clicked same node: stop connecting
          RP.edgeStart = null;
        } else {
          // First node in chain
          RP.edgeStart = nid;
        }
      } else {
        // Clicked empty space: stop connecting
        RP.edgeStart = null;
      }
      rpDraw();
      return;
    }

    // --- Normal editor mode ---
    if (RP.editMode && nid && e.button === 0) {
      // Start dragging node
      const n = RP.graph.nodes[nid];
      const [nsx, nsy] = rpMapToScreen(n.x, n.y);
      RP.dragNode = nid;
      RP.dragOffX = sx - nsx;
      RP.dragOffY = sy - nsy;
      return;
    }
    if (RP.editMode && !nid && e.button === 0) {
      // Click empty space: add a new node
      const [mx, my] = rpScreenToMap(sx, sy);
      if (mx >= 0 && mx <= RP.MAP_W && my >= 0 && my <= RP.MAP_H) {
        rpAddNodePrompt(Math.round(mx), Math.round(my));
      }
      return;
    }
    // Pan (always available when not in connect mode)
    RP.isPanning = true;
    RP.panStartX = sx - RP.viewX;
    RP.panStartY = sy - RP.viewY;
    canvas.style.cursor = 'grabbing';
  });

  canvas.addEventListener('mousemove', e => {
    const rect = canvas.getBoundingClientRect();
    const sx = e.clientX - rect.left, sy = e.clientY - rect.top;
    RP.mouseX = sx; RP.mouseY = sy;
    if (RP.dragNode) {
      const [mx, my] = rpScreenToMap(sx - RP.dragOffX, sy - RP.dragOffY);
      RP.graph.nodes[RP.dragNode].x = Math.round(mx);
      RP.graph.nodes[RP.dragNode].y = Math.round(my);
      rpDraw();
      return;
    }
    if (RP.isPanning) {
      RP.viewX = sx - RP.panStartX;
      RP.viewY = sy - RP.panStartY;
      rpDraw();
      return;
    }
    // Redraw preview line during connect mode
    if (RP.connectMode && RP.edgeStart) rpDraw();
    // Hover detection
    const nid = rpNodeAtScreen(sx, sy);
    if (nid !== RP.hoverNode) {
      RP.hoverNode = nid;
      rpDraw();
      if (nid) rpShowTooltip(nid, e.clientX, e.clientY);
      else tooltip.style.display = 'none';
    } else if (nid) {
      rpShowTooltip(nid, e.clientX, e.clientY);
    }
  });

  canvas.addEventListener('mouseup', () => {
    RP.dragNode = null;
    RP.isPanning = false;
    canvas.style.cursor = RP.editMode ? 'crosshair' : 'grab';
  });

  canvas.addEventListener('mouseleave', () => {
    RP.dragNode = null;
    RP.isPanning = false;
    RP.hoverNode = null;
    tooltip.style.display = 'none';
    canvas.style.cursor = RP.editMode ? 'crosshair' : 'grab';
    rpDraw();
  });

  canvas.addEventListener('wheel', e => {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const sx = e.clientX - rect.left, sy = e.clientY - rect.top;
    const [mx, my] = rpScreenToMap(sx, sy);
    const factor = e.deltaY < 0 ? 1.15 : 1 / 1.15;
    const newZoom = Math.min(RP.maxZoom, Math.max(RP.minZoom, RP.zoom * factor));
    RP.viewX = sx - mx * newZoom;
    RP.viewY = sy - my * newZoom;
    RP.zoom = newZoom;
    rpDraw();
  }, { passive: false });

  // Context menu for editor
  canvas.addEventListener('contextmenu', e => {
    e.preventDefault();
    if (!RP.editMode) return;
    const rect = canvas.getBoundingClientRect();
    const sx = e.clientX - rect.left, sy = e.clientY - rect.top;
    const nid = rpNodeAtScreen(sx, sy);
    if (nid) rpEditorContextMenu(nid, e.clientX, e.clientY);
  });

  window.addEventListener('resize', () => { if (RP.initialized) rpResize(); });

  // Calculate button
  document.getElementById('rp-calculate').addEventListener('click', rpCalculateRoute);

  // Editor buttons
  document.getElementById('rp-edit-toggle').addEventListener('click', rpToggleEditor);
  document.getElementById('rp-edit-connect').addEventListener('click', rpToggleConnect);
  document.getElementById('rp-edit-water').addEventListener('click', rpToggleWaterMode);
  document.getElementById('rp-edit-save').addEventListener('click', rpSaveGraph);
  document.getElementById('rp-edit-reset').addEventListener('click', rpResetGraph);
  document.getElementById('rp-edit-export').addEventListener('click', rpExportGraph);

  // Item search filter
  document.getElementById('rp-item-search').addEventListener('input', e => {
    rpFilterItemDropdown(e.target.value);
  });
}

function rpShowTooltip(nid, cx, cy) {
  const tooltip = document.getElementById('rp-tooltip');
  const n = RP.graph.nodes[nid];
  if (!n) return;
  let html = '<div class="tt-name">' + esc(n.name || nid) + '</div>';
  html += '<div class="tt-info">';
  if (n.type) html += 'Type: ' + esc(n.type) + '<br>';
  if (n.chapters && n.chapters.length) html += 'Chapters: ' + n.chapters.map(esc).join(', ') + '<br>';
  if (n.enemies && n.enemies.length) html += 'Enemies: ' + n.enemies.slice(0, 5).map(esc).join(', ') + (n.enemies.length > 5 ? '...' : '') + '<br>';
  if (n.resources && n.resources.length) html += 'Resources: ' + n.resources.map(esc).join(', ') + '<br>';
  html += '</div>';
  tooltip.innerHTML = html;
  tooltip.style.display = 'block';
  const area = document.getElementById('rp-map-area');
  const aRect = area.getBoundingClientRect();
  tooltip.style.left = (cx - aRect.left + 15) + 'px';
  tooltip.style.top = (cy - aRect.top + 15) + 'px';
}

// --- Dropdown Population ---
function rpPopulateItems() {
  const sel = document.getElementById('rp-item-select');
  // Group by type
  const groups = { 'Armor': [], 'Weapon': [], 'Accessory': [], 'Item': [], 'Building': [] };
  DATA.armorWeapons.forEach(i => {
    const t = (i.type || '').includes('Armor') ? 'Armor' : 'Weapon';
    groups[t].push(i.name);
  });
  DATA.accessories.forEach(i => {
    const t = (i.type || '').includes('Accessory') ? 'Accessory' : 'Item';
    groups[t].push(i.name);
  });
  DATA.buildings.forEach(i => {
    groups['Building'].push(i.name);
  });
  let html = '<option value="">-- Select an item --</option>';
  for (const [group, items] of Object.entries(groups)) {
    if (!items.length) continue;
    html += '<optgroup label="' + esc(group) + '">';
    items.sort().forEach(name => {
      html += '<option value="' + esc(name) + '">' + esc(name) + '</option>';
    });
    html += '</optgroup>';
  }
  sel.innerHTML = html;
}

function rpFilterItemDropdown(query) {
  const sel = document.getElementById('rp-item-select');
  const q = query.toLowerCase();
  const prev = sel.value;
  const groups = { 'Armor': [], 'Weapon': [], 'Accessory': [], 'Item': [], 'Building': [] };
  DATA.armorWeapons.forEach(i => {
    const t = (i.type || '').includes('Armor') ? 'Armor' : 'Weapon';
    if (!q || i.name.toLowerCase().includes(q)) groups[t].push(i.name);
  });
  DATA.accessories.forEach(i => {
    const t = (i.type || '').includes('Accessory') ? 'Accessory' : 'Item';
    if (!q || i.name.toLowerCase().includes(q)) groups[t].push(i.name);
  });
  DATA.buildings.forEach(i => {
    if (!q || i.name.toLowerCase().includes(q)) groups['Building'].push(i.name);
  });
  let html = '<option value="">-- Select an item --</option>';
  for (const [group, items] of Object.entries(groups)) {
    if (!items.length) continue;
    html += '<optgroup label="' + esc(group) + '">';
    items.sort().forEach(name => {
      html += '<option value="' + esc(name) + '">' + esc(name) + '</option>';
    });
    html += '</optgroup>';
  }
  sel.innerHTML = html;
  sel.value = prev;
}

function rpPopulateStartLocations() {
  const sel = document.getElementById('rp-start-select');
  let html = '<optgroup label="Towns">';
  for (const [nid, n] of Object.entries(RP.graph.nodes)) {
    if (n.type === 'town') html += '<option value="' + esc(nid) + '">' + esc(n.name) + '</option>';
  }
  html += '</optgroup><optgroup label="Numbered Nodes">';
  const numNodes = Object.entries(RP.graph.nodes)
    .filter(([nid, n]) => !n.type)
    .sort((a, b) => parseInt(a[0]) - parseInt(b[0]));
  numNodes.forEach(([nid, n]) => {
    html += '<option value="' + esc(nid) + '">Node ' + esc(nid) + '</option>';
  });
  html += '</optgroup>';
  sel.innerHTML = html;
}

// --- Multi-item route list ---
let rpItemList = [];

function rpRenderItemList() {
  const el = document.getElementById('rp-item-list');
  if (!rpItemList.length) {
    el.innerHTML = '<div class="rp-item-list-empty">No items added. Select items above or use "Add to Route" on craft cards.</div>';
    return;
  }
  el.innerHTML = rpItemList.map((name, i) =>
    '<span class="rp-item-chip">' + esc(name) + ' <span class="rp-chip-x" onclick="rpRemoveItem(' + i + ')">&times;</span></span>'
  ).join('');
}

function rpAddSelectedItem() {
  const sel = document.getElementById('rp-item-select');
  if (!sel.value) return;
  if (!rpItemList.includes(sel.value)) {
    rpItemList.push(sel.value);
    rpRenderItemList();
  }
  sel.value = '';
}

function rpRemoveItem(idx) {
  rpItemList.splice(idx, 1);
  rpRenderItemList();
}

function rpClearItems() {
  rpItemList = [];
  rpRenderItemList();
}

function addToRoutePlanner(itemName) {
  if (!rpItemList.includes(itemName)) {
    rpItemList.push(itemName);
  }
  rpRenderItemList();
}

function addToRouteAndGo(itemName) {
  rpItemList = [itemName];
  switchTab('route-planner');
  rpRenderItemList();
}

// --- Route Calculation UI ---
function rpCalculateRoute() {
  const startNode = document.getElementById('rp-start-select').value;
  const chapter = document.getElementById('rp-chapter-select').value;
  const resultsDiv = document.getElementById('rp-route-results');
  const summaryDiv = document.getElementById('rp-route-summary');

  if (!rpItemList.length) { resultsDiv.innerHTML = '<div class="empty-msg">Please add at least one item to craft.</div>'; return; }

  const result = rpComputeRouteMulti(rpItemList, startNode, chapter);
  if (!result) { resultsDiv.innerHTML = '<div class="empty-msg">No crafting materials found for these items.</div>'; summaryDiv.style.display = 'none'; return; }
  if (result.error) { resultsDiv.innerHTML = '<div class="empty-msg" style="color:var(--red);">' + esc(result.error) + '</div>'; summaryDiv.style.display = 'none'; return; }

  RP.route = result;

  // Show summary
  summaryDiv.style.display = 'block';
  let summaryHtml = '<span class="label">Items:</span> <span class="value">' + rpItemList.map(n => esc(n)).join(', ') + '</span><br>';
  summaryHtml += '<span class="label">Total steps:</span> <span class="value">' + result.totalDist + '</span> | <span class="label">Stops:</span> <span class="value">' + result.stops.length + '</span>';
  summaryDiv.innerHTML = summaryHtml;

  // Show step-by-step
  let html = '<div class="rp-step" onclick="rpZoomToNode(\'' + esc(startNode) + '\')">';
  html += '<div class="rp-step-num" style="background:var(--green);">S</div>';
  html += '<div class="rp-step-info"><div class="rp-step-node">Start: ' + esc(RP.graph.nodes[startNode].name || startNode) + '</div></div></div>';

  result.stops.forEach((s, i) => {
    const n = RP.graph.nodes[s.nodeId];
    const stepId = 'rp-stop-' + i;
    html += '<div class="rp-step">';
    html += '<div class="rp-step-num" onclick="rpZoomToNode(\'' + esc(s.nodeId) + '\')" style="cursor:pointer;">' + (i + 1) + '</div>';
    html += '<div class="rp-step-info">';
    html += '<div class="rp-step-node" onclick="rpZoomToNode(\'' + esc(s.nodeId) + '\')" style="cursor:pointer;">' + esc(n ? n.name || s.nodeId : s.nodeId) + '</div>';
    html += '<div class="rp-step-mats">Collect: ';
    html += s.materials.map(mat => '<span class="rp-mat-link" onclick="event.stopPropagation();rpToggleMatDetail(\'' + stepId + '\',\'' + escJs(mat) + '\',\'' + escJs(s.nodeId) + '\')">' + esc(mat) + '</span>').join(', ');
    html += '</div>';
    html += '<div class="rp-step-dist">' + s.distFromPrev + ' step' + (s.distFromPrev !== 1 ? 's' : '') + ' from previous</div>';
    html += '<div id="' + esc(stepId) + '-detail"></div>';
    html += '</div></div>';
  });
  resultsDiv.innerHTML = html;
  rpDraw();
}

function rpZoomToNode(nid) {
  const n = RP.graph.nodes[nid];
  if (!n) return;
  const cw = RP.canvas.width, ch = RP.canvas.height;
  RP.zoom = 0.8;
  RP.viewX = cw / 2 - n.x * RP.zoom;
  RP.viewY = ch / 2 - n.y * RP.zoom;
  rpDraw();
}

function rpToggleMatDetail(stepId, matName, nodeId) {
  const el = document.getElementById(stepId + '-detail');
  if (!el) return;
  // Toggle: if already showing this material, close it
  if (el.dataset.showing === matName) { el.innerHTML = ''; el.dataset.showing = ''; return; }
  el.dataset.showing = matName;

  let html = '<div class="rp-mat-detail">';
  html += '<b>' + esc(matName) + '</b> at <b>' + esc(nodeId) + '</b>:<br>';
  let found = false;

  // Enemies that drop this material at this node
  if (materialToEnemies[matName]) {
    const nodeNum = nodeId;
    const nodeNode = RP.graph.nodes[nodeId];
    const nodeName = nodeNode ? nodeNode.name || nodeId : nodeId;
    materialToEnemies[matName].forEach(enemy => {
      // Check if this enemy appears at this node in any chapter
      const chaptersHere = [];
      for (const [ch, locStr] of Object.entries(enemy.locations)) {
        const parts = locStr.split(',').map(p => p.trim().replace(/\.$/, ''));
        // Match numbered nodes or special area IDs
        const matches = parts.some(p => {
          if (p === nodeNum) return true;
          const saId = _specialAreaMap[p];
          if (saId === nodeId) return true;
          return false;
        });
        if (matches) chaptersHere.push(ch.replace('Chapter ', 'Ch'));
      }
      if (chaptersHere.length) {
        found = true;
        html += '<span class="rp-md-enemy">' + esc(enemy.name) + '</span> ' + esc(enemy.rating || '') + ' (ATK ' + esc(enemy.attack) + ' DEF ' + esc(enemy.defense) + ' HP ' + esc(enemy.hp) + ') <span style="color:var(--text2);">' + chaptersHere.join(', ') + '</span><br>';
      }
    });
  }

  // Market sources
  if (materialToMarket[matName]) {
    const m = materialToMarket[matName];
    const tid = rpTownId(RP.graph.nodes[nodeId] ? RP.graph.nodes[nodeId].name || '' : '');
    if (tid === nodeId || RP.graph.nodes[nodeId] && RP.graph.nodes[nodeId].type === 'town') {
      Object.entries(m.prices).forEach(([town, p]) => {
        if (p.buy && rpTownId(town) === nodeId) {
          found = true;
          html += '<span class="rp-md-market">Buy at ' + esc(town) + ': ' + esc(p.buy) + ' silver</span><br>';
        }
      });
    }
  }

  // Harvest
  if (DATA.harvestLocations[matName]) {
    const parts = String(DATA.harvestLocations[matName]).split(',').map(p => p.trim());
    if (parts.includes(nodeId)) {
      found = true;
      html += '<span class="rp-md-source">Harvest/mine here</span><br>';
    }
  }

  if (!found) html += '<span style="color:var(--text2);">Source info not available for this node</span>';
  html += '</div>';
  el.innerHTML = html;
}

// --- Known node IDs from game data (for quick-add suggestions) ---
const KNOWN_NODE_IDS = [
  '1','2','5','6','7','8','10','11','12','13','14','15','17','18','19','21','23','24','25','26','27','28','29','30','31','34','35','36','37','38','39','40','41','42','44','45','46','47','50','52','53','57','58','61','62','63','64','65','66','67','68','71','72','73','76','77','80','82','83','84','85','86','87','88','89','90','91','92','93','97','98','99','103','104','105','108'
];
const KNOWN_TOWNS = [
  {id:'mir',name:'Mir'},{id:'vouno',name:'Vouno'},{id:'razdor',name:'Razdor'},{id:'ryba',name:'Ryba'},{id:'silny',name:'Silny'},{id:'strofa',name:'Strofa'},{id:'fort_istra',name:'Fort Istra'}
];
const KNOWN_SPECIAL = [
  {id:'fw_ice_fields',name:'FW - Ice Fields'},{id:'fw_mount_nebesa',name:'FW - Mount Nebesa'},{id:'fw_reka_glacier',name:'FW - Reka Glacier'},
  {id:'fw_room_of_columns',name:'FW - Room of Columns'},{id:'fw_skryvat_temple',name:'FW - Skryvat Temple'},{id:'fw_broken_lands',name:'FW - The Broken Lands'},
  {id:'fw_uchitel_span',name:'FW - Uchitel Span'},{id:'fw_urok_span',name:'FW - Urok Span'},{id:'fw_vniz_path',name:'FW - Vniz Path'},
  {id:'ic_abandoned_quarters',name:'IC - Abandoned Quarters'},{id:'ic_frozen_lake',name:'IC - Frozen Lake'},{id:'ic_glacial_worm_bones',name:'IC - Glacial Worm Bones'},
  {id:'ic_hall_of_ice',name:'IC - Hall of Ice'},{id:'ic_old_armory',name:'IC - Old Armory'},{id:'ic_ossuary',name:'IC - Ossuary'}
];

// --- Editor Mode ---
function rpToggleEditor() {
  RP.editMode = !RP.editMode;
  RP.connectMode = false;
  RP.waterEdgeMode = false;
  RP.edgeStart = null;
  const btn = document.getElementById('rp-edit-toggle');
  const connectBtn = document.getElementById('rp-edit-connect');
  const waterBtn = document.getElementById('rp-edit-water');
  const saveBtn = document.getElementById('rp-edit-save');
  const resetBtn = document.getElementById('rp-edit-reset');
  const exportBtn = document.getElementById('rp-edit-export');
  const helpDiv = document.getElementById('rp-editor-help');
  btn.textContent = RP.editMode ? 'Exit Editor' : 'Edit Map';
  btn.style.background = RP.editMode ? 'var(--accent)' : '';
  btn.style.color = RP.editMode ? '#fff' : '';
  const show = RP.editMode ? '' : 'none';
  connectBtn.style.display = show;
  waterBtn.style.display = show;
  rpStyleConnectBtn();
  rpStyleWaterBtn();
  saveBtn.style.display = show;
  resetBtn.style.display = show;
  exportBtn.style.display = show;
  helpDiv.style.display = show;
  RP.canvas.style.cursor = RP.editMode ? 'crosshair' : 'grab';
  RP.canvas.classList.toggle('editor-mode', RP.editMode);
  rpDraw();
}

function rpToggleConnect() {
  RP.connectMode = !RP.connectMode;
  RP.edgeStart = null;
  rpStyleConnectBtn();
  RP.canvas.style.cursor = RP.connectMode ? 'pointer' : 'crosshair';
  rpDraw();
}

function rpStyleConnectBtn() {
  const connectBtn = document.getElementById('rp-edit-connect');
  if (RP.connectMode) {
    connectBtn.textContent = 'Stop Connecting';
    connectBtn.style.background = '#66bb6a';
    connectBtn.style.color = '#000';
  } else {
    connectBtn.textContent = 'Connect Nodes';
    connectBtn.style.background = '';
    connectBtn.style.color = '';
  }
}

function rpToggleWaterMode() {
  RP.waterEdgeMode = !RP.waterEdgeMode;
  rpStyleWaterBtn();
}

function rpStyleWaterBtn() {
  const btn = document.getElementById('rp-edit-water');
  if (RP.waterEdgeMode) {
    btn.textContent = 'Water: ON';
    btn.style.background = '#42a5f5';
    btn.style.color = '#000';
  } else {
    btn.textContent = 'Water Route';
    btn.style.background = '';
    btn.style.color = '';
  }
}

function rpAddNodePrompt(mx, my) {
  // Build a list of missing known IDs the user hasn't placed yet
  const existing = new Set(Object.keys(RP.graph.nodes));
  const missingNums = KNOWN_NODE_IDS.filter(id => !existing.has(id));
  const missingTowns = KNOWN_TOWNS.filter(t => !existing.has(t.id));
  const missingSpecial = KNOWN_SPECIAL.filter(s => !existing.has(s.id));

  let suggestion = '';
  if (missingNums.length) suggestion = missingNums[0];
  else if (missingTowns.length) suggestion = missingTowns[0].id;

  let promptMsg = 'Enter node ID to place at this location:';
  if (missingNums.length) promptMsg += '\n\nMissing numbered: ' + missingNums.join(', ');
  if (missingTowns.length) promptMsg += '\n\nMissing towns: ' + missingTowns.map(t => t.id + ' (' + t.name + ')').join(', ');
  if (missingSpecial.length) promptMsg += '\n\nMissing special: ' + missingSpecial.map(s => s.id).join(', ');

  const nodeId = prompt(promptMsg, suggestion);
  if (!nodeId || !nodeId.trim()) return;
  let nid = nodeId.trim();

  // Validate: only allow safe characters (letters, numbers, underscores, hyphens, spaces)
  if (!/^[a-zA-Z0-9_ \-]+$/.test(nid)) { alert('Node ID must contain only letters, numbers, spaces, hyphens, and underscores.'); return; }

  // Normalize input: try to match against known IDs flexibly
  const nidLower = nid.toLowerCase().replace(/[\s\-]+/g, '_');
  // Check if input matches a known town by id or name
  const townMatch = KNOWN_TOWNS.find(t => t.id === nid || t.id === nidLower || t.name.toLowerCase() === nid.toLowerCase());
  if (townMatch) nid = townMatch.id;
  // Check if input matches a known special area by id or name
  const specMatch = KNOWN_SPECIAL.find(s => s.id === nid || s.id === nidLower || s.name.toLowerCase() === nid.toLowerCase());
  if (specMatch) nid = specMatch.id;

  if (RP.graph.nodes[nid]) { alert('Node "' + nid + '" already exists. Drag it to move.'); return; }

  // Determine type and name
  let nodeType = undefined;
  let nodeName = nid;
  if (townMatch) { nodeType = 'town'; nodeName = townMatch.name; }
  if (specMatch) { nodeType = 'special'; nodeName = specMatch.name; }

  const nodeData = { x: mx, y: my, name: nodeName, chapters: [], enemies: [], resources: [] };
  if (nodeType) nodeData.type = nodeType;
  RP.graph.nodes[nid] = nodeData;
  rpBuildAdj();
  rpPopulateStartLocations();
  rpDraw();
}

function rpToggleEdge(a, b) {
  const edges = RP.graph.edges;
  const idx = edges.findIndex(e => (e[0] === a && e[1] === b) || (e[0] === b && e[1] === a));
  if (idx >= 0) {
    edges.splice(idx, 1);
  } else {
    if (RP.waterEdgeMode) edges.push([a, b, 'water']);
    else edges.push([a, b]);
  }
  rpBuildAdj();
  rpDraw();
}

function rpEditorContextMenu(nid, cx, cy) {
  const n = RP.graph.nodes[nid];
  if (confirm('Delete node "' + (n.name || nid) + '"? This removes the node and all its edges.')) {
    delete RP.graph.nodes[nid];
    RP.graph.edges = RP.graph.edges.filter(([a, b]) => a !== nid && b !== nid);
    rpBuildAdj();
    rpPopulateStartLocations();
    rpDraw();
  }
}

function rpSaveGraph() {
  localStorage.setItem('tig_map_graph', JSON.stringify(RP.graph));
  alert('Map graph saved to localStorage! (' + Object.keys(RP.graph.nodes).length + ' nodes, ' + RP.graph.edges.length + ' edges)');
}

function rpResetGraph() {
  if (!confirm('Reset to built-in defaults? This discards all placed nodes and edges.')) return;
  localStorage.removeItem('tig_map_graph');
  RP.graph = JSON.parse(JSON.stringify(DATA.mapGraph));
  rpBuildAdj();
  rpPopulateStartLocations();
  rpDraw();
}

function rpExportGraph() {
  const json = JSON.stringify(RP.graph, null, 2);
  // Copy to clipboard
  navigator.clipboard.writeText(json).then(() => {
    alert('Graph JSON copied to clipboard! (' + Object.keys(RP.graph.nodes).length + ' nodes, ' + RP.graph.edges.length + ' edges)\n\nPaste into MAP_GRAPH in build_app.py to make it permanent.');
  }).catch(() => {
    // Fallback: open in a new window
    const w = window.open('', '_blank');
    const pre = w.document.createElement('pre');
    pre.textContent = json;
    w.document.body.appendChild(pre);
  });
}

// --- planRouteFor: called from craft detail overlay ---
function planRouteFor(itemName) {
  document.getElementById('overlay').classList.remove('active');
  rpItemList = [itemName];
  switchTab('route-planner');
  rpRenderItemList();
}

// --- Init ---
buildIndices();
renderEnemies('all', '');
renderMarket();
renderBuildings();
renderStones();
renderMaterialIndex();
</script>
</body>
</html>